!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n=t();for(var r in n)("object"==typeof exports?exports:e)[r]=n[r]}}(this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return e[r].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(2),a=r(i),o=n(5),u=r(o),s=n(6),l=r(s),f=n(7),c=r(f),d=n(8),m=r(d),p=n(9),y=r(p),h=n(1),b=r(h),v=n(10),_=r(v),g=n(11),w=r(g),x=n(13),T=r(x),C={Accessor:{Accessor:a.default},Animation:{Animation:u.default,Interpolators:l.default},Components:{GLTFAnimationComponent:c.default,GLTFJointComponent:m.default,GLTFModelComponent:y.default},Parser:{ConstantConverter:b.default,MaterialsCommonParser:_.default,Parser:w.default}},O=(0,T.default)();Object.assign(O||{},C),window.GrimoireJS.lib.gltf=C,t.default=O},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(21),u=r(o),s=n(22),l=r(s),f=function(){function e(){i(this,e)}return a(e,null,[{key:"asColorValue",value:function(e){return 3===e.length?new u.default(e[0],e[1],e[2]):new l.default(e[0],e[1],e[2],e[3])}},{key:"asVectorSize",value:function(e){switch(e){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16;default:throw new Error("Invalid vectorSize")}}},{key:"asByteSize",value:function(e){switch(e){case WebGLRenderingContext.UNSIGNED_BYTE:case WebGLRenderingContext.BYTE:return 1;case WebGLRenderingContext.UNSIGNED_SHORT:case WebGLRenderingContext.SHORT:return 2;case WebGLRenderingContext.UNSIGNED_INT:case WebGLRenderingContext.INT:case WebGLRenderingContext.FLOAT:return 4;default:throw new Error("Unknown size!")}}},{key:"elementTypeToTypedArray",value:function(e){switch(e){case WebGLRenderingContext.UNSIGNED_BYTE:return Uint8Array;case WebGLRenderingContext.BYTE:return Int8Array;case WebGLRenderingContext.UNSIGNED_SHORT:return Uint16Array;case WebGLRenderingContext.SHORT:return Int16Array;case WebGLRenderingContext.UNSIGNED_INT:return Uint32Array;case WebGLRenderingContext.INT:return Int32Array;case WebGLRenderingContext.FLOAT:return Float32Array;default:throw new Error("Unsupported")}}},{key:"indexCountToBufferInfo",value:function(e){return e<256?{elementType:WebGLRenderingContext.UNSIGNED_BYTE,byteSize:1,ctor:Uint8Array}:e<65536?{elementType:WebGLRenderingContext.UNSIGNED_SHORT,byteSize:2,ctor:Uint16Array}:{elementType:WebGLRenderingContext.UNSIGNED_INT,byteSize:4,ctor:Uint32Array}}},{key:"asGrAttribName",value:function(e){switch(e){case"POSITION":return"position";case"NORMAL":return"normal";case"TEXCOORD_0":return"texCoord";case"JOINT":return"joint";case"WEIGHT":return"weight";default:throw new Error("Unknown semantic"+e)}}}]),e}();t.default=f},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(1),u=r(o),s=function(){function e(t,n,r,a,o,s){i(this,e),this.buffer=t,this.count=n,this.componentType=r,this.elementSize=a,this.byteOffset=o,this.byteStride=s,this._dView=new DataView(t.buffer,t.byteOffset+o),this._elementByteSize=u.default.asByteSize(r)}return a(e,[{key:"getByIndex",value:function(e){if(e<0||e>=this.count)return null;for(var t=new Array(this.elementSize),n=0;n<this.elementSize;n++)t[n]=this._getSingleByIndex(e,n);return t}},{key:"_getSingleByIndex",value:function(e,t){switch(this.componentType){case WebGLRenderingContext.FLOAT:return this._dView.getFloat32(e*(this.elementSize*this._elementByteSize+this.byteStride)+this._elementByteSize*t,!0);default:throw new Error("Unsupported element type")}}}]),e}();t.default=s},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.math.Matrix},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.Node.Component},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(6),u=r(o),s=n(1),l=r(s),f=n(2),c=r(f),d=function(){function e(t,n,r){i(this,e),this.tf=t,this.animationKey=n,this._buffers=r,this.accessors={},this.timeLength=0,this.targetNodes=[],this._animationData=t.animations[n];for(var a in this._animationData.parameters){var o=t.accessors[this._animationData.parameters[a]];this.accessors[a]=new c.default(r[o.bufferView],o.count,o.componentType,l.default.asVectorSize(o.type),o.byteOffset||0,o.byteStride||0)}var u=!0,s=!1,f=void 0;try{for(var d,m=this._animationData.channels[Symbol.iterator]();!(u=(d=m.next()).done);u=!0){var p=d.value,y=this._animationData.samplers[p.sampler],h=this.accessors[y.input];this.timeLength=Math.max(this.timeLength,h.getByIndex(h.count-1)[0]),this.targetNodes.push(p.target.id),"rotation"===p.target.path&&"LINEAR"===this._animationData.samplers[p.sampler].interpolation&&(this._animationData.samplers[p.sampler].interpolation="SPHERICAL")}}catch(e){s=!0,f=e}finally{try{!u&&m.return&&m.return()}finally{if(s)throw f}}}return a(e,[{key:"processCurrentFrame",value:function(e,t){for(var n=0;n<this._animationData.channels.length;n++){var r=this._animationData.channels[n],i=this._getBySampler(r.sampler,e);t(r.target.id,r.target.path,i)}}},{key:"_getBySampler",value:function(e,t){var n=this._animationData.samplers[e],r=this.accessors[n.input],i=this.accessors[n.output],a=0;for(a=0;a<r.count;a++){var o=r.getByIndex(a)[0];if(o>t)return this._complementFrame(t,r.getByIndex(a-1),r.getByIndex(a),i.getByIndex(a-1),i.getByIndex(a),n.interpolation)}return this._complementFrame(t,r.getByIndex(a-1),null,i.getByIndex(a-1),null,n.interpolation)}},{key:"_complementFrame",value:function(e,t,n,r,i,a){if(!r)return i;if(!i)return r;var o=(n[0]-e)/(n[0]-t[0]);return u.default[a](o,r,i)}}]),e}();t.default=d},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(23),a=r(i),o=a.default.quat;t.default={LINEAR:function(e,t,n){for(var r=new Array(t.length),i=0;i<t.length;i++)r[i]=t[i]+(n[i]-t[i])*e;return r},SPHERICAL:function(e,t,n){var r=new Array(t.length);return o.slerp(r,t,n,e),r}}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(4),l=r(s),f=function(e){function t(){return i(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),u(t,[{key:"$mount",value:function(){this._startTime=(new Date).getTime(),this._animation=this.getValue("animation")}},{key:"$update",value:function(){var e=this;if(!this._targetTransforms){this._targetTransforms={};var t=this._animation.targetNodes,n=!0,r=!1,i=void 0;try{for(var a,o=t[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var u=a.value,s=this.node.parent.parent.parent.getChildrenByClass(u);this._targetTransforms[u]=s[0].getComponent("Transform")}}catch(e){r=!0,i=e}finally{try{!n&&o.return&&o.return()}finally{if(r)throw i}}}var l=((new Date).getTime()-this._startTime)/1e3;this._animation.processCurrentFrame(l%5,function(t,n,r){var i=e._targetTransforms[t];switch(n){case"translation":i.localPosition.rawElements=r;break;case"rotation":i.localRotation.rawElements=r}});for(var f in this._targetTransforms)this._targetTransforms[f].updateTransform()}},{key:"$unmount",value:function(){}}]),t}(l.default);t.default=f,f.attributes={play:{converter:"Boolean",defaultValue:!1},animation:{converter:"Object",defaultValue:null}}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(3),l=r(s),f=n(12),c=r(f),d=n(4),m=r(d),p=function(e){function t(){return i(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),u(t,[{key:"$mount",value:function(){this._transform=this.node.getComponent(c.default),this._skeletonTransform=this.getValue("skeletonTransform");var e=this.getValue("skinInfo");this._poseIndex=e.jointNames.indexOf(this.getValue("jointName")),this._jointMatrices=this.getValue("jointMatrices"),this._bindShapeMatrix=e.bindShapeMatrix,this._invBindMatrix=new l.default(e.inverseBindMatrices.getByIndex(this._poseIndex))}},{key:"$update",value:function(){for(var e=l.default.inverse(this._skeletonTransform.globalTransform).multiplyWith(this._transform.globalTransform).multiplyWith(this._invBindMatrix).multiplyWith(this._bindShapeMatrix),t=0;t<16;t++)this._jointMatrices[16*this._poseIndex+t]=e.rawElements[t]}}]),t}(m.default);t.default=p,p.attributes={skinInfo:{converter:"Object",defaultValue:null},jointName:{converter:"String",defaultValue:null},skeletonTransform:{converter:"Object",defaultValue:null},jointMatrices:{converter:"Object",defaultValue:null}}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(12),l=r(s),f=n(3),c=r(f),d=n(4),m=r(d),p=n(11),y=r(p),h=function(e){function t(){return i(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),u(t,[{key:"$mount",value:function(){var e=this,t=this.getValue("src");if(t){var n=this.companion.get("gl");y.default.parseFromURL(n,t).then(function(t){e._populateAssets(t),e._populateScene(t)})}}},{key:"_populateScene",value:function(e){var t=this.getValue("scene");t||(t=e.tf.scene);var n=e.tf.scenes[t],r=!0,i=!1,a=void 0;try{for(var o,u=n.nodes[Symbol.iterator]();!(r=(o=u.next()).done);r=!0){var s=o.value;this._populateNode(e,s,this.node)}}catch(e){i=!0,a=e}finally{try{!r&&u.return&&u.return()}finally{if(i)throw a}}}},{key:"_populateAssets",value:function(e){var t=this.node.addChildByName("gltf-assets",{});for(var n in e.materials){var r=t.addChildByName("material",e.materials[n]);r.element.className=e.materials[n].class}for(var i in e.animations)t.addChildByName("gltf-animation",{animation:e.animations[i]})}},{key:"_populateNode",value:function(e,t,n){var r=e.tf.nodes[t],i=n.addChildByName("object",{});if(i.element.className=t,void 0!==r.meshes)for(var a=0;a<r.meshes.length;a++)for(var o=e.meshes[r.meshes[a]],u=0;u<o.length;u++)i.addChildByName("gltf-mesh",{geometry:o[u],material:".gltf-"+e.tf.meshes[r.meshes[a]].primitives[u].material,boneMatricies:r.skin?e.skins[r.skin].jointMatrices:void 0});if(this._applyTransform(r,i),r.children){var s=!0,f=!1,c=void 0;try{for(var d,m=r.children[Symbol.iterator]();!(s=(d=m.next()).done);s=!0){var p=d.value;this._populateNode(e,p,i)}}catch(e){f=!0,c=e}finally{try{!s&&m.return&&m.return()}finally{if(f)throw c}}}if(r.skeletons&&r.skin)for(var y=0;y<r.skeletons.length;y++){var h=this.node.getChildrenByClass(r.skeletons[y]);this._injectJoint(e,h[0],r.skeletons[y],this.node.getComponent(l.default),r.skin)}}},{key:"_injectJoint",value:function(e,t,n,r,i){if(t.addComponent("GLTFJoint",{skinInfo:e.skins[i],jointName:n,skeletonTransform:r,jointMatrices:e.skins[i].jointMatrices}),e.tf.nodes[n].children)for(var a=e.tf.nodes[n],o=0;o<a.children.length;o++){var u=this.node.getChildrenByClass(a.children[o]);this._injectJoint(e,u[0],a.children[o],r,i)}}},{key:"_applyTransform",value:function(e,t){if(e.translation&&t.setAttribute("position",e.translation),e.scale&&t.setAttribute("scale",e.scale),e.rotation&&t.setAttribute("rotation",e.rotation),e.matrix){var n=new c.default(e.matrix);t.setAttribute("position",n.getTranslation()),t.setAttribute("scale",n.getScaling()),t.setAttribute("rotation",n.getRotation())}}}]),t}(m.default);t.default=h,h.componentName="GLTFModelComponent",h.attributes={src:{converter:"String",defaultValue:null},scene:{converter:"String",defaultValue:null}}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(1),u=r(o),s=function(){function e(){i(this,e)}return a(e,null,[{key:"parse",value:function(e,t,n,r){var i=e.materials[t];if(i.extensions.KHR_materials_common){var a=i.extensions.KHR_materials_common,o=a.values;switch(a.technique){case"PHONG":case"BLINN":var s={type:"gltf-unlit",class:"gltf-"+t};return"string"==typeof o.diffuse?s.texture=r[o.diffuse]:Array.isArray(o.diffuse)&&(s.diffuse=u.default.asColorValue(o.diffuse)),s;default:throw new Error("Unsupported common material technique "+a.technique)}}}}]),e}();t.default=s},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(2),u=r(o),s=n(3),l=r(s),f=n(5),c=r(f),d=n(10),m=r(d),p=n(1),y=r(p),h=n(24),b=r(h),v=n(20),_=r(v),g=n(15),w=r(g),x=n(18),T=r(x),C=n(16),O=r(C),S=n(14),M=r(S),j=n(19),A=r(j),R=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{s(r.next(e))}catch(e){a(e)}}function u(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,u)}s((r=r.apply(e,t)).next())})},N=function(){function e(){i(this,e)}return a(e,null,[{key:"parseFromURL",value:function(t,n){return R(this,void 0,void 0,regeneratorRuntime.mark(function r(){var i,a,o,s,f,d,p,h,b,v,_,g,x,C,O,S,j,R,N,G,k,P,L,I,E,B,V,F,U,D,W,z=this;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return i=e.getBaseDir(n),r.next=3,w.default.resolve(n);case 3:a=r.sent,o=JSON.parse(a),s={},f={},d={},p={},h={},b={},v={},_={},g={},x={},r.t0=regeneratorRuntime.keys(o.buffers);case 16:if((r.t1=r.t0()).done){r.next=23;break}return C=r.t1.value,r.next=20,e.bufferFromURL(o,C,i);case 20:s[C]=r.sent,r.next=16;break;case 23:for(O in o.bufferViews)S=o.bufferViews[O],j=s[S.buffer],f[O]=new Uint8Array(j,S.byteOffset,S.byteLength),void 0===S.target||(R=p[O]=new T.default(t,S.target,WebGLRenderingContext.STATIC_DRAW),R.update(f[O]));for(N in o.meshes)d[N]=e._parseMesh(t,o,N,p,f);G=[],k=function(t){e.isDataUri(o.images[t].uri)?G.push(z.imageFromDataUrl(o.images[t].uri).then(function(e){h[t]=e})):G.push(M.default.resolve(i+o.images[t].uri).then(function(e){h[t]=e}))};for(P in o.images)k(P);return r.next=30,Promise.all(G);case 30:for(L in o.textures)I=o.textures[L],E=b[L]=new A.default(t),E.update(h[I.source]);for(B in o.materials)V=o.materials[B],void 0!==V.extensions&&V.extensions.KHR_materials_common?g[B]=m.default.parse(o,B,i,b):(console.warn("program is not parsed. Common material configuration are used alternatively"),o.materials[B].extensions={},o.materials[B].extensions.KHR_materials_common={values:V.values,technique:"PHONG",transparent:!0,jointCount:0,doubleSided:!0},g[B]=m.default.parse(o,B,i,b));if(o.animations)for(F in o.animations)v[F]=new c.default(o,F,f);if(o.skins)for(U in o.skins)D=o.skins[U],W=o.accessors[D.inverseBindMatrices],_[U]={bindShapeMatrix:new l.default(D.bindShapeMatrix),jointNames:D.jointNames,inverseBindMatrices:new u.default(f[W.bufferView],W.count,W.componentType,y.default.asVectorSize(W.type),W.byteOffset||0,W.byteStride||0),jointMatrices:new Float32Array(16*D.jointNames.length)};return r.abrupt("return",{meshes:d,textures:b,tf:o,materials:g,animations:v,skins:_});case 35:case"end":return r.stop()}},r,this)}))}},{key:"_parseMesh",value:function(t,n,r,i,a){for(var o=n.meshes[r],u=[],s=0;s<o.primitives.length;s++){var l=o.primitives[s],f={};if(f.topology=l.mode||WebGLRenderingContext.TRIANGLES,l.indices){var c=n.accessors[l.indices];f.byteSize=y.default.asByteSize(c.componentType);var d=a[c.bufferView],m=y.default.elementTypeToTypedArray(c.componentType),p=new m(d.buffer,c.byteOffset+d.byteOffset),h=new T.default(t,WebGLRenderingContext.ELEMENT_ARRAY_BUFFER,WebGLRenderingContext.STATIC_DRAW);h.update(p),f.type=c.componentType,f.index=h,f.byteOffset=0,f.count=c.count}else{var v=n.accessors[l.attributes.POSITION].count,g=y.default.indexCountToBufferInfo(v);f.type=g.elementType,f.index=new T.default(t,WebGLRenderingContext.ELEMENT_ARRAY_BUFFER,WebGLRenderingContext.STATIC_DRAW),f.byteSize=g.byteSize,f.byteOffset=0,f.count=v;for(var w=new g.ctor(f.count),x=0;x<f.count;x++)w[x]=x;f.index.update(w)}var C={},S={},M=void 0;if(!l.attributes.TEXCOORD_0){var j=n.accessors[l.attributes.POSITION],A=new T.default(t,WebGLRenderingContext.ARRAY_BUFFER,WebGLRenderingContext.STATIC_DRAW);A.update(new Float32Array(new ArrayBuffer(8*j.count))),S["@@UV"]=A,C.texCoord={bufferName:"@@UV",size:2,offset:0,stride:0,type:WebGLRenderingContext.FLOAT}}for(var R in l.attributes){var N=y.default.asGrAttribName(R),G=n.accessors[l.attributes[R]];S[G.bufferView]=i[G.bufferView],"POSITION"===R&&(M=G.max&&G.min?new _.default([new b.default(G.max[0],G.max[1],G.max[2]),new b.default(G.min[0],G.min[1],G.min[2])]):e._genAABB(a[G.bufferView],G.byteStride,G.byteOffset,G.count)),C[N]={bufferName:G.bufferView,size:y.default.asVectorSize(G.type),type:G.componentType,stride:G.byteStride,offset:G.byteOffset}}var k=new O.default(S,C,{default:f},M);k.materialName=l.material,u.push(k)}return u}},{key:"bufferFromURL",value:function(t,n,r){return e.isDataUri(t.buffers[n].uri)?new Promise(function(r,i){r(e.dataUriToArrayBuffer(t.buffers[n].uri))}):new Promise(function(e,i){var a=new XMLHttpRequest;a.open("GET",r+t.buffers[n].uri),a.responseType="arraybuffer",a.onload=function(t){e(a.response)},a.onerror=function(e){i(e)},a.send()})}},{key:"_genAABB",value:function(e,t,n,r){for(var i=new _.default,a=new Float32Array(e.buffer,e.byteOffset),o=n;o<n+(r-1)*t;o+=t)i.expand(new b.default(a[o],a[o+1],a[o+2]));return i}},{key:"isDataUri",value:function(e){return!!e.match(/^\s*data\:.*;base64/)}},{key:"dataUriToArrayBuffer",value:function(e){for(var t=e.split(","),n=atob(t[1]),r=n.length,i=new ArrayBuffer(r),a=new Uint8Array(i),o=0;o<r;o++)a[o]=n.charCodeAt(o);return i}},{key:"imageFromDataUrl",value:function(e){return new Promise(function(t,n){var r=document.createElement("canvas"),i=r.getContext("2d"),a=new Image;a.src=e,a.onload=function(){var e=2*Math.pow(2,Math.log(a.width)/Math.LN2|0),n=2*Math.pow(2,Math.log(a.height)/Math.LN2|0);r.width=e,r.height=n,i.drawImage(a,0,0,a.width,a.height,0,0,e,n),t(r)}})}},{key:"getBaseDir",value:function(e){return e.substr(0,e.lastIndexOf("/")+1)}}]),e}();t.default=N},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.fundamental.Components.TransformComponent},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(8),a=r(i),o=n(7),u=r(o),s=n(9),l=r(s),f=n(25),c=r(f),d=n(17),m=r(d),p=n(26),y=r(p),h=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{s(r.next(e))}catch(e){a(e)}}function u(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,u)}s((r=r.apply(e,t)).next())})};t.default=function(){c.default.register(function(){return h(void 0,void 0,void 0,regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:c.default.registerComponent("GLTFModel",l.default),c.default.registerComponent("GLTFAnimation",u.default),c.default.registerComponent("GLTFJoint",a.default),c.default.registerNode("model",["GLTFModel"],{},"object"),c.default.registerNode("gltf-mesh",[],{material:"new(gltf-unlit)"},"mesh"),c.default.registerNode("gltf-joint",["GLTFJoint"],{},"object"),c.default.registerNode("gltf-assets",[],{}),c.default.registerNode("gltf-animation",["GLTFAnimation"],{}),m.default.addSORTMaterial("gltf-unlit",y.default);case 9:case"end":return e.stop()}},e,this)}))})}},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.fundamental.Asset.ImageResolver},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.fundamental.Asset.TextFileResolver},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.fundamental.Geometry.Geometry},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.fundamental.Material.MaterialFactory},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.fundamental.Resource.Buffer},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.fundamental.Resource.Texture2D},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.math.AABB},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.math.Color3},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.math.Color4},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.math.GLM},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.math.Vector3},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS},function(e,t){e.exports='@Pass\n@NoCull()\nFS_PREC(mediump,float)\n varying vec3 vNormal;\nvarying vec2 vUV;\n\n#ifdef VS\n  uniform mat4 boneMatricies[2];\n  attribute vec3 normal;\n  attribute vec3 position;\n  attribute vec2 texCoord;\n  // attribute vec4 joint;\n  // attribute vec4 weight;\n\n  uniform mat4 _matPVM;\n  uniform mat4 _matM;\n\n  void main(){\n  //  mat4 skinMat = weight.x * boneMatricies[int(joint.x)] + weight.y * boneMatricies[int(joint.y)] + weight.z * boneMatricies[int(joint.z)] + weight.w * boneMatricies[int(joint.w)];\n    gl_Position = _matPVM  * vec4(position,1);\n    vNormal = normalize((_matM  * vec4(normal,0)).xyz);\n    vUV = texCoord;\n  }\n\n\n#endif\n\n\n#ifdef FS\n  @{usedFlag:"_textureUsed"}\n  uniform sampler2D texture;\n\n  uniform bool _textureUsed;\n\n  @{type:"color"}\n  uniform vec4 diffuse;\n\n  @{default:"n(1,1,-1)"}\n  uniform vec3 sunDir;\n\n  void main(){\n    vec4 dColor;\n    if(_textureUsed){\n      dColor = texture2D(texture,vUV);\n    }else{\n      dColor = diffuse;\n    }\n    gl_FragColor.xyz = dot(sunDir,vNormal) * dColor.xyz;\n    gl_FragColor.w = dColor.w;\n  }\n#endif\n'}])});
//# sourceMappingURL=grimoire-gltf.min.js.map