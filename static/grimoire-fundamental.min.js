!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n=t();for(var r in n)("object"==typeof exports?exports:e)[r]=n[r]}}(this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={exports:{},id:r,loaded:!1};return e[r].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(25),i=r(o),a=n(15),u=r(a),s=n(16),l=r(s),f=n(17),c=r(f),d=n(26),h=r(d),p=n(27),_=r(p),b=n(28),v=r(b),m=n(29),y=r(m),g=n(30),w=r(g),E=n(31),R=r(E),O=n(32),C=r(O),x=n(33),T=r(x),M=n(18),P=r(M),A=n(19),S=r(A),k=n(5),j=r(k),L=n(34),N=r(L),I=n(35),G=r(I),F=n(36),W=r(F),D=n(37),B=r(D),V=n(38),U=r(V),z=n(41),q=r(z),H=n(42),$=r(H),X=n(39),Y=r(X),J=n(40),Z=r(J),Q=n(10),K=r(Q),ee=n(43),te=r(ee),ne=n(20),re=r(ne),oe=n(3),ie=r(oe),ae=n(44),ue=r(ae),se=n(45),le=r(se),fe=n(46),ce=r(fe),de=n(47),he=r(de),pe=n(48),_e=r(pe),be=n(49),ve=r(be),me=n(50),ye=r(me),ge=n(51),we=r(ge),Ee=n(52),Re=r(Ee),Oe=n(53),Ce=r(Oe),xe=n(54),Te=r(xe),Me=n(11),Pe=r(Me),Ae=n(12),Se=r(Ae),ke=n(55),je=r(ke),Le=n(56),Ne=r(Le),Ie=n(57),Ge=r(Ie),Fe=n(58),We=r(Fe),De=n(59),Be=r(De),Ve=n(13),Ue=r(Ve),ze=n(60),qe=r(ze),He=n(61),$e=r(He),Xe=n(62),Ye=r(Xe),Je=n(6),Ze=r(Je),Qe=n(81),Ke=r(Qe),et=n(82),tt=r(et),nt=n(83),rt=r(nt),ot=n(63),it=r(ot),at=n(21),ut=r(at),st=n(64),lt=r(st),ft=n(65),ct=r(ft),dt=n(22),ht=r(dt),pt=n(2),_t=r(pt),bt=n(66),vt=r(bt),mt=n(67),yt=r(mt),gt=n(4),wt=r(gt),Et=n(68),Rt=r(Et),Ot=n(69),Ct=r(Ot),xt=n(70),Tt=r(xt),Mt=n(71),Pt=r(Mt),At=n(72),St=r(At),kt=n(73),jt=r(kt),Lt=n(74),Nt=r(Lt),It=n(75),Gt=r(It),Ft=n(76),Wt=r(Ft),Dt=n(77),Bt=r(Dt),Vt=n(23),Ut=r(Vt),zt=n(84),qt=r(zt),Ht="0.10.10",$t="grimoirejs-fundamental",Xt={Asset:{AssetLoader:i.default,CacheResolver:u.default,ExternalResourceResolver:l.default,ImageResolver:c.default,TextFileResolver:h.default},Components:{AssetLoadingManagerComponent:_.default,CameraComponent:v.default,CanvasInitializerComponent:y.default,FullscreenComponent:w.default,GeometryComponent:R.default,GeometryRegistoryComponent:C.default,HTMLBinderComponent:T.default,LoopManagerComponent:P.default,MaterialComponent:S.default,MaterialContainerComponent:j.default,MaterialImporterComponent:N.default,MaterialManagerComponent:G.default,MeshRendererComponent:W.default,MouseCameraControlComponent:B.default,RenderBufferComponent:U.default,RendererComponent:q.default,RendererManagerComponent:$.default,RenderQuadComponent:Y.default,RenderSceneComponent:Z.default,SceneComponent:K.default,TextureBufferComponent:te.default,TextureComponent:re.default,TransformComponent:ie.default},Converters:{CanvasSizeConverter:ue.default,ComponentConverter:le.default,EnumConverter:ce.default,GeometryConverter:he.default,MaterialConverter:_e.default,NumberArrayConverter:ve.default,NumberConverter:ye.default,ObjectConverter:we.default,TextureConverter:Re.default,ViewportConverter:Ce.default},Geometry:{DefaultPrimitives:Te.default,Geometry:Pe.default,GeometryFactory:Se.default,GeometryUtility:je.default},Material:{DefaultMacro:Ne.default,DefaultMaterial:Ge.default,MacroRegistory:We.default,Material:Be.default,MaterialFactory:Ue.default,Pass:qe.default,Technique:$e.default,TextureReference:Ye.default,UniformResolverRegistry:Ze.default,Uniforms:{MatricesRegister:Ke.default,MiscRegister:tt.default,UserValueRegister:rt.default}},Resource:{Buffer:it.default,FrameBuffer:ut.default,GLExtRequestor:lt.default,Program:ct.default,RenderBuffer:ht.default,ResourceBase:_t.default,ResourceCache:vt.default,Shader:yt.default,Texture2D:wt.default,UniformProxy:Rt.default},SceneRenderer:{DrawPriorty:Ct.default,RenderQueue:Tt.default,RenderQueueRegistry:Pt.default},Sort:{ImportResolver:St.default,NameSemanticsPair:jt.default,Parser:Nt.default,Preferences:Gt.default,SortTransformUtility:Wt.default,TypeToConstant:Bt.default},Util:{TextureSizeCalculator:Ut.default}},Yt=(0,qt.default)();Object.assign(Xt,{__VERSION__:Ht,__NAME__:$t}),Object.assign(Yt||{},Xt),window.GrimoireJS.lib.fundamental=Xt,t.default=Yt},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.Node.Component},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(89),l=r(s),f=function(e){function t(e){o(this,t);var n=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.gl=e,n.destroyed=!1,n.valid=!1,n}return a(t,e),u(t,[{key:"destroy",value:function(){this.destroyed=!0}},{key:"valid",get:function(){return this._valid},set:function(e){var t=this;this._valid!==e&&(this._valid=e,this._valid?this._validResolve(this):this.validPromise=new Promise(function(e){t._validResolve=e}))}}]),t}(l.default);t.default=f},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(7),l=r(s),f=n(8),c=r(f),d=n(14),h=r(d),p=n(79),_=r(p),b=n(24),v=r(b),m=n(1),y=r(m),g=v.default.mat4,w=v.default.vec3,E=v.default.vec4,R=function(e){function t(){o(this,t);var e=i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return e.localTransform=new l.default,e.globalTransform=new l.default,e._children=[],e._cachePVM=new l.default,e._cacheVM=new l.default,e._forward=new c.default([0,0,-1,0]),e._up=new c.default([0,1,0,0]),e._right=new c.default([1,0,0,0]),e._globalPosition=new c.default([0,0,0]),e._globalScale=new c.default([1,1,1]),e._matrixTransformMode=!1,e}return a(t,e),u(t,[{key:"calcPVM",value:function(e){return g.mul(this._cachePVM.rawElements,e.ProjectionViewMatrix.rawElements,this.globalTransform.rawElements),this._cachePVM}},{key:"calcVM",value:function(e){return g.mul(this._cacheVM.rawElements,e.ViewMatrix.rawElements,this.globalTransform.rawElements),this._cacheVM}},{key:"$awake",value:function(){var e=this;this.getAttributeRaw("position").watch(function(t){e._localPosition=t,e._matrixTransformMode=!1,e.updateTransform(!0)}),this.getAttributeRaw("rotation").watch(function(t){e._localRotation=t,e._matrixTransformMode=!1,e.updateTransform()}),this.getAttributeRaw("scale").watch(function(t){e._localScale=t,e._matrixTransformMode=!1,e.updateTransform(!0)}),this.getAttributeRaw("rawMatrix").watch(function(t){if(null!==t){var n=t;e._matrixTransformMode=!0,e.localTransform=n,e.updateGlobalTransform()}}),this._localPosition=this.getAttribute("position"),this._localRotation=this.getAttribute("rotation"),this._localScale=this.getAttribute("scale"),this.updateTransform()}},{key:"$mount",value:function(){this._parentTransform=this.node.parent.getComponent(t),this._parentTransform&&this._parentTransform._children.push(this),this.updateTransform()}},{key:"$unmount",value:function(){this._parentTransform&&(this._parentTransform._children.splice(this._parentTransform._children.indexOf(this),1),this._parentTransform=null)}},{key:"updateTransform",value:function(e){this._matrixTransformMode||g.fromRotationTranslationScale(this.localTransform.rawElements,this._localRotation.rawElements,this._localPosition.rawElements,this._localScale.rawElements),this.updateGlobalTransform(e)}},{key:"updateGlobalTransform",value:function(e){this._parentTransform?g.mul(this.globalTransform.rawElements,this._parentTransform.globalTransform.rawElements,this.localTransform.rawElements):g.copy(this.globalTransform.rawElements,this.localTransform.rawElements),e&&this._updateDirections(),this._updateGlobalProperty(),this.node.emit("transformUpdated",this),this._children.forEach(function(t){return t.updateGlobalTransform(e)})}},{key:"_updateDirections",value:function(){E.transformMat4(this._forward.rawElements,t._forwardBase.rawElements,this.globalTransform.rawElements),E.transformMat4(this._up.rawElements,t._upBase.rawElements,this.globalTransform.rawElements),E.transformMat4(this._right.rawElements,t._rightBase.rawElements,this.globalTransform.rawElements)}},{key:"_updateGlobalProperty",value:function(){this._parentTransform?(w.transformMat4(this._globalPosition.rawElements,this._localPosition.rawElements,this._parentTransform.globalTransform.rawElements),w.transformMat4(this._globalScale.rawElements,this._localScale.rawElements,this._parentTransform.globalTransform.rawElements)):(w.copy(this._globalPosition.rawElements,this._localPosition.rawElements),w.copy(this._globalScale.rawElements,this._localScale.rawElements))}},{key:"globalPosition",get:function(){return this._globalPosition}},{key:"localPosition",get:function(){return this._localPosition},set:function(e){this._localPosition=e,this.setAttribute("position",e)}},{key:"localRotation",get:function(){return this._localRotation},set:function(e){this._localRotation=e,this.setAttribute("rotation",e)}},{key:"globalScale",get:function(){return this._globalScale}},{key:"localScale",get:function(){return this._localScale},set:function(e){this._localScale=e,this.setAttribute("scale",e)}},{key:"forward",get:function(){return this._forward}},{key:"up",get:function(){return this._up}},{key:"right",get:function(){return this._right}}]),t}(y.default);t.default=R,R.attributes={position:{converter:"Vector3",default:c.default.Zero},rotation:{converter:"Rotation3",default:_.default.Identity},scale:{converter:"Vector3",default:c.default.One},rawMatrix:{converter:"Object",default:null}},R._forwardBase=new h.default(0,0,-1,0),R._upBase=new h.default(0,1,0,0),R._rightBase=new h.default(1,0,0,0)},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var a=o.get;if(void 0!==a)return a.call(r)},l=n(2),f=r(l),c=function(e){function t(e){o(this,t);var n=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n._texParameterChanged=!0,n._magFilter=WebGLRenderingContext.LINEAR,n._minFilter=WebGLRenderingContext.LINEAR,n._wrapS=WebGLRenderingContext.REPEAT,n._wrapT=WebGLRenderingContext.REPEAT,t._maxTextureSize||(t._maxTextureSize=e.getParameter(WebGLRenderingContext.MAX_TEXTURE_SIZE)),n.texture=e.createTexture(),n}return a(t,e),u(t,[{key:"update",value:function(e,t,n,r,o,i,a,u){this.gl.bindTexture(WebGLRenderingContext.TEXTURE_2D,this.texture);var s=void 0,l=void 0,f=void 0,c=void 0;void 0===n?(s=t||{flipY:!1,premultipliedAlpha:!1},l=e):(c=e,f=t,s=u||{flipY:!1,premultipliedAlpha:!1}),void 0===s.flipY&&(s.flipY=!1),void 0===s.premultipliedAlpha&&(s.premultipliedAlpha=!1),this.gl.pixelStorei(WebGLRenderingContext.UNPACK_FLIP_Y_WEBGL,s.flipY?1:0),this.gl.pixelStorei(WebGLRenderingContext.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s.premultipliedAlpha?1:0),void 0===n?l instanceof HTMLImageElement?this.gl.texImage2D(WebGLRenderingContext.TEXTURE_2D,0,WebGLRenderingContext.RGBA,WebGLRenderingContext.RGBA,WebGLRenderingContext.UNSIGNED_BYTE,this._justifyImage(l)):l instanceof HTMLCanvasElement?this.gl.texImage2D(WebGLRenderingContext.TEXTURE_2D,0,WebGLRenderingContext.RGBA,WebGLRenderingContext.RGBA,WebGLRenderingContext.UNSIGNED_BYTE,this._justifyCanvas(l)):l instanceof HTMLVideoElement&&this.gl.texImage2D(WebGLRenderingContext.TEXTURE_2D,0,WebGLRenderingContext.RGBA,WebGLRenderingContext.RGBA,WebGLRenderingContext.UNSIGNED_BYTE,this._justifyVideo(l)):(void 0===a&&(a=null),this.gl.texImage2D(WebGLRenderingContext.TEXTURE_2D,c,o,f,n,r,o,i,a)),this._ensureMipmap(),this.valid=!0}},{key:"register",value:function(e){this.gl.activeTexture(WebGLRenderingContext.TEXTURE0+e),this.gl.bindTexture(WebGLRenderingContext.TEXTURE_2D,this.texture),this._texParameterChanged&&this._updateTexParameter()}},{key:"destroy",value:function(){s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",this).call(this),this.gl.deleteTexture(this.texture)}},{key:"_justifyImage",value:function(e){var n=e.naturalWidth,r=e.naturalHeight,o=Math.min(Math.pow(2,Math.log(Math.min(n,r))/Math.LN2|0),t._maxTextureSize);if(n!==r||n!==o){var i=document.createElement("canvas");return i.height=i.width=o,i.getContext("2d").drawImage(e,0,0,n,r,0,0,o,o),i}return e}},{key:"_justifyCanvas",value:function(e){var t=e.width,n=e.height,r=Math.pow(2,Math.log(Math.min(t,n))/Math.LN2|0);return t===n&&t===r||(e.height=e.width=2*r),e}},{key:"_justifyVideo",value:function(e){var t=e.videoWidth,n=e.videoHeight,r=Math.pow(2,Math.log(Math.min(t,n))/Math.LN2|0);if(t!==n||t!==r){var o=document.createElement("canvas");return o.height=o.width=r,o.getContext("2d").drawImage(e,0,0,t,n,0,0,r,r),o}return e}},{key:"_updateTexParameter",value:function(){this.gl.texParameteri(WebGLRenderingContext.TEXTURE_2D,WebGLRenderingContext.TEXTURE_MIN_FILTER,this._minFilter),this.gl.texParameteri(WebGLRenderingContext.TEXTURE_2D,WebGLRenderingContext.TEXTURE_MAG_FILTER,this._magFilter),this.gl.texParameteri(WebGLRenderingContext.TEXTURE_2D,WebGLRenderingContext.TEXTURE_WRAP_S,this._wrapS),this.gl.texParameteri(WebGLRenderingContext.TEXTURE_2D,WebGLRenderingContext.TEXTURE_WRAP_T,this._wrapT),this._texParameterChanged=!1}},{key:"_ensureMipmap",value:function(){(t._filtersNeedsMipmap.indexOf(this.magFilter)>=0||t._filtersNeedsMipmap.indexOf(this.minFilter)>=0)&&(this.gl.bindTexture(WebGLRenderingContext.TEXTURE_2D,this.texture),this.gl.generateMipmap(WebGLRenderingContext.TEXTURE_2D))}},{key:"magFilter",get:function(){return this._magFilter},set:function(e){this._magFilter!==e&&(this._texParameterChanged=!0,this._magFilter=e,this._ensureMipmap())}},{key:"minFilter",get:function(){return this._minFilter},set:function(e){this._minFilter!==e&&(this._texParameterChanged=!0,this._minFilter=e,this._ensureMipmap())}},{key:"wrapS",get:function(){return this._wrapS},set:function(e){this._wrapS!==e&&(this._texParameterChanged=!0,this._wrapS=e)}},{key:"wrapT",get:function(){return this._wrapT},set:function(e){this._wrapT!==e&&(this._texParameterChanged=!0,this._wrapT=e)}}]),t}(f.default);t.default=c,c._filtersNeedsMipmap=[WebGLRenderingContext.LINEAR_MIPMAP_LINEAR,WebGLRenderingContext.LINEAR_MIPMAP_NEAREST,WebGLRenderingContext.NEAREST_MIPMAP_LINEAR,WebGLRenderingContext.NEAREST_MIPMAP_NEAREST]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(69),l=r(s),f=n(1),c=r(f),d=n(9),h=r(d),p=function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{s(r.next(e))}catch(e){i(e)}}function u(e){try{s(r.throw(e))}catch(e){i(e)}}function s(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(a,u)}s((r=r.apply(e,t)).next())})},_=function(e){function t(){o(this,t);var e=i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return e.materialArgs={},e.ready=!1,e.useMaterial=!1,e}return a(t,e),u(t,[{key:"getDrawPriorty",value:function(e){if(!this.ready)return Number.MAX_VALUE;var t=l.default[this._drawOrder?this._drawOrder:this.material.techniques.default.drawOrder];if(void 0===t)throw new Error('Specified drawing order "'+this.material.techniques.default.drawOrder+'" is not defined');return t.descending?(1-e/1e4)*t.priorty:e/1e4*t.priorty}},{key:"$mount",value:function(){this.getAttributeRaw("material").watch(this._onMaterialChanged),this.companion.get("loader").register(this._onMaterialChanged()),this.getAttributeRaw("drawOrder").boundTo("_drawOrder")}},{key:"_onMaterialChanged",value:function(){return p(this,void 0,void 0,regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.getAttribute("material"),void 0!==t){e.next=4;break}return this.useMaterial=!1,e.abrupt("return");case 4:this.useMaterial=!0,this._materialComponent?this._prepareExternalMaterial(t):this._prepareInternalMaterial(t);case 6:case"end":return e.stop()}},e,this)}))}},{key:"_prepareExternalMaterial",value:function(e){return p(this,void 0,void 0,regeneratorRuntime.mark(function t(){var n,r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=this.companion.get("loader"),n.register(e),t.next=4,e;case 4:r=t.sent,this.material=r,this.materialArgs=this._materialComponent.materialArgs,this.ready=!0;case 8:case"end":return t.stop()}},t,this)}))}},{key:"_prepareInternalMaterial",value:function(e){return p(this,void 0,void 0,regeneratorRuntime.mark(function t(){var n,r,o,i,a,u=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n=this.companion.get("loader"),n.register(e),e){t.next=4;break}return t.abrupt("return");case 4:return t.next=6,e;case 6:r=t.sent,this.material=r;for(o in this.material.argumentDeclarations)this.__addAtribute(o,this.material.argumentDeclarations[o]),this.getAttributeRaw(o).boundTo(o,this.material.arguments);i=function(e){u.__addAtribute(e,u.material.macroDeclarations[e]),u.getAttributeRaw(e).watch(function(t){u.material.setMacroValue(e,t)},!0)};for(a in this.material.macroDeclarations)i(a);this.ready=!0;case 12:case"end":return t.stop()}},t,this)}))}}],[{key:"rewriteDefaultMaterial",value:function(e){e!==t._defaultMaterial&&(t._defaultMaterial=e,h.default.componentDeclarations.get("MaterialContainer").attributes.material.default="new("+e+")")}},{key:"defaultMaterial",get:function(){return this._defaultMaterial}}]),t}(c.default);t.default=_,_.attributes={material:{converter:"Material",default:"new(unlit)",componentBoundTo:"_materialComponent"},drawOrder:{converter:"String",default:null}},_._defaultMaterial="unlit"},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=t.UniformResolverRegistry=function(){function e(){n(this,e),this._generators={}}return r(e,[{key:"add",value:function(e,t){if("function"!=typeof t)throw new Error("secound argument of add must be function");this._generators[e.toUpperCase()]=t}},{key:"generateRegisterers",value:function(e,t){var n=[],r=[];for(var o in t.uniforms){var i=t.uniforms[o],a=i.semantic,u=this._generators[a];if(!u)throw new Error("There was no suitable registerer for specified semantic "+a);var s=u(i,e);"function"==typeof s?n.push(s):(n.push(s.register),s.dispose&&r.push(s.dispose))}return{registerers:n,disposers:r}}}]),e}();t.default=new o},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.math.Matrix},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.math.Vector3},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(71),l=r(s),f=n(1),c=r(f),d=function(e){function t(){o(this,t);var e=i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return e.sceneDescription={},e.queueRegistory=new l.default,e}return a(t,e),u(t,[{key:"updateScene",value:function(e){this._lastUpdateIndex!==e&&(this.node.broadcastMessage("update",this.sceneDescription),this._lastUpdateIndex=e)}}]),t}(c.default);t.default=d,d.attributes={}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(8),u=r(a),s=n(78),l=r(s),f=n(63),c=r(f),d=function(){function e(t){o(this,e),this.gl=t,this.buffers=[],this.indices={},this.accessors={},this.aabb=new l.default([u.default.Zero])}return i(e,[{key:"addAttributes",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:WebGLRenderingContext.STATIC_DRAW;e=this._ensureToBeVertexBuffer(e,n);var r=this.buffers.length;this.buffers.push(e);for(var o in t){var i=t[o];if(i.bufferIndex=r,void 0===i.size)throw new Error('Accessor specified with the semantics "'+o+'" is not containing size as paranmeter.');void 0===i.type&&(i.type=WebGLRenderingContext.FLOAT),void 0===i.stride&&(i.stride=i.size*this._attribTypeToByteSize(i.type)),void 0===i.offset&&(i.offset=0),this.accessors[o]=i}}},{key:"addIndex",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:WebGLRenderingContext.TRIANGLES,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;if(!o){if(t instanceof c.default||t instanceof ArrayBuffer||t instanceof DataView)throw new Error("The argument 'count' is necessary if you specified buffer with an instance of Buffer or ArrayBuffer");o=t.length}0===i&&(i=this._indexTypeFromCount(o)),t=this._ensureToBeIndexBuffer(t,i),this.indices[e]={byteOffset:r,byteSize:this._indexTypeToByteSize(i),type:i,topology:n,count:o,index:t}}},{key:"drawByDefault",value:function(t,n,r){var o=this,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Number.MAX_VALUE,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;n.forEach(function(t){e.bindBufferToAttribute(o,r,t,t)}),e.drawWithCurrentVertexBuffer(this,t,i,a)}},{key:"_ensureToBeVertexBuffer",value:function(e,t){if(!(e instanceof c.default)){var n=e;Array.isArray(n)&&(n=new Float32Array(n)),e=new c.default(this.gl,WebGLRenderingContext.ARRAY_BUFFER,t),e.update(n)}return e}},{key:"_ensureToBeIndexBuffer",value:function(e,t){if(e instanceof c.default){if(e.target!==WebGLRenderingContext.ELEMENT_ARRAY_BUFFER)throw new Error("The usage of buffer specified as index buffer is not ELEMENT_ARRAY_BUFFER")}else{var n=e;Array.isArray(n)&&(n=new(this._indexTypeToArrayConstructor(t))(n)),e=new c.default(this.gl,WebGLRenderingContext.ELEMENT_ARRAY_BUFFER,WebGLRenderingContext.STATIC_DRAW),e.update(n)}return e}},{key:"_indexTypeFromCount",value:function(e){if(e<256)return WebGLRenderingContext.UNSIGNED_BYTE;if(e<65536)return WebGLRenderingContext.UNSIGNED_SHORT;if(e<4294967296)return WebGLRenderingContext.UNSIGNED_INT;throw new Error("Index count exceeds 4,294,967,296. WebGL can not handle such a big index buffer")}},{key:"_indexTypeToArrayConstructor",value:function(e){switch(e){case WebGLRenderingContext.UNSIGNED_BYTE:return Uint8Array;case WebGLRenderingContext.UNSIGNED_SHORT:return Uint16Array;case WebGLRenderingContext.UNSIGNED_INT:return Uint32Array;default:throw new Error("Unsupported index type")}}},{key:"_indexTypeToByteSize",value:function(e){switch(e){case WebGLRenderingContext.UNSIGNED_BYTE:return 1;case WebGLRenderingContext.UNSIGNED_SHORT:return 2;case WebGLRenderingContext.UNSIGNED_INT:return 4;default:throw new Error("Unsupported index type")}}},{key:"_attribTypeToByteSize",value:function(e){switch(e){case WebGLRenderingContext.FLOAT:return 4;default:throw new Error('Unsupported attribute variable type "'+e+'"')}}}],[{key:"bindBufferToAttribute",value:function(e,t,n,r){var o=t.findAttributeLocation(n);if(o<0)return!1;var i=e.accessors[r];if(!i)throw new Error('Specified buffer "'+r+' was not found on this geometry while attempt to bind "'+n+'" of attribute variables.\n\n\t  All of the vertex buffer available on this geometry is '+Object.keys(e.accessors)+'"');var a=e.buffers[i.bufferIndex];return a.bind(),t.gl.vertexAttribPointer(o,i.size,i.type,!1,i.stride,i.offset),!0}},{key:"drawWithCurrentVertexBuffer",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=e.indices[t];if(void 0===o)throw new Error('Specified index buffer "'+t+'" was not found on this geometry.All of the index buffer available on this geometry is "'+Object.keys(e.indices)+'"');o.index.bind(),o.index.gl.drawElements(o.topology,Math.min(o.count,n),o.type,Math.min(r*o.byteSize+o.byteOffset,(o.count-1)*o.byteSize))}}]),e}();t.default=d,d._lastGeometry=new Map},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(){function e(t){n(this,e),this.gl=t}return r(e,[{key:"instanciate",value:function(t,n){var r=e.factoryDelegates[t];if(!r)throw new Error("Can not instanciate unknown geometry type "+t);var o=r(this.gl,n);return void 0!==e.factoryExtentions[t]&&e.factoryExtentions[t].forEach(function(e){return e(o,n)}),o}},{key:"instanciateAsDefault",value:function(t){var n=e.factoryArgumentDeclarations[t],r={};for(var o in n){var i=n[o];r[o]=i.default}return this.instanciate(t,r)}}],[{key:"addType",value:function(t,n,r){e.factoryDelegates[t]=r,e.factoryArgumentDeclarations[t]=n}},{key:"extend",value:function(t,n){void 0===e.factoryExtentions[t]&&(e.factoryExtentions[t]=[]),e.factoryExtentions[t].push(n)}}]),e}();t.default=o,o.factoryDelegates={},o.factoryArgumentDeclarations={},o.factoryExtentions={}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(74),u=r(a),s=n(58),l=r(s),f=n(26),c=r(f),d=n(59),h=r(d),p=n(80),_=r(p),b=function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{s(r.next(e))}catch(e){i(e)}}function u(e){try{s(r.throw(e))}catch(e){i(e)}}function s(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(a,u)}s((r=r.apply(e,t)).next())})},v=function(){function e(t){o(this,e),this.gl=t,this.shaderHeader=e.defaultShaderHeader,this.macro=new l.default}return i(e,[{key:"instanciate",value:function(t){return b(this,void 0,void 0,regeneratorRuntime.mark(function n(){return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!e.factories[t]){n.next=4;break}return n.abrupt("return",e.factories[t](this));case 4:return n.next=6,this._waitForRegistered(t);case 6:return n.abrupt("return",n.sent);case 7:case"end":return n.stop()}},n,this)}))}},{key:"_waitForRegistered",value:function(t){var n=this;return new Promise(function(r){e._onRegister(t,function(){r(e.factories[t](n))})})}}],[{key:"addMaterialType",value:function(t,n){e.factories[t]=n,e.registerdHandlers[t]&&e.registerdHandlers[t].forEach(function(e){return e()})}},{key:"addSORTMaterial",value:function(t,n){return b(this,void 0,void 0,regeneratorRuntime.mark(function r(){var o;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,u.default.parse(n);case 2:o=r.sent,e.addMaterialType(t,function(e){return new h.default(e.gl,o)});case 4:case"end":return r.stop()}},r,this)}))}},{key:"addSORTMaterialFromURL",value:function(t,n){return b(this,void 0,void 0,regeneratorRuntime.mark(function r(){var o;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,c.default.resolve(n);
case 2:return o=r.sent,r.next=5,e.addSORTMaterial(t,o);case 5:case"end":return r.stop()}},r,this)}))}},{key:"_onRegister",value:function(t,n){e.registerdHandlers[t]?e.registerdHandlers[t].push(n):e.registerdHandlers[t]=[n]}}]),e}();t.default=v,v.defaultShaderHeader=_.default,v.factories={},v.registerdHandlers={}},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.math.Vector4},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{s(r.next(e))}catch(e){i(e)}}function u(e){try{s(r.throw(e))}catch(e){i(e)}}function s(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(a,u)}s((r=r.apply(e,t)).next())})},i=function(){function e(t){n(this,e),this.toAbsolute=t,this.cache={},this.resolvers={}}return r(e,[{key:"resolve",value:function(e,t){return o(this,void 0,void 0,regeneratorRuntime.mark(function n(){var r,o;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(r=this.toAbsolute(e),!this._cached(r)){n.next=5;break}return n.abrupt("return",this.cache[r]);case 5:if(!this._resolving(r)){n.next=11;break}return n.next=8,this.resolvers[r];case 8:return n.abrupt("return",n.sent);case 11:return this.resolvers[r]=t(r),n.next=14,this.resolvers[r];case 14:return o=n.sent,this._resolved(r,o),n.abrupt("return",o);case 17:case"end":return n.stop()}},n,this)}))}},{key:"_cached",value:function(e){return"undefined"!=typeof this.cache[e]}},{key:"_resolving",value:function(e){return"undefined"!=typeof this.resolvers[e]}},{key:"_resolved",value:function(e,t){delete this.resolvers[e],this.cache[e]=t}}]),e}();t.default=i},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(15),l=r(s),f=function(e){function t(){return o(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,t._toAbsolute))}return a(t,e),u(t,null,[{key:"_toAbsolute",value:function(e){var t=document.createElement("a");return t.href=e,t.protocol+"//"+t.host+t.pathname+t.search+t.hash}}]),t}(l.default);t.default=f},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.ImageResolver=void 0;var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var a=o.get;if(void 0!==a)return a.call(r)},l=n(16),f=r(l),c=t.ImageResolver=function(e){function t(){return o(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,e),u(t,[{key:"resolve",value:function(e){return s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"resolve",this).call(this,e,function(e){return new Promise(function(t,n){var r=new Image;r.onload=function(){t(r)},r.onerror=function(e){n(e)},r.src=e})})}}]),t}(f.default);t.default=new c},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(1),l=r(s),f=function(e){function t(){o(this,t);var e=i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return e._loopActions=[],e._loopIndex=0,e}return a(t,e),u(t,[{key:"$awake",value:function(){var e=this;this.getAttributeRaw("loopEnabled").watch(function(t){t&&e._begin()}),this._registerNextLoop=window.requestAnimationFrame?function(){window.requestAnimationFrame(e._loop.bind(e))}:function(){window.setTimeout(e._loop.bind(e),1e3/60)}}},{key:"register",value:function(e,t){this._loopActions.push({action:e,priorty:t}),this._loopActions.sort(function(e,t){return e.priorty-t.priorty})}},{key:"_begin",value:function(){this._registerNextLoop()}},{key:"_loop",value:function(){var e=this;this.node.emit("loop",{loopIndex:this._loopIndex}),this._loopActions.forEach(function(t){return t.action(e._loopIndex)}),this._loopIndex++,this._registerNextLoop()}}]),t}(l.default);f.attributes={loopEnabled:{default:!1,converter:"Boolean"}},t.default=f},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(1),l=r(s),f=function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{s(r.next(e))}catch(e){i(e)}}function u(e){try{s(r.throw(e))}catch(e){i(e)}}function s(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(a,u)}s((r=r.apply(e,t)).next())})},c=function(e){function t(){o(this,t);var e=i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return e.materialArgs={},e}return a(t,e),u(t,[{key:"$mount",value:function(){var e=this.getAttribute("type");e&&(this.materialPromise=this.companion.get("MaterialFactory").instanciate(e),this._registerAttributes())}},{key:"_registerAttributes",value:function(){return f(this,void 0,void 0,regeneratorRuntime.mark(function e(){var t,n,r,o=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.materialPromise;case 2:this.material=e.sent;for(t in this.material.argumentDeclarations)this.__addAtribute(t,this.material.argumentDeclarations[t]),this.getAttributeRaw(t).boundTo(t,this.material.arguments);n=function(e){o.__addAtribute(e,o.material.macroDeclarations[e]),o.getAttributeRaw(e).watch(function(t){o.material.setMacroValue(e,t)},!0)};for(r in this.material.macroDeclarations)n(r);this.ready=!0;case 7:case"end":return e.stop()}},e,this)}))}}]),t}(l.default);t.default=c,c.attributes={type:{converter:"String",default:null}}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(4),l=r(s),f=n(1),c=r(f),d=n(17),h=r(d),p=function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{s(r.next(e))}catch(e){i(e)}}function u(e){try{s(r.throw(e))}catch(e){i(e)}}function s(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(a,u)}s((r=r.apply(e,t)).next())})},_=function(e){function t(){return o(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,e),u(t,[{key:"$mount",value:function(){var e=this,t=this.getAttribute("src");this.texture=new l.default(this.companion.get("gl")),this.texture.magFilter=this.getAttribute("magFilter"),this.texture.minFilter=this.getAttribute("minFilter"),this.texture.wrapT=this.getAttribute("wrapT"),this.texture.wrapS=this.getAttribute("wrapS"),this.getAttributeRaw("magFilter").watch(function(t){return e.texture.magFilter=t}),this.getAttributeRaw("minFilter").watch(function(t){return e.texture.minFilter=t}),this.getAttributeRaw("wrapS").watch(function(t){return e.texture.wrapS=t}),this.getAttributeRaw("wrapT").watch(function(t){return e.texture.wrapT=t}),t&&this._loadTask(t)}},{key:"_loadTask",value:function(e){return p(this,void 0,void 0,regeneratorRuntime.mark(function t(){var n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,h.default.resolve(e);case 2:n=t.sent,this.texture.update(n);case 4:case"end":return t.stop()}},t,this)}))}}]),t}(c.default);t.default=_,_.attributes={src:{converter:"String",default:null},minFilter:{converter:"Enum",default:"LINEAR",table:{LINEAR:WebGLRenderingContext.LINEAR,NEAREST:WebGLRenderingContext.NEAREST,NEAREST_MIPMAP_NEAREST:WebGLRenderingContext.NEAREST_MIPMAP_NEAREST,NEAREST_MIPMAP_LINEAR:WebGLRenderingContext.NEAREST_MIPMAP_LINEAR,LINEAR_MIPMAP_NEAREST:WebGLRenderingContext.LINEAR_MIPMAP_NEAREST,LINEAR_MIPMAP_LINEAR:WebGLRenderingContext.LINEAR_MIPMAP_LINEAR}},magFilter:{converter:"Enum",default:"LINEAR",table:{LINEAR:WebGLRenderingContext.LINEAR,NEAREST:WebGLRenderingContext.NEAREST}},wrapS:{converter:"Enum",default:"REPEAT",table:{REPEAT:WebGLRenderingContext.REPEAT,MIRRORED_REPEAT:WebGLRenderingContext.MIRRORED_REPEAT,CLAMP_TO_EDGE:WebGLRenderingContext.CLAMP_TO_EDGE}},wrapT:{converter:"Enum",default:"REPEAT",table:{REPEAT:WebGLRenderingContext.REPEAT,MIRRORED_REPEAT:WebGLRenderingContext.MIRRORED_REPEAT,CLAMP_TO_EDGE:WebGLRenderingContext.CLAMP_TO_EDGE}}}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var a=o.get;if(void 0!==a)return a.call(r)},l=n(22),f=r(l),c=n(4),d=r(c),h=n(2),p=r(h),_=function(e){function t(e){o(this,t);var n=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.fbo=e.createFramebuffer(),n}return a(t,e),u(t,[{key:"update",value:function(e,t,n){if(this.gl.bindFramebuffer(WebGLRenderingContext.FRAMEBUFFER,this.fbo),e instanceof d.default){if("undefined"==typeof n&&(n=0),"undefined"==typeof t&&(t=0),this.gl.framebufferTexture2D(WebGLRenderingContext.FRAMEBUFFER,WebGLRenderingContext.COLOR_ATTACHMENT0+n,WebGLRenderingContext.TEXTURE_2D,e.texture,t),this.gl.checkFramebufferStatus(WebGLRenderingContext.FRAMEBUFFER)!==WebGLRenderingContext.FRAMEBUFFER_COMPLETE)throw new Error("INCOMPLETE framebuffer")}else if(e instanceof f.default){var r=t;"undefined"==typeof t&&(r=WebGLRenderingContext.DEPTH_ATTACHMENT),this.gl.framebufferRenderbuffer(WebGLRenderingContext.FRAMEBUFFER,r,WebGLRenderingContext.RENDERBUFFER,e.renderBuffer)}this.gl.bindFramebuffer(WebGLRenderingContext.FRAMEBUFFER,null)}},{key:"bind",value:function(){this.gl.bindFramebuffer(WebGLRenderingContext.FRAMEBUFFER,this.fbo)}},{key:"destroy",value:function(){s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",this).call(this),this.gl.deleteFramebuffer(this.fbo)}}]),t}(p.default);t.default=_},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var a=o.get;if(void 0!==a)return a.call(r)},l=n(2),f=r(l),c=function(e){function t(e){o(this,t);var n=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.renderBuffer=e.createRenderbuffer(),n}return a(t,e),u(t,[{key:"update",value:function(e,t,n){this.gl.bindRenderbuffer(WebGLRenderingContext.RENDERBUFFER,this.renderBuffer),this.gl.renderbufferStorage(WebGLRenderingContext.RENDERBUFFER,e,t,n),this.valid=!0}},{key:"bind",value:function(){this.gl.bindRenderbuffer(WebGLRenderingContext.RENDERBUFFER,this.renderBuffer)}},{key:"destroy",value:function(){this.gl.deleteRenderbuffer(this.renderBuffer),s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",this).call(this)}}]),t}(f.default);t.default=c},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(){function e(){n(this,e)}return r(e,null,[{key:"getPow2Size",value:function(e,t){var n=Math.pow(2,Math.log(e)/Math.LN2|0),r=Math.pow(2,Math.log(t)/Math.LN2|0);return{width:n,height:r}}}]),e}();t.default=o},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.math.GLM},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(88),l=r(s),f=function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{s(r.next(e))}catch(e){i(e)}}function u(e){try{s(r.throw(e))}catch(e){i(e)}}function s(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(a,u)}s((r=r.apply(e,t)).next())})},c=function(e){function t(){o(this,t);var e=i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return e.registerCount=0,e.loadCount=0,e.completeCount=0,e.errorCount=0,e.promise=new Promise(function(t){e._resolve=t}),e}return a(t,e),u(t,[{key:"register",value:function(e){var t=this;return this.registerCount++,new Promise(function(n,r){(function(){return f(this,void 0,void 0,regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.t0=n,t.next=4,e;case 4:t.t1=t.sent,(0,t.t0)(t.t1),this.loadCount++,t.next=13;break;case 9:t.prev=9,t.t2=t.catch(0),r(t.t2),this.errorCount++;case 13:this.completeCount++,this._checkLoadCompleted();case 15:case"end":return t.stop()}},t,this,[[0,9]])}))}).bind(t)()})}},{key:"_checkLoadCompleted",value:function(){this.emit("progress",this),this.registerCount===this.completeCount&&this._resolve()}}]),t}(l.default);t.default=c},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.TextFileResolver=void 0;var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var a=o.get;if(void 0!==a)return a.call(r)},l=n(16),f=r(l),c=t.TextFileResolver=function(e){function t(){return o(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,e),u(t,[{key:"resolve",value:function(e){return s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"resolve",this).call(this,e,function(e){return new Promise(function(t,n){var r=new XMLHttpRequest;r.open("GET",e),r.onload=function(e){t(r.responseText)},r.onerror=function(e){n(e)},r.send()})})}}]),t}(f.default);t.default=new c},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(9),l=r(s),f=n(25),c=r(f),d=n(1),h=r(d),p=n(92),_=r(p),b=function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{s(r.next(e))}catch(e){i(e)}}function u(e){try{s(r.throw(e))}catch(e){i(e)}}function s(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(a,u)}s((r=r.apply(e,t)).next())})},v=function(e){function t(){o(this,t);var e=i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return e.loader=new c.default,e}return a(t,e),u(t,[{key:"$treeInitialized",value:function(){this.getAttribute("autoStart")&&this._autoStart(),this._documentResolver()}},{key:"$awake",value:function(){var e=this;this.companion.set(l.default.ns(this.name.ns)("loader"),this.loader),this.loader.register(new Promise(function(t){e._documentResolver=t}));var t=this.companion.get("canvasContainer");if(this.getAttribute("enableLoader")){var n=document.createElement("div");n.innerHTML=_.default,n.style.width=n.style.height="100%",t.appendChild(n),this._loaderElement=n}}},{key:"_autoStart",value:function(){return b(this,void 0,void 0,regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.loader.promise;case 2:this._loaderElement&&this._loaderElement.remove(),this.node.emit("asset-load-completed"),this.tree("goml").setAttribute("loopEnabled",!0);case 5:case"end":return e.stop()}},e,this)}))}}]),t}(h.default);t.default=v,v.attributes={loadingProgress:{default:0,converter:"Number"},autoStart:{default:!0,converter:"Boolean"},enableLoader:{default:!0,converter:"Boolean"}}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(24),l=r(s),f=n(14),c=r(f),d=n(8),h=r(d),p=n(7),_=r(p),b=n(70),v=r(b),m=n(3),y=r(m),g=n(10),w=r(g),E=n(1),R=r(E),O=l.default.vec3,C=l.default.vec4,x=l.default.mat4,T=function(e){function t(){o(this,t);var e=i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return e._renderQueue=new v.default,e._eyeCache=h.default.Zero,e._lookAtCache=h.default.Zero,e._upCache=h.default.Zero,e.__viewMatrix=new _.default,e.__projectionMatrix=new _.default,e.__invProjectionMatrix=new _.default,e.__projectionViewMatrix=new _.default,e._orthographic=!1,e}return a(t,e),u(t,[{key:"$awake",value:function(){var e=this;this.transform=this.node.getComponent(y.default),this.updateTransform(this.transform),this.getAttributeRaw("far").watch(function(t){e.Far=t},!0),this.getAttributeRaw("near").watch(function(t){e.Near=t},!0),this.getAttributeRaw("fovy").watch(function(t){e.Fovy=t},!0),this.getAttributeRaw("aspect").watch(function(t){e.Aspect=t},!0),this.getAttributeRaw("orthoSize").watch(function(t){e.OrthoSize=t},!0),this.getAttributeRaw("orthogonal").watch(function(t){e.OrthographicMode=t},!0),this.getAttributeRaw("autoAspect").boundTo("_autoAspect")}},{key:"$mount",value:function(){this.containedScene=t._findContainedScene(this.node),this.containedScene.queueRegistory.registerQueue(this._renderQueue),this.node.on("transformUpdated",this.updateTransform.bind(this))}},{key:"$unmount",value:function(){this.containedScene.queueRegistory.unregisterQueue(this._renderQueue),this.containedScene=null}},{key:"updateContainedScene",value:function(e){this.containedScene&&this.containedScene.updateScene(e)}},{key:"renderScene",value:function(e){this.containedScene&&(this._justifyAspect(e),e.sceneDescription=this.containedScene.sceneDescription,e.defaultTexture=this.companion.get("defaultTexture"),this._renderQueue.renderAll(e,!0,e.loopIndex))}},{key:"_justifyAspect",value:function(e){if(this._autoAspect){var t=e.viewport.Width/e.viewport.Height;this._aspectCache!==t&&(this.setAttribute("aspect",t),this._aspectCache=t)}}},{key:"updateTransform",value:function(e){O.transformMat4(this._eyeCache.rawElements,h.default.Zero.rawElements,e.globalTransform.rawElements),C.transformMat4(this._lookAtCache.rawElements,t._frontOrigin.rawElements,e.globalTransform.rawElements),O.add(this._lookAtCache.rawElements,this._lookAtCache.rawElements,this._eyeCache.rawElements),C.transformMat4(this._upCache.rawElements,t._upOrigin.rawElements,e.globalTransform.rawElements),x.lookAt(this.__viewMatrix.rawElements,this._eyeCache.rawElements,this._lookAtCache.rawElements,this._upCache.rawElements),x.mul(this.__projectionViewMatrix.rawElements,this.__projectionMatrix.rawElements,this.__viewMatrix.rawElements)}},{key:"_recalculateProjection",value:function(){this._orthographic?x.ortho(this.__projectionMatrix.rawElements,-this._orthoSize*this._aspect,this._orthoSize*this._aspect,-this._orthoSize,this._orthoSize,this._near,this._far):x.perspective(this.__projectionMatrix.rawElements,this._fovy,this._aspect,this._near,this._far),x.mul(this.__projectionViewMatrix.rawElements,this.__projectionMatrix.rawElements,this.__viewMatrix.rawElements),x.invert(this.__invProjectionMatrix.rawElements,this.__projectionMatrix.rawElements)}},{key:"ViewMatrix",get:function(){return this.__viewMatrix}},{key:"ProjectionMatrix",get:function(){return this.__projectionMatrix}},{key:"InvProjectionMatrix",get:function(){return this.__invProjectionMatrix}},{key:"ProjectionViewMatrix",get:function(){return this.__projectionViewMatrix}},{key:"Far",get:function(){return this._far},set:function(e){this._far=e,this._recalculateProjection()}},{key:"Near",get:function(){return this._near},set:function(e){this._near=e,this._recalculateProjection()}},{key:"Aspect",get:function(){return this._aspect},set:function(e){this._aspect=e,this._recalculateProjection()}},{key:"Fovy",get:function(){return this._fovy},set:function(e){this._fovy=e,this._recalculateProjection()}},{key:"OrthoSize",get:function(){return this._orthoSize},set:function(e){this._orthoSize=e}},{key:"OrthographicMode",set:function(e){this._orthographic=e,this._recalculateProjection()},get:function(){return this._orthographic}}],[{key:"_findContainedScene",value:function(e){if(e.parent){var n=e.parent.getComponent(w.default);return n?n:t._findContainedScene(e.parent)}return null}}]),t}(R.default);t.default=T,T._frontOrigin=new c.default(0,0,-1,0),T._upOrigin=new c.default(0,1,0,0),T.attributes={fovy:{default:"45d",converter:"Angle2D"},near:{default:.01,converter:"Number"},far:{default:100,converter:"Number"},aspect:{default:1.6,converter:"Number"},autoAspect:{default:!0,converter:"Boolean"},orthoSize:{default:100,converter:"Number"},orthogonal:{default:!1,converter:"Boolean"}}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u,s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=n(90),f=r(l),c=n(4),d=r(c),h=n(64),p=r(h),_=n(1),b=r(_),v=f.default.ns("HTTP://GRIMOIRE.GL/NS/DEFAULT");!function(e){e[e.Aspect=0]="Aspect",e[e.Fit=1]="Fit",e[e.Manual=2]="Manual"}(u||(u={}));var m=function(e){function t(){return o(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,e),s(t,[{key:"$awake",value:function(){var e=this;if(this._scriptTag=this.companion.get("scriptElement"),!this._isContainedInBody(this._scriptTag))throw new Error("goml script should have body as ancesotor to instanciate canvas element in the location");this._generateCanvas(this._scriptTag),this.getAttributeRaw("width").watch(function(t){e._resize()}),this.getAttributeRaw("height").watch(function(t){e._resize()})}},{key:"_generateCanvas",value:function(e){var t=this;this._autoFixForBody(e),this.canvas=document.createElement("canvas"),window.addEventListener("resize",function(){return t._onWindowResize()}),this._configureCanvas(this.canvas,e);var n=this._getContext(this.canvas);return this._defaultTexture=new d.default(n),this._defaultTexture.update(0,1,1,0,WebGLRenderingContext.RGBA,WebGLRenderingContext.UNSIGNED_BYTE,new Uint8Array([0,0,0,0])),this.companion.set(v("gl"),n),this.companion.set(v("canvasElement"),this.canvas),
this.companion.set(v("GLExtRequestor"),new p.default(n)),this.companion.set(v("defaultTexture"),this._defaultTexture),this.canvas}},{key:"_resize",value:function(e){var t=(this.companion.get("canvasElement"),this.getAttribute("width")),n=this.getAttribute("height");if(this._widthMode=this._asResizeMode(t),this._heightMode=this._asResizeMode(n),this._widthMode===this._heightMode&&this._widthMode===u.Aspect)throw new Error("Width and height could not have aspect mode in same time!");this._widthMode===u.Aspect&&(this._ratio=t.aspect),this._heightMode===u.Aspect&&(this._ratio=n.aspect),this._widthMode===u.Manual&&this._applyManualWidth(t.size,e),this._heightMode===u.Manual&&this._applyManualHeight(n.size,e),this._onWindowResize(e)}},{key:"_onWindowResize",value:function(e){var t=this._getParentSize();this._widthMode===u.Fit&&this._applyManualWidth(t.width,e),this._heightMode===u.Fit&&(0===t.height&&f.default.debug&&console.warn("Canvas height parameter specified as fit and height of parent element is 0.\n This is possibly the reason you haven't set css to html or body element."),this._applyManualHeight(t.height,e))}},{key:"_applyManualWidth",value:function(e,t){e!==this.canvas.width&&(this.canvas.width=e,this._canvasContainer.style.width=e+"px",t||this.node.broadcastMessage(1,"resizeCanvas"),this._heightMode===u.Aspect&&this._applyManualHeight(e/this._ratio,t))}},{key:"_applyManualHeight",value:function(e,t){e!==this.canvas.height&&(this.canvas.height=e,this._canvasContainer.style.height=e+"px",t||this.node.broadcastMessage(1,"resizeCanvas"),this._widthMode===u.Aspect&&this._applyManualWidth(e*this._ratio,t))}},{key:"_getParentSize",value:function(){var e=this._canvasContainer.parentElement,t=e.getBoundingClientRect();return t}},{key:"_asResizeMode",value:function(e){return"fit"===e.mode?u.Fit:"aspect"===e.mode?u.Aspect:u.Manual}},{key:"_configureCanvas",value:function(e,t){e.style.position="absolute",e.style.top="0px",e.style.left="0px",this._canvasContainer=document.createElement("div"),this._canvasContainer.style.position="relative",this._canvasContainer.style.overflow="hidden",this._canvasContainer.appendChild(e),this.getAttribute("containerId")&&(this._canvasContainer.id=this.getAttribute("containerId")),this.getAttribute("containerClass")&&(this._canvasContainer.className=this.getAttribute("containerClass")),this.companion.set(v("canvasContainer"),this._canvasContainer),t.parentElement.insertBefore(this._canvasContainer,t.nextSibling),this._resize(!0)}},{key:"_getContext",value:function(e){var t=e.getContext("webgl");return t||(t=e.getContext("webgl-experimental")),t}},{key:"_isContainedInBody",value:function(e){return!!e.parentElement&&("BODY"===e.parentNode.nodeName||this._isContainedInBody(e.parentElement))}},{key:"_autoFixForBody",value:function(e){if("BODY"===e.parentElement.nodeName){var t=document.body.getBoundingClientRect();0===t.height&&(document.body.style.height="100%",document.body.parentElement.style.height="100%")}}}]),t}(b.default);m.attributes={width:{default:"fit",converter:"CanvasSize"},height:{default:"fit",converter:"CanvasSize"},containerId:{default:"",converter:"String"},containerClass:{default:"gr-container",converter:"String"}},t.default=m},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(1),l=r(s),f=function(e){function t(){o(this,t);var e=i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return e._fullscreen=!1,e}return a(t,e),u(t,[{key:"$awake",value:function(){var e=this;this.getAttributeRaw("fullscreen").watch(function(t){e._fullscreen!==t&&(e._fullscreen=t,e._switchFullscreen())})}},{key:"_switchFullscreen",value:function(){this._fullscreen?this.requestFullscreen(this.getAttribute("fullscreenTarget")||this.companion.get("canvasContainer")):this.exitFullscreen()}},{key:"requestFullscreen",value:function(e){if(e.webkitRequestFullscreen)e.webkitRequestFullscreen();else if(e.mozRequestFullScreen)e.mozRequestFullScreen();else if(e.msRequestFullscreen)e.msRequestFullscreen();else{if(!e.requestFullscreen)return void console.error("");e.requestFullscreen()}}},{key:"exitFullscreen",value:function(){document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen?document.msExitFullscreen():document.cancelFullScreen?document.cancelFullScreen():document.exitFullscreen&&document.exitFullscreen()}}]),t}(l.default);t.default=f,f.attributes={fullscreen:{converter:"Boolean",default:!1},fullscreenTarget:{converter:"String",default:null}}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(12),l=r(s),f=n(1),c=r(f),d=function(e){function t(){return o(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,e),u(t,[{key:"$mount",value:function(){var e=this.getAttribute("type");if(e){var t=this.companion.get("GeometryFactory"),n=l.default.factoryArgumentDeclarations[e],r={};for(var o in n)this.__addAtribute(o,n[o]),r[o]=this.getAttribute(o);this.geometry=t.instanciate(e,r);var i=this.companion.get("GeometryRegistory"),a=this.getAttribute("name");if(!a)throw new Error("Name was not specified");i.addGeometry(a,this.geometry)}}}]),t}(c.default);t.default=d,d.attributes={type:{converter:"String",default:null},name:{converter:"String",default:null}}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(12),l=r(s),f=n(1),c=r(f),d=n(9),h=r(d),p=function(e){function t(){o(this,t);var e=i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return e._geometries={},e}return a(t,e),u(t,[{key:"$awake",value:function(){this._factory=new l.default(this.companion.get("gl")),this.companion.set(this.name,this),this.companion.set(h.default.ns(this.name.ns)("GeometryFactory"),this._factory);var e=!0,t=!1,n=void 0;try{for(var r,o=this.getAttribute("defaultGeometry")[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var i=r.value;this.addGeometry(i,this._factory.instanciateAsDefault(i))}}catch(e){t=!0,n=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw n}}}},{key:"addGeometry",value:function(e,t){this._geometries[e]=t}},{key:"removeGeometry",value:function(e){this._geometries[e]&&delete this._geometries[e]}},{key:"getGeometry",value:function(e){return this._geometries[e]}}]),t}(c.default);t.default=p,p.attributes={defaultGeometry:{converter:"StringArray",default:["quad","cube","sphere"]}}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(3),l=r(s),f=n(1),c=r(f),d=n(14),h=r(d),p=n(7),_=r(p),b=function(e){function t(){o(this,t);var e=i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return e._isFirstCall=!0,e}return a(t,e),u(t,[{key:"$awake",value:function(){this._canvasContainer=this.companion.get("canvasContainer"),this._currentTransform=this.node.getComponent(l.default)}},{key:"$mount",value:function(){this._canvasContainer=this.companion.get("canvasContainer"),this._currentTransform=this.node.getComponent(l.default),this.node.on("render",this._onRender.bind(this))}},{key:"$treeInitialized",value:function(){var e=this;this.getAttributeRaw("targetRenderer").watch(function(t){e._rendererQuery!==t&&e._onRendererChanged()},!0),this.getAttributeRaw("htmlQuery").watch(function(t){e._onQueryChanged(t)},!0)}},{key:"_onRender",value:function(e){if(this._isFirstCall&&(this._onRendererChanged(),this._isFirstCall=!1),this._queriedElement&&e.caller.node===this._targetNode){var t=e.viewport,n=_.default.transform(this._currentTransform.calcPVM(e.camera),new h.default(0,0,0,1)),r={x:n.X/n.W,y:n.Y/n.W,z:n.Z/n.W};if(r.z>=-1&&r.z<=1){var o={x:t.Left+(r.x+1)/2*t.Width,y:t.Top+(r.y+1)/2*t.Height};this._queriedElement.style.visibility="visible",this._queriedElement.style.left=o.x+"px",this._queriedElement.style.bottom=o.y+"px"}else this._queriedElement.style.visibility="hidden"}}},{key:"_restoreDefault",value:function(){this._canvasContainer.removeChild(this._queriedElement),this._parentCache.appendChild(this._queriedElement);var e=this._queriedElement.style,t=this._styleCache;e.position=t.position,e.left=t.left,e.bottom=t.bottom,e.visibility=t.visibility}},{key:"_beginTrack",value:function(){this._parentCache.removeChild(this._queriedElement),this._canvasContainer.appendChild(this._queriedElement),this._queriedElement.style.position="absolute"}},{key:"_onRendererChanged",value:function(){var e=this,t=!1;this.tree(this.getAttribute("targetRenderer")).forEach(function(n){return!!t||(e._targetNode=n,void(t=!0))})}},{key:"_onQueryChanged",value:function(e){var t=void 0;if(e&&""!==e&&(t=document.querySelectorAll(e)),this._queriedElement&&this._restoreDefault(),t&&0!==t.length){this._queriedElement=t.item(0);var n=this._queriedElement.style;this._styleCache={position:n.position,visibility:n.visibility,left:n.left,bottom:n.bottom},this._parentCache=this._queriedElement.parentElement,this._beginTrack()}else this._queriedElement=void 0,this._parentCache=void 0}}]),t}(c.default);t.default=b,b.attributes={htmlQuery:{default:null,converter:"String"},targetRenderer:{default:"render-scene",converter:"String"}}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(13),l=r(s),f=n(1),c=r(f),d=function(e){function t(){return o(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,e),u(t,[{key:"$awake",value:function(){if(!this.getAttribute("typeName")||!this.getAttribute("src"))throw new Error("type or src cannot be null in material importer");l.default.addSORTMaterialFromURL(this.getAttribute("typeName"),this.getAttribute("src"))}}]),t}(c.default);t.default=d,d.attributes={typeName:{default:null,converter:"String"},src:{default:null,converter:"String"}}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(9),l=r(s),f=n(13),c=r(f),d=n(1),h=r(d),p=function(e){function t(){return o(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,e),u(t,[{key:"$awake",value:function(){var e=l.default.ns(this.name.ns);this.companion.set(e("MaterialFactory"),new c.default(this.companion.get("gl")))}}]),t}(h.default);t.default=p,p.attributes={}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(10),l=r(s),f=n(5),c=r(f),d=n(3),h=r(d),p=n(1),_=r(p),b=n(24),v=r(b),m=v.default.vec3,y=function(e){function t(){o(this,t);var e=i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return e._priortyCalcCache=new Float32Array(3),e}return a(t,e),u(t,[{key:"getRenderingPriorty",value:function(e,t,n){return m.add(this._priortyCalcCache,e.transform.globalPosition.rawElements,this._geometry.aabb.Center.rawElements),m.sub(this._priortyCalcCache,this._priortyCalcCache,this._transformComponent.globalPosition.rawElements),this._materialContainer.getDrawPriorty(m.sqrLen(this._priortyCalcCache))}},{key:"$awake",value:function(){this.getAttributeRaw("targetBuffer").boundTo("_targetBuffer"),this.getAttributeRaw("layer").boundTo("_layer"),this.getAttributeRaw("drawOffset").boundTo("_drawOffset"),this.getAttributeRaw("drawCount").boundTo("_drawCount"),this.getAttributeRaw("geometry").boundTo("_geometry")}},{key:"$mount",value:function(){this._transformComponent=this.node.getComponent(h.default),this._materialContainer=this.node.getComponent(c.default),this._containedScene=t._findContainedScene(this.node),this._containedScene.queueRegistory.addRenderable(this)}},{key:"$unmount",value:function(){this._containedScene.queueRegistory.removeRenderable(this)}},{key:"render",value:function(e){if(this.node.isActive&&this.enabled&&this._layer===e.layer&&this._geometry&&(e.material||this._materialContainer.ready)){var t={targetBuffer:this._targetBuffer,geometry:this._geometry,attributeValues:null,camera:e.camera,transform:this._transformComponent,buffers:e.buffers,viewport:e.viewport,drawCount:this._drawCount,drawOffset:this._drawOffset,sceneDescription:e.sceneDescription,defaultTexture:e.defaultTexture,technique:e.technique};e.material?(t.attributeValues=e.materialArgs,e.material.draw(t)):(t.attributeValues=this._materialContainer.materialArgs,this._materialContainer.material.draw(t)),this.node.emit("render",e)}}}],[{key:"_findContainedScene",value:function(e){if(e.parent){var n=e.parent.getComponent(l.default);return n?n:t._findContainedScene(e.parent)}return null}}]),t}(_.default);t.default=y,y.attributes={geometry:{converter:"Geometry",default:"quad"},targetBuffer:{converter:"String",default:"default"},layer:{converter:"String",default:"default"},drawCount:{converter:"Number",default:Number.MAX_VALUE},drawOffset:{converter:"Number",default:0}}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(8),l=r(s),f=n(79),c=r(f),d=n(7),h=r(d),p=n(3),_=r(p),b=n(1),v=r(b),m=function(e){function t(){o(this,t);var e=i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return e._lastScreenPos=null,e._xsum=0,e._ysum=0,e}return a(t,e),u(t,[{key:"$awake",value:function(){this.getAttributeRaw("rotateSpeed").boundTo("_rotateSpeed"),this.getAttributeRaw("zoomSpeed").boundTo("_zoomSpeed"),this.getAttributeRaw("moveSpeed").boundTo("_moveSpeed"),this.getAttributeRaw("origin").boundTo("_origin")}},{key:"$mount",value:function(){var e=this.getAttribute("center"),t=null;null!==e?(console.warn("The attribute 'center' is deprecated now. This attribute would be removed on next version. Use 'distance' instead."),t=e):t=this.getAttribute("distance"),this._transform=this.node.getComponent(_.default),this._initialRight=l.default.copy(this._transform.right),this._initialUp=l.default.copy(this._transform.up),this._initialDirection=l.default.copy(this._transform.forward.negateThis()),this._initialRotation=this._transform.localRotation;var n=this.getAttribute("origin");null!==t?this._origin=this._transform.localPosition.addWith(this._transform.forward.multiplyWith(t)):this._origin=n;var r=this.companion.get("canvasElement");r.addEventListener("mousemove",this._mouseMove.bind(this)),r.addEventListener("contextmenu",this._contextMenu.bind(this)),r.addEventListener("mousewheel",this._mouseWheel.bind(this))}},{key:"_contextMenu",value:function(e){e.preventDefault()}},{key:"_mouseMove",value:function(e){if(null===this._lastScreenPos)return void(this._lastScreenPos={x:e.screenX,y:e.screenY});var t=!1,n=e.screenX-this._lastScreenPos.x,r=e.screenY-this._lastScreenPos.y,o=this._transform.localPosition.subtractWith(this._origin).magnitude;if((1&e.buttons)>0&&(this._xsum+=n,this._ysum+=r,this._ysum=Math.min(50*Math.PI,this._ysum),this._ysum=Math.max(50*-Math.PI,this._ysum),t=!0),(2&e.buttons)>0){var i=-n*this._moveSpeed*.01,a=r*this._moveSpeed*.01;this._origin=this._origin.addWith(this._transform.right.multiplyWith(i)).addWith(this._transform.up.multiplyWith(a)),o=this._transform.localPosition.subtractWith(this._origin).magnitude,t=!0}if(t){var u=c.default.angleAxis(-this._xsum*this._rotateSpeed*.01,this._initialUp),s=c.default.angleAxis(-this._ysum*this._rotateSpeed*.01,this._initialRight),f=c.default.multiply(u,s),d=h.default.rotationQuaternion(f),p=h.default.transformNormal(d,this._initialDirection);this._transform.localPosition=this._origin.addWith(l.default.normalize(p).multiplyWith(o)),this._transform.localRotation=c.default.multiply(this._initialRotation,f)}this._lastScreenPos={x:e.screenX,y:e.screenY}}},{key:"_mouseWheel",value:function(e){var t=l.default.normalize(l.default.subtract(this._transform.localPosition,this._origin)),n=-e.deltaY*this._zoomSpeed*.05,r=l.default.subtract(this._origin,this._transform.localPosition).magnitude,o=Math.max(1,r-n);this._transform.localPosition=this._origin.addWith(t.multiplyWith(o)),e.preventDefault()}}]),t}(v.default);t.default=m,m.attributes={rotateSpeed:{default:1,converter:"Number"},zoomSpeed:{default:1,converter:"Number"},moveSpeed:{default:1,converter:"Number"},center:{default:null,converter:"Number"},distance:{default:null,converter:"Number"},origin:{default:"0,0,0",converter:"Vector3"}}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(22),l=r(s),f=n(1),c=r(f),d=n(23),h=r(d),p=function(e){function t(){return o(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,e),u(t,[{key:"$mount",value:function(){this.buffer=new l.default(this.companion.get("gl"))}},{key:"$unmount",value:function(){this.buffer.destroy(),this.buffer=null}},{key:"$resizeBuffer",value:function(e){var t=this.getAttribute("name");if(!t)throw new Error("Attribute 'name' must be specified.");var n=h.default.getPow2Size(e.width,e.height);this.buffer.update(WebGLRenderingContext.DEPTH_COMPONENT16,n.width,n.height),e.bufferSizes[t]={width:n.width,height:n.height},e.buffers[t]=this.buffer}}]),t}(c.default);t.default=p,p.attributes={name:{converter:"String",default:null}}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(5),l=r(s),f=n(21),c=r(f),d=n(1),h=r(d),p=function(e){function t(){return o(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,e),u(t,[{key:"$awake",value:function(){this.getAttributeRaw("targetBuffer").boundTo("_targetBuffer"),this.getAttributeRaw("clearColor").boundTo("_clearColor"),this.getAttributeRaw("clearColorEnabled").boundTo("_clearColorEnabled"),this.getAttributeRaw("clearDepthEnabled").boundTo("_clearDepthEnabled"),this.getAttributeRaw("clearDepth").boundTo("_clearDepth"),this.getAttributeRaw("technique").boundTo("_technique")}},{key:"$mount",value:function(){this._gl=this.companion.get("gl"),this._canvas=this.companion.get("canvasElement");var e=this.companion.get("GeometryRegistory");this._geom=e.getGeometry("quad"),this._materialContainer=this.node.getComponent(l.default)}},{key:"$bufferUpdated",value:function(e){var t=this.getAttribute("out");"default"!==t&&(this._fbo=new c.default(this.companion.get("gl")),this._fbo.update(e.buffers[t]),this._fboSize=e.bufferSizes[t]);var n=this.getAttribute("depthBuffer");n&&this._fbo&&this._fbo.update(e.buffers[n])}},{key:"$render",value:function(e){if(this._materialContainer.ready){this._fbo?(this._fbo.bind(),this._gl.viewport(0,0,this._fboSize.width,this._fboSize.height)):(this._gl.bindFramebuffer(WebGLRenderingContext.FRAMEBUFFER,null),this._gl.viewport(e.viewport.Left,this._canvas.height-e.viewport.Bottom,e.viewport.Width,e.viewport.Height)),this._fbo&&this._clearColorEnabled&&(this._gl.clearColor(this._clearColor.R,this._clearColor.G,this._clearColor.B,this._clearColor.A),this._gl.clear(WebGLRenderingContext.COLOR_BUFFER_BIT)),this._clearDepthEnabled&&(this._gl.clearDepth(this._clearDepth),this._gl.clear(WebGLRenderingContext.DEPTH_BUFFER_BIT));var t={targetBuffer:this._targetBuffer,geometry:this._geom,attributeValues:{},camera:null,transform:null,buffers:e.buffers,viewport:e.viewport,defaultTexture:this.companion.get("defaultTexture"),technique:this._technique};t.attributeValues=this._materialContainer.materialArgs,this._materialContainer.material.draw(t),this._gl.flush()}}}]),t}(h.default);t.default=p,p.attributes={out:{default:"default",converter:"String"},depthBuffer:{default:null,converter:"String"},targetBuffer:{default:"default",converter:"String"},clearColor:{default:"#0000",converter:"Color4"},clearColorEnabled:{default:!0,converter:"Boolean"},clearDepthEnabled:{default:!0,converter:"Boolean"},clearDepth:{default:1,converter:"Number"},technique:{default:"default",converter:"String"}}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(1),l=r(s),f=n(21),c=r(f),d=n(5),h=r(d),p=function(e){function t(){return o(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,e),u(t,[{key:"$awake",value:function(){this.getAttributeRaw("layer").boundTo("_layer"),this.getAttributeRaw("clearColor").boundTo("_clearColor"),this.getAttributeRaw("clearColorEnabled").boundTo("_clearColorEnabled"),this.getAttributeRaw("clearDepthEnabled").boundTo("_clearDepthEnabled"),this.getAttributeRaw("clearDepth").boundTo("_clearDepth"),this.getAttributeRaw("camera").boundTo("_camera"),this.getAttributeRaw("technique").boundTo("_technique")}},{key:"$mount",value:function(){this._gl=this.companion.get("gl"),this._canvas=this.companion.get("canvasElement"),this._materialContainer=this.node.getComponent(h.default)}},{key:"$bufferUpdated",value:function(e){var t=this.getAttribute("out");"default"!==t&&(this._fbo=new c.default(this.companion.get("gl")),this._fbo.update(e.buffers[t]),this._fboSize=e.bufferSizes[t]);var n=this.getAttribute("depthBuffer");n&&this._fbo&&this._fbo.update(e.buffers[n])}},{key:"$render",value:function(e){var t=this._camera?this._camera:e.camera;if(t){this._fbo?(this._fbo.bind(),this._gl.viewport(0,0,this._fboSize.width,this._fboSize.height)):(this._gl.bindFramebuffer(WebGLRenderingContext.FRAMEBUFFER,null),this._gl.viewport(e.viewport.Left,this._canvas.height-e.viewport.Bottom,e.viewport.Width,e.viewport.Height)),this._fbo&&this._clearColorEnabled&&(this._gl.clearColor(this._clearColor.R,this._clearColor.G,this._clearColor.B,this._clearColor.A),this._gl.clear(WebGLRenderingContext.COLOR_BUFFER_BIT)),this._clearDepthEnabled&&(this._gl.clearDepth(this._clearDepth),this._gl.clear(WebGLRenderingContext.DEPTH_BUFFER_BIT)),e.camera.updateContainedScene(e.loopIndex);var n=this._materialContainer.useMaterial;e.camera.renderScene({caller:this,camera:t,buffers:e.buffers,layer:this._layer,viewport:e.viewport,material:n?this._materialContainer.material:void 0,materialArgs:n?this._materialContainer.material:void 0,loopIndex:e.loopIndex,technique:this._technique})}}}]),t}(l.default);t.default=p,p.attributes={layer:{converter:"String",default:"default"},depthBuffer:{default:null,converter:"String"},out:{converter:"String",default:"default"},clearColor:{default:"#0000",converter:"Color4"},clearColorEnabled:{default:!0,converter:"Boolean"},clearDepthEnabled:{default:!0,converter:"Boolean"},clearDepth:{default:1,converter:"Number"},camera:{default:null,converter:"Component",target:"Camera"},technique:{default:"default",converter:"String"}}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(1),l=r(s),f=function(e){function t(){o(this,t);var e=i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return e._buffers={},e._bufferSizes={},e}return a(t,e),u(t,[{key:"$mount",value:function(){var e=this;this._gl=this.companion.get("gl"),this._canvas=this.companion.get("canvasElement"),this._camera=this.getAttribute("camera"),this.getAttributeRaw("camera").watch(function(t){return e._camera=t}),this.getAttributeRaw("viewport").watch(function(t){e._viewportSizeGenerator=t,e.$resizeCanvas()}),this._viewportSizeGenerator=this.getAttribute("viewport")}},{key:"$treeInitialized",value:function(){this.$resizeCanvas()}},{key:"$resizeCanvas",value:function(){this._viewportCache=this._viewportSizeGenerator(this._canvas),0===this.node.children.length&&this.node.addChildByName("render-scene",{}),this.node.broadcastMessage("resizeBuffer",{width:this._viewportCache.Width,height:this._viewportCache.Height,buffers:this._buffers,bufferSizes:this._bufferSizes}),this.node.broadcastMessage("bufferUpdated",{buffers:this._buffers,bufferSizes:this._bufferSizes})}},{key:"$renderViewport",value:function(e){this.node.broadcastMessage("render",{camera:this._camera,viewport:this._viewportCache,bufferSizes:this._bufferSizes,buffers:this._buffers,loopIndex:e.loopIndex})}}]),t}(l.default);t.default=f,f.attributes={camera:{converter:"Component",default:"camera",target:"Camera"},viewport:{converter:"Viewport",default:"auto"}}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(85),l=r(s),f=n(18),c=r(f),d=n(1),h=r(d),p=function(e){function t(){return o(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,e),u(t,[{key:"$awake",value:function(){this.getAttributeRaw("bgColor").boundTo("_bgColor"),this.getAttributeRaw("clearDepth").boundTo("_clearDepth")}},{key:"$mount",value:function(){this.gl=this.companion.get("gl")}},{key:"$treeInitialized",value:function(){this.node.getComponent(c.default).register(this.onloop.bind(this),1e3),this.getAttribute("complementRenderer")&&0===this.node.getChildrenByNodeName("renderer").length&&this.node.addChildByName("renderer",{})}},{key:"onloop",value:function(e){if(this.enabled){var t=this._bgColor;this.gl.clearColor(t.R,t.G,t.B,t.A),this.gl.clearDepth(this._clearDepth),this.gl.clear(WebGLRenderingContext.COLOR_BUFFER_BIT|WebGLRenderingContext.DEPTH_BUFFER_BIT),this.node.broadcastMessage(1,"renderViewport",{loopIndex:e})}}}]),t}(h.default);t.default=p,p.attributes={bgColor:{default:new l.default(0,0,0,0),converter:"Color4"},clearDepth:{default:1,converter:"Number"},complementRenderer:{default:!0,converter:"Boolean"}}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(4),l=r(s),f=n(1),c=r(f),d=n(23),h=r(d),p=function(e){function t(){return o(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,e),u(t,[{key:"$mount",value:function(){this.buffer=new l.default(this.companion.get("gl"))}},{key:"$unmount",value:function(){this.buffer.destroy(),this.buffer=null}},{key:"$resizeBuffer",value:function(e){var t=this.getAttribute("name");if(!t)throw new Error("Attribute 'name' must be specified.");var n=this.getAttribute("format"),r=this.getAttribute("type"),o=h.default.getPow2Size(e.width,e.height);this.buffer.update(0,o.width,o.height,0,n,r,null),e.bufferSizes[t]={width:o.width,height:o.height},e.buffers[t]=this.buffer}}]),t}(c.default);t.default=p,p.attributes={name:{converter:"String",default:null},format:{converter:"Enum",default:WebGLRenderingContext.RGBA,table:{RGBA:WebGLRenderingContext.RGBA,RGB:WebGLRenderingContext.RGB,ALPHA:WebGLRenderingContext.ALPHA,LUMINANCE:WebGLRenderingContext.LUMINANCE,LUMINANCE_ALPHA:WebGLRenderingContext.LUMINANCE_ALPHA,SRGB_EXT:WebGLRenderingContext.SRGB_EXT,SRGB_ALPHA_EXT:WebGLRenderingContext.SRGB_ALPHA_EXT,DEPTH_COMPONENT:WebGLRenderingContext.DEPTH_COMPONENT,DEPTH_STENCIL:WebGLRenderingContext.DEPTH_STENCIL}},type:{converter:"Enum",default:WebGLRenderingContext.UNSIGNED_BYTE,table:{UNSIGNED_BYTE:WebGLRenderingContext.UNSIGNED_BYTE,UNSIGNED_SHORT_5_6_5:WebGLRenderingContext.UNSIGNED_SHORT_5_6_5,UNSIGNED_SHORT_4_4_4_4:WebGLRenderingContext.UNSIGNED_SHORT_4_4_4_4,UNSIGNED_SHORT_5_5_5_1:WebGLRenderingContext.UNSIGNED_SHORT_5_5_5_1,UNSIGNED_SHORT:WebGLRenderingContext.UNSIGNED_SHORT,UNSIGNED_INT:WebGLRenderingContext.UNSIGNED_INT,FLOAT:WebGLRenderingContext.FLOAT}}}},function(e,t){"use strict";function n(e){if("fit"===e)return{mode:"fit"};if("string"==typeof e){var t=/aspect\(([\d+(?.\d*)?]+)\)/.exec(e);if(t)return{mode:"aspect",aspect:Number.parseFloat(t[1])}}return{mode:"manual",size:Number.parseFloat(e)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=n},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e){if(!this.declaration.target)throw new Error("Component converter require to be specified target");if(null===e)return null;if(e instanceof s.default)return e.getComponent(this.declaration.target);if(e instanceof a.default){if(e.name===this.declaration.target)return e;throw new Error("Specified component must be "+this.declaration.target)}var t=this.tree(e).first();return t?t.getComponent(this.declaration.target):null}Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),a=r(i),u=n(91),s=r(u);t.default=o},function(e,t){"use strict";function n(e){if(!this.declaration.table)throw new Error("Enum converter needs to be specified table in attribute dictionary");if("number"==typeof e)return e;if("string"==typeof e){var t=this.declaration.table[e];if(t)return t;throw new Error("Specified value is not exisiting in the relation table")}return null}Object.defineProperty(t,"__esModule",{value:!0}),t.default=n},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e){if("string"==typeof e)return this.companion.get("GeometryRegistory").getGeometry(e);if(e instanceof a.default)return e;throw new Error('Specified geometry "'+e+'" is not supported for converting into geometry.')}Object.defineProperty(t,"__esModule",{value:!0});var i=n(11),a=r(i);t.default=o},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e){if("string"==typeof e){var t=/\s*new\s*\(\s*([a-zA-Z\d\-]+)\s*\)/,n=void 0;if(n=t.exec(e))return this.component[this.declaration.componentBoundTo]=null,this.companion.get("MaterialFactory").instanciate(n[1]);var r=this.tree(e).first().getComponent(a.default);return this.component[this.declaration.componentBoundTo]=r,r.materialPromise}return null}Object.defineProperty(t,"__esModule",{value:!0});var i=n(19),a=r(i);t.default=o},function(e,t){"use strict";function n(e){if(e instanceof Array)return e;if("string"==typeof e){var t=e.split(",");return t.map(function(e){return Number.parseFloat(e)})}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=n},function(e,t){"use strict";function n(e){return"number"==typeof e?e:"string"==typeof e?Number.parseFloat(e):null===e?null:void 0}Object.defineProperty(t,"__esModule",{value:!0}),t.default=n},function(e,t){"use strict";function n(e){return e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=n},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){e.update(t),requestAnimationFrame(function(){return o(e,t)})}function i(e){var t=/(query|backbuffer|video)\((.+)\)[^\)]*$/,n=void 0;return(n=t.exec(e))?{type:n[1],param:n[2]}:null}function a(e){var t=document.createElement("video");return t.src=e,t}function u(e,t){var n=new _.default(e);return t.play(),n.update(t),o(n,t),n}function s(e){var t=this;if(e instanceof _.default)return new h.default(e);if("string"==typeof e){var n=i(e);if(n){var r=function(){var e=n.param,r=function(){switch(n.type){case"backbuffer":return{v:{v:new h.default(function(t){return t[e]})}};case"video":return{v:{v:new h.default(u(t.companion.get("gl"),a(e)))}};case"query":var r=t.tree(e),o=r.first().getComponent(c.default);return{v:{v:new h.default(function(){return o.texture})}}}}();if("object"===("undefined"==typeof r?"undefined":l(r)))return r.v}();if("object"===("undefined"==typeof r?"undefined":l(r)))return r.v}else{var o=function(){var n=new _.default(t.companion.get("gl"));return v.default.resolve(e).then(function(e){n.update(e)}),t.companion.get("loader").register(n.validPromise),{v:new h.default(n)}}();if("object"===("undefined"==typeof o?"undefined":l(o)))return o.v}}if("object"===("undefined"==typeof e?"undefined":l(e)))if(e instanceof HTMLImageElement){var s=function(){var n=new _.default(t.companion.get("gl"));return e.complete&&e.naturalWidth?n.update(e):e.onload=function(){n.update(e)},{v:new h.default(n)}}();if("object"===("undefined"==typeof s?"undefined":l(s)))return s.v}else{if(e instanceof HTMLCanvasElement){var f=new _.default(this.companion.get("gl"));return f.update(e),new h.default(f)}if(e instanceof HTMLVideoElement)return new h.default(u(this.companion.get("gl"),e))}return null}Object.defineProperty(t,"__esModule",{value:!0});var l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},f=n(20),c=r(f),d=n(62),h=r(d),p=n(4),_=r(p),b=n(17),v=r(b);t.default=s},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){var n=/(\d+)\s*%/,r=void 0;if(r=n.exec(t)){var o=Number.parseFloat(r[1]);return Math.floor(e*o*.01)}return Math.floor(Number.parseFloat(t))}function i(e){if(e instanceof s.default)return function(){return e};if("string"==typeof e){if("auto"===e)return function(e){return new s.default(0,0,e.width,e.height)};var t=function(){var t=e.split(",");if(4!==t.length)throw new Error("Invalid viewport size was specified.");return{v:function(e){return new s.default(o(e.width,t[0]),o(e.height,t[1]),o(e.width,t[2]),o(e.height,t[3]))}}}();if("object"===("undefined"==typeof t?"undefined":a(t)))return t.v}throw new Error(e+" could not be parsed")}Object.defineProperty(t,"__esModule",{value:!0});var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u=n(86),s=r(u);t.default=i},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(11),u=r(a),s=n(78),l=r(s),f=n(8),c=r(f),d=n(55),h=r(d),p=n(12),_=r(p),b=new l.default;b.expand(new c.default(-1,-1,-1)),b.expand(new c.default(1,1,1));var v={POSITION:{size:3,stride:32},NORMAL:{size:3,stride:32,offset:12},TEXCOORD:{size:2,stride:32,offset:24}},m=function(){function e(){o(this,e)}return i(e,null,[{key:"register",value:function(){e._registerQuad(),e._registerCube(),e._registerSphere(),e._registerCircle()}},{key:"_registerQuad",value:function(){_.default.addType("quad",{},function(e,t){var n=new u.default(e);return n.addAttributes(h.default.plane([0,0,0],[0,0,1],[0,1,0],[1,0,0],1,1),v),n.addIndex("default",h.default.planeIndex(0,1,1)),n})}},{key:"_registerCube",value:function(){_.default.addType("cube",{divHorizontal:{converter:"Number",default:1},divVertical:{converter:"Number",default:1}},function(e,t){var n=t.divHorizontal,r=t.divVertical,o=new u.default(e),i=[].concat.apply([],[h.default.plane([0,0,1],[0,0,1],[0,1,0],[1,0,0],n,r),h.default.plane([0,0,-1],[0,0,-1],[0,1,0],[-1,0,0],n,r),h.default.plane([0,1,0],[0,1,0],[0,0,-1],[1,0,0],n,r),h.default.plane([0,-1,0],[0,-1,0],[0,0,-1],[-1,0,0],n,r),h.default.plane([1,0,0],[1,0,0],[0,1,0],[0,0,-1],n,r),h.default.plane([-1,0,0],[-1,0,0],[0,1,0],[0,0,1],n,r)]);o.addAttributes(i,v);var a=(n+1)*(r+1),s=[].concat.apply([],[h.default.planeIndex(0,n,r),h.default.planeIndex(a,n,r),h.default.planeIndex(2*a,n,r),h.default.planeIndex(3*a,n,r),h.default.planeIndex(4*a,n,r),h.default.planeIndex(5*a,n,r)]);return o.addIndex("default",s),o})}},{key:"_registerSphere",value:function(){_.default.addType("sphere",{divVertical:{converter:"Number",default:100},divHorizontal:{converter:"Number",default:100}},function(e,t){var n=t.divHorizontal,r=t.divVertical,o=new u.default(e);return o.addAttributes(h.default.sphere([0,0,0],[0,1,0],[1,0,0],[0,0,-1],r,n),v),o.addIndex("default",h.default.sphereIndex(0,r,n)),o})}},{key:"_registerCircle",value:function(){_.default.addType("circle",{divide:{converter:"Number",default:10}},function(e,t){var n=t.divide,r=new u.default(e);return r.addAttributes(h.default.circle([0,0,0],[0,0,1],[0,1,0],[1,0,0],n),v),r.addIndex("default",h.default.circleIndex(0,n)),r})}}]),e}();t.default=m},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(){function e(){n(this,e)}return r(e,null,[{key:"plane",value:function(e,t,n,r){for(var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,a=new Array(8*(o+1)*(i+1)),u=[e[0]-n[0]-r[0],e[1]-n[1]-r[1],e[2]-n[2]-r[2]],s=[r[0]/o*2,r[1]/o*2,r[2]/o*2],l=[n[0]/i*2,n[1]/i*2,n[2]/i*2],f=0;f<i+1;f++)for(var c=0;c<o+1;c++){var d=8*((o+1)*f+c);a[d+0]=u[0]+s[0]*c+l[0]*f,a[d+1]=u[1]+s[1]*c+l[1]*f,a[d+2]=u[2]+s[2]*c+l[2]*f,a[d+3]=t[0],a[d+4]=t[1],a[d+5]=t[2],a[d+6]=1/o*c,a[d+7]=1-1/i*f}return a}},{key:"planeIndex",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=new Array(6*t*n),o=0;o<n;o++)for(var i=0;i<t;i++){var a=6*(t*o+i),u=e+(t+1)*o+i,s=e+(t+1)*(o+1)+i;r[a+0]=u,r[a+1]=u+1,r[a+2]=s,r[a+3]=s,r[a+4]=u+1,r[a+5]=s+1}return r}},{key:"circle",value:function(e,t,n,r){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:5,i=new Array(6*(3+o));i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=t[0],i[4]=t[1],i[5]=t[2],i[6]=.5,i[7]=.5;for(var a=2*Math.PI/o,u=0;u<o+1;u++){var s=8+8*u,l=Math.sin(a*u),f=Math.cos(a*u);i[s+0]=e[0]+f*n[0]+l*r[0],i[s+1]=e[1]+f*n[1]+l*r[1],i[s+2]=e[2]+f*n[2]+l*r[2],i[s+3]=t[0],i[s+4]=t[1],i[s+5]=t[2],i[s+6]=.5+.5*l,i[s+7]=.5-.5*f}return i}},{key:"circleIndex",value:function(e,t){for(var n=new Array(3*(t+1)),r=0;r<t;r++)n[3*r+0]=e,n[3*r+1]=e+(r+2),n[3*r+2]=e+(r+1);return n}},{key:"sphere",value:function(e,t,n,r){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:3,a=new Array(8*(o*i+2));a[0]=e[0]+t[0],a[1]=e[1]+t[1],a[2]=e[2]+t[2],a[3]=t[0],a[4]=t[1],a[5]=t[2],a[6]=.5,a[7]=.5,a[8]=e[0]-t[0],a[9]=e[1]-t[1],a[10]=e[2]-t[2],a[11]=-t[0],a[12]=-t[1],a[13]=-t[2],a[14]=.5,a[15]=-.5;for(var u=Math.PI/(o+1),s=2*Math.PI/i,l=0;l<o;l++)for(var f=Math.cos((l+1)*u),c=Math.sin((l+1)*u),d=0;d<i+1;d++){var h=Math.cos(d*s),p=Math.sin(d*s),_=16+8*(l*(i+1)+d);a[_+0]=e[0]+f*t[0]+c*(r[0]*h+n[0]*p),a[_+1]=e[1]+f*t[1]+c*(r[1]*h+n[1]*p),a[_+2]=e[2]+f*t[2]+c*(r[2]*h+n[2]*p),a[_+3]=1,a[_+4]=1,a[_+5]=1,a[_+6]=1,a[_+7]=1}return a}},{key:"sphereIndex",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,r=new Array((n+1)*t*6),o=0;o<n+1;o++)r[3*o]=0,r[3*o+1]=o+3,r[3*o+2]=o+2;return r}}]),e}();t.default=o},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={GRIMOIRE:null,WEBGL_VERSION:"1"}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(13),u=r(a),s=n(93),l=r(s),f=function(){function e(){o(this,e)}return i(e,null,[{key:"register",value:function(){u.default.addSORTMaterial("unlit",l.default)}}]),e}();t.default=f},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(56),u=r(a),s=function(){function e(){o(this,e),this.macroString="",this._macro={},this._observers=[];for(var t in u.default)this.setValue(t,u.default[t])}return i(e,[{key:"setValue",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._macro[e]!==t&&(this._macro[e]=t,this.macroString=this._getMacroString(),this._notifyMacroChanged())}},{key:"getValue",value:function(e){return this._macro[e]}},{key:"addObserver",value:function(e){this._observers.push(e)}},{key:"removeObserver",value:function(e){for(var t=0;t<this._observers.length;t++)this._observers[t]===e&&this._observers.splice(t,1)}},{key:"_getMacroString",value:function(){var e="";for(var t in this._macro)e+=this._genSingleMacroString(t,this._macro[t]);return e}},{key:"_notifyMacroChanged",value:function(){for(var e=0;e<this._observers.length;e++)this._observers[e]()}},{key:"_genSingleMacroString",value:function(e,t){if(void 0===t)throw new Error("Macro value of "+e+" can't be undefined");return null===t?"#define "+e+"\n":"#define "+e+" "+t+"\n"}}]),e}();t.default=s},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(61),u=r(a),s=function(){function e(t,n){o(this,e),this.gl=t,this.techniqueRecipes=n,this.argumentDeclarations={},this.arguments={},this.macroDeclarations={},this.techniques={},this._macroObserver={};for(var r in n)this.techniques[r]=new u.default(this,n[r])}return i(e,[{key:"draw",value:function(e){var t=this.techniques[e.technique];t&&t.draw(e)}},{key:"addMacroObserver",value:function(e,t,n){this._macroObserver[e]||(this._macroObserver[e]=[]),this._macroObserver[e].push(n),this.macroDeclarations[e]=t}},{key:"setMacroValue",value:function(e,t){this._macroObserver[e]&&this._macroObserver[e].forEach(function(e){return e(t)})}},{key:"addArgument",value:function(e,t){this.argumentDeclarations[e]=t}},{key:"deleteArgument",value:function(e){delete this.argumentDeclarations[e]}}]),e}();t.default=s},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(67),u=r(a),s=n(11),l=r(s),f=n(6),c=r(f),d=n(65),h=r(d),p=n(80),_=r(p),b=function(){function e(t,n){var r=this;o(this,e),this.material=t,this.passRecipe=n,this._macro={};var i=c.default.generateRegisterers(t,n);this._registers=i.registerers,this._disposers=i.disposers,this._gl=t.gl,this.program=new h.default(this._gl),this.fs=new u.default(this._gl,WebGLRenderingContext.FRAGMENT_SHADER),this.vs=new u.default(this._gl,WebGLRenderingContext.VERTEX_SHADER);var a=function(e){var t=n.macros[e];r._macro[t.macroName]=t.value,r.material.addMacroObserver(e,{converter:"bool"===t.type?"Boolean":"Number",default:t.value},function(e){"bool"===t.type?r._macro[t.macroName]=e?"":void 0:r._macro[t.macroName]=e,r._updateProgram()})};for(var s in n.macros)a(s);this._updateProgram(),this._disables=e._glEnableTargets.concat();for(var l=0;l<n.states.enable.length;l++){var f=n.states.enable[l],d=this._disables.indexOf(f);d>-1&&this._disables.splice(d,1)}}return i(e,[{key:"draw",value:function(e){this.program.use();for(var t=0;t<this._registers.length;t++)this._registers[t](this.program.uniforms,e);this._configure();for(var n in this.passRecipe.attributes){var r=this.passRecipe.attributes[n];l.default.bindBufferToAttribute(e.geometry,this.program,n,r.semantic)}l.default.drawWithCurrentVertexBuffer(e.geometry,e.targetBuffer,e.drawCount,e.drawOffset)}},{key:"dispose",value:function(){for(var e=0;e<this._disposers.length;e++)this._disposers[e]()}},{key:"_configure",value:function(){for(var e=this.passRecipe.states,t=this.passRecipe.states.functions,n=0;n<e.enable.length;n++)this._gl.enable(e.enable[n]);for(var r=0;r<this._disables.length;r++)this._gl.disable(this._disables[r]);t.blendColor&&this._gl.blendColor(t.blendColor[0],t.blendColor[1],t.blendColor[2],t.blendColor[3]),t.blendEquationSeparate&&this._gl.blendEquationSeparate(t.blendEquationSeparate[0],t.blendEquationSeparate[1]),t.blendFuncSeparate&&this._gl.blendFuncSeparate(t.blendFuncSeparate[0],t.blendFuncSeparate[1],t.blendFuncSeparate[2],t.blendFuncSeparate[3]),t.colorMask&&this._gl.colorMask(t.colorMask[0],t.colorMask[1],t.colorMask[2],t.colorMask[3]),t.cullFace&&this._gl.cullFace(t.cullFace[0]),t.depthFunc&&this._gl.depthFunc(t.depthFunc[0]),t.depthMask&&this._gl.depthMask(t.depthMask[0]),t.depthRange&&this._gl.depthRange(t.depthRange[0],t.depthRange[1]),t.frontFace&&this._gl.frontFace(t.frontFace[0]),t.lineWidth&&this._gl.lineWidth(t.lineWidth[0]),t.polygonOffset&&this._gl.polygonOffset(t.polygonOffset[0],t.polygonOffset[1]),t.scissor&&this._gl.scissor(t.scissor[0],t.scissor[1],t.scissor[2],t.scissor[3])}},{key:"_updateProgram",value:function(){this.fs.update(this._generateShaderCode("FS")),this.vs.update(this._generateShaderCode("VS")),this.program.update([this.vs,this.fs])}},{key:"_generateShaderCode",value:function(e){return"#define "+e+"\n"+this._macroCode()+"\n"+_.default+"/*BEGINNING OF USER CODE*/\n"+("VS"===e?this.passRecipe.vertex:this.passRecipe.fragment)}},{key:"_macroCode",value:function(){var e="";for(var t in this._macro)e+="#define "+t+" "+this._macro[t]+"\n";return e}}]),e}();t.default=b,b._glEnableTargets=[WebGLRenderingContext.CULL_FACE,WebGLRenderingContext.DEPTH_TEST,WebGLRenderingContext.STENCIL_TEST,WebGLRenderingContext.BLEND,WebGLRenderingContext.SCISSOR_TEST,WebGLRenderingContext.DITHER,WebGLRenderingContext.POLYGON_OFFSET_FILL,WebGLRenderingContext.SAMPLE_ALPHA_TO_COVERAGE,WebGLRenderingContext.SAMPLE_COVERAGE]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(60),u=r(a),s=function(){function e(t,n){o(this,e),this.material=t,this.passes=[],"Auto"===n.drawOrder?this.drawOrder="UseAlpha":this.drawOrder=n.drawOrder,this.passes=n.passes.map(function(e){return new u.default(t,e)})}return i(e,[{key:"draw",value:function(e){for(var t=0;t<this.passes.length;t++)this.passes[t].draw(e)}},{key:"dispose",value:function(){this.passes.forEach(function(e){return e.dispose()})}}]),e}();t.default=s},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(){function e(t){n(this,e),this.rawResource=t,this._isFunctionalProxy="function"==typeof t}return r(e,[{key:"get",value:function(e){return this._isFunctionalProxy?this.rawResource(e):this.rawResource}}]),e}();t.default=o},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var a=o.get;if(void 0!==a)return a.call(r)},l=n(2),f=r(l),c=function(e){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:WebGLRenderingContext.ARRAY_BUFFER,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:WebGLRenderingContext.STATIC_DRAW;o(this,t);var a=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.target=n,a.usage=r,a.buffer=e.createBuffer(),a}return a(t,e),u(t,[{key:"update",value:function(e,t){this.bind(),t?(this.valid||this.gl.bufferData(this.target,e+t.byteLength,this.usage),this.gl.bufferSubData(this.target,e,t)):"number"==typeof e?this.gl.bufferData(this.target,e,this.usage):this.gl.bufferData(this.target,e,this.usage),this.valid=!0}},{key:"bind",value:function(){this.gl.bindBuffer(this.target,this.buffer)}},{key:"destroy",value:function(){s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",this).call(this),this.gl.deleteBuffer(this.buffer)}}]),t}(f.default);t.default=c},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(){function e(t){n(this,e),this.gl=t,this.extensions={},this._readyExtensions={},this._resolveRequested(),e._requestObserver.push(this._resolveExtensionSafely)}return r(e,[{key:"_resolveRequested",value:function(){var t=this;e._requestedExtensions.forEach(function(e){t._resolveExtensionSafely(e.extensionName)})}},{key:"_resolveExtensionSafely",value:function(t){var n=e._requestedExtensions[e._requestIndexOf(t)];if(!this._resolveExtension(n.extensionName)&&n.isNecessary)throw new Error("A WebGL extension '"+n.extensionName+"' was requested. But that is not supported on this device.")}},{key:"_resolveExtension",value:function(t){if(this._readyExtensions[t])return!0;var n=void 0;return n="undefined"==typeof e._customExtensionResolvers[t]?this.extensions[t]=this.gl.getExtension(t):this.extensions[t]=e._customExtensionResolvers[t](this.gl),this._readyExtensions[t]=void 0!==this.extensions[t],!!this._readyExtensions[t]}}],[{key:"request",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=e._requestIndexOf(t);r>-1&&n?e._requestedExtensions[r]={extensionName:t,isNecessary:n}:r===-1&&e._requestedExtensions.push({extensionName:t,isNecessary:n}),e._requestObserver.forEach(function(e){return e(t)})}},{key:"_requestIndexOf",value:function(t){for(var n=0;n<e._requestedExtensions.length;n++)if(e._requestedExtensions[n].extensionName===t)return n;return-1}}]),e}();t.default=o,o._requestedExtensions=[],o._customExtensionResolvers={},o._requestObserver=[],o._customExtensionResolvers.WEBGL_color_buffer_float=function(e){var t=void 0;if(null===e.getExtension("WEBGL_color_buffer_float")){var n=e.createFramebuffer(),r=e.createTexture();e.bindFramebuffer(e.FRAMEBUFFER,n),e.bindTexture(e.TEXTURE_2D,r),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.FLOAT,null),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r,0),t=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE,e.deleteTexture(r),e.deleteFramebuffer(n)}else t=!0;return t}},function(e,t,n){"use strict";
function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var a=o.get;if(void 0!==a)return a.call(r)},l=n(66),f=r(l),c=n(68),d=r(c),h=n(2),p=r(h),_=function(e){function t(e){o(this,t);var n=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n._uniformLocations={},n._attributeLocations={},n.uniforms=new d.default(n),n.program=e.createProgram(),n}return a(t,e),u(t,[{key:"update",value:function(e){var t=this;if(this.valid){var n=this.gl.getAttachedShaders(this.program);n.forEach(function(e){return t.gl.detachShader(t.program,e)}),this._uniformLocations={},this._attributeLocations={}}if(e.forEach(function(e){t.gl.attachShader(t.program,e.shader)}),this.gl.linkProgram(this.program),!this.gl.getProgramParameter(this.program,WebGLRenderingContext.LINK_STATUS)){var r=this.gl.getProgramInfoLog(this.program);throw new Error("LINK FAILED\n"+r)}this.valid=!0}},{key:"use",value:function(){this.isLastUsed||this.gl.useProgram(this.program),this.uniforms.onUse()}},{key:"destroy",value:function(){s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",this).call(this),this.gl.deleteProgram(this.program)}},{key:"findAttributeLocation",value:function(e){return void 0===this._attributeLocations[e]?(this._attributeLocations[e]=this.gl.getAttribLocation(this.program,e),this._safeEnableVertexAttribArray(this._attributeLocations[e]),this._attributeLocations[e]):this._attributeLocations[e]}},{key:"findUniformLocation",value:function(e){var t=this._uniformLocations[e];return void 0===t?this._uniformLocations[e]=this.gl.getUniformLocation(this.program,e):t}},{key:"_safeEnableVertexAttribArray",value:function(e){e<0||this.gl.enableVertexAttribArray(e)}},{key:"isLastUsed",get:function(){return f.default.useProgramCheck(this.gl,this.program)}}]),t}(p.default);t.default=_},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=t.ResourceCache=function(){function e(){n(this,e),this._lastUsedPrograms=new Map}return r(e,[{key:"useProgramCheck",value:function(e,t){return this._lastUsedPrograms.get(e)===t||(this._lastUsedPrograms.set(e,t),!1)}}]),e}();t.default=new o},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var a=o.get;if(void 0!==a)return a.call(r)},l=n(2),f=r(l),c=function(e){function t(e,n,r){o(this,t);var a=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.type=n,a.sourceCode=r,a.shader=e.createShader(n),r&&a.update(r),a}return a(t,e),u(t,[{key:"update",value:function(e){if(this.gl.shaderSource(this.shader,e),this.gl.compileShader(this.shader),!this.gl.getShaderParameter(this.shader,WebGLRenderingContext.COMPILE_STATUS))throw new Error("Compiling shader failed.\nSourceCode:\n"+e+"\n\nErrorCode:"+this.gl.getShaderInfoLog(this.shader));this.sourceCode=e,this.valid=!0}},{key:"destroy",value:function(){s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",this).call(this),this.gl.deleteShader(this.shader)}}]),t}(f.default);t.default=c},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(){function e(t){n(this,e),this.program=t,this._currentTextureRegister=0,this._gl=t.gl}return r(e,[{key:"uniformBool",value:function(e,t){var n=this;this._pass(e,function(e){return n._gl.uniform1i(e,t?1:0)})}},{key:"uniformMatrix",value:function(e,t){var n=this;this._pass(e,function(e){return n._gl.uniformMatrix4fv(e,!1,t.rawElements)})}},{key:"uniformMatrixArray",value:function(e,t){for(var n=this,r=t.length/16,o=function(r){n._passAsArray(e,r,function(e){return n._gl.uniformMatrix4fv(e,!1,new Float32Array(t.buffer,t.byteOffset+64*r))})},i=0;i<r;i++)o(i)}},{key:"uniformFloat",value:function(e,t){var n=this;this._pass(e,function(e){return n._gl.uniform1f(e,t)})}},{key:"uniformFloatArray",value:function(e,t){var n=this;this._pass(e,function(e){return n._gl.uniform1fv(e,t)})}},{key:"uniformInt",value:function(e,t){var n=this;this._pass(e,function(e){return n._gl.uniform1i(e,t)})}},{key:"uniformVector2",value:function(e,t){var n=this;this._pass(e,function(e){return n._gl.uniform2f(e,t.X,t.Y)})}},{key:"uniformIntVector2",value:function(e,t){var n=this;this._pass(e,function(e){return n._gl.uniform2i(e,t.X,t.Y)})}},{key:"uniformVector2Array",value:function(e,t){var n=this;this._pass(e,function(e){return n._gl.uniform2fv(e,t)})}},{key:"uniformVector3",value:function(e,t){var n=this;this._pass(e,function(e){return n._gl.uniform3f(e,t.X,t.Y,t.Z)})}},{key:"uniformIntVector3",value:function(e,t){var n=this;this._pass(e,function(e){return n._gl.uniform3i(e,t.X,t.Y,t.Z)})}},{key:"uniformVector3Array",value:function(e,t){var n=this;this._pass(e,function(e){return n._gl.uniform3fv(e,t)})}},{key:"uniformColor3",value:function(e,t){var n=this;this._pass(e,function(e){return n._gl.uniform3f(e,t.R,t.G,t.B)})}},{key:"uniformVector4",value:function(e,t){var n=this;this._pass(e,function(e){return n._gl.uniform4f(e,t.X,t.Y,t.Z,t.W)})}},{key:"uniformIntVector4",value:function(e,t){var n=this;this._pass(e,function(e){return n._gl.uniform4f(e,t.X,t.Y,t.Z,t.W)})}},{key:"uniformVector4Array",value:function(e,t){var n=this;this._pass(e,function(e){return n._gl.uniform4fv(e,t)})}},{key:"uniformColor4",value:function(e,t){var n=this;this._pass(e,function(e){return n._gl.uniform4f(e,t.R,t.G,t.B,t.A)})}},{key:"uniformTexture2D",value:function(e,t){t.valid?(t.register(this._currentTextureRegister),this.uniformInt(e,this._currentTextureRegister),this._currentTextureRegister++):console.warn("The texture assigned to '"+e+"' is not valid.")}},{key:"onUse",value:function(){this._currentTextureRegister=0}},{key:"_pass",value:function(e,t){var n=this.program.findUniformLocation(e);n&&t(n)}},{key:"_passAsArray",value:function(e,t,n){var r=this.program.findUniformLocation(e+"["+t+"]");r&&n(r)}}]),e}();t.default=o},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={Background:{priorty:1e3},NoAlpha:{priorty:2e3},UseAlpha:{priorty:3e3,descending:!0},NoDepth:{priorty:4e3,descending:!0},Overlay:{priorty:5e3,descending:!0}}},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(){function e(){n(this,e),this._rendeables=[]}return r(e,[{key:"add",value:function(e){this._rendeables.push({rendarable:e,priortyCache:Number.MIN_VALUE})}},{key:"remove",value:function(e){for(var t=0;t<this._rendeables.length;t++){var n=this._rendeables[t];if(n.rendarable.id===e.id)break}this._rendeables.length!==t&&this._rendeables.splice(t,1)}},{key:"renderAll",value:function(e,t,n){for(var r=0;r<this._rendeables.length;r++)this._rendeables[r].priortyCache=this._rendeables[r].rendarable.getRenderingPriorty(e.camera,t,this._rendeables[r].priortyCache);this._rendeables.sort(function(e,t){return e.priortyCache-t.priortyCache}),this._rendeables.forEach(function(t){t.rendarable.render(e)})}}]),e}();t.default=o},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(){function e(){n(this,e),this._queues=[],this._renderables=[]}return r(e,[{key:"registerQueue",value:function(e){this._queues.push(e),this._renderables.forEach(function(t){return e.add(t)})}},{key:"unregisterQueue",value:function(e){var t=this._queues.indexOf(e);t>-1&&this._queues.splice(t,1)}},{key:"addRenderable",value:function(e){this._renderables.push(e),this._queues.forEach(function(t){return t.add(e)})}},{key:"removeRenderable",value:function(e){var t=this._renderables.indexOf(e);t!==-1&&(this._renderables.splice(t,1),this._queues.forEach(function(t){return t.remove(e)}))}}]),e}();t.default=o},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.ImportResolver=void 0;var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var a=o.get;if(void 0!==a)return a.call(r)},l=n(15),f=r(l),c=function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{s(r.next(e))}catch(e){i(e)}}function u(e){try{s(r.throw(e))}catch(e){i(e)}}function s(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(a,u)}s((r=r.apply(e,t)).next())})},d=t.ImportResolver=function(e){function t(){o(this,t);var e=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,function(e){var n=/^https?:\/\/.*/gm;return n.test(e)?t._toAbsolute(e):e}));return e.staticImports={},e}return a(t,e),u(t,[{key:"resolve",value:function(e){var n=this;return s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"resolve",this).call(this,e,function(t){return n._resolve(e)})}},{key:"_resolve",value:function(e){return c(this,void 0,void 0,regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.staticImports[e]){t.next=4;break}return t.abrupt("return",this.staticImports[e]);case 4:return t.next=6,this._fromExternal(e);case 6:return t.abrupt("return",t.sent);case 7:case"end":return t.stop()}},t,this)}))}},{key:"_fromExternal",value:function(e){return new Promise(function(t,n){var r=new XMLHttpRequest;r.open("GET",e),r.onload=function(e){t(r.responseText)},r.onerror=function(e){n(e)},r.send()})}}],[{key:"_toAbsolute",value:function(e){var t=document.createElement("a");return t.href=e,t.protocol+"//"+t.host+t.pathname+t.search+t.hash}}]),t}(f.default);t.default=new d},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={attribute:{position:"POSITION",normal:"NORMAL",texCoord:"TEXCOORD"},uniform:{_time:"TIME",_viewportSize:"VIEWPORT_SIZE",_matL:"LOCAL",_matM:"MODEL",_matV:"VIEW",_matP:"PROJECTION",_matVM:"MODELVIEW",_matPVM:"MODELVIEWPROJECTION",_matIM:"MODELINVERSE",_matIV:"VIEWINVERSE",_matIP:"PROJECTIONINVERSE",_matIVM:"MODELVIEWINVERSE",_matIPVM:"MODELVIEWPROJECTIONINVERSE",_matITM:"MODELINVERSETRANSPOSE",_matITVM:"MODELVIEWINVERSETRANSPOSE"}}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(76),u=r(a),s=function(){function e(){o(this,e)}return i(e,null,[{key:"parse",value:function(t){return e._parse(t).then(function(n){return e._parsedCache[t]=n,n})}},{key:"_parse",value:function(t){return new Promise(function(n,r){var o={};u.default.resolveImports(u.default.removeComment(t)).then(function(t){try{var i=u.default.separateTechniqueSource(t);for(var a in i)o[a]=e._parseTechnique(i[a]);n(o)}catch(e){r(e)}})})}},{key:"_parseTechnique",value:function(t){for(var n=u.default.fetchDrawOrder(t)||"Auto",r=u.default.separatePassSource(t),o=new Array(r.length),i=0;i<r.length;i++)o[i]=e._parsePassSource(r[i]);return{drawOrder:n,passes:o}}},{key:"_parsePassSource",value:function(e){var t=u.default.removePreferences(e),n=u.default.parseVariables(e,"attribute"),r=u.default.parseVariables(e,"uniform"),o=u.default.parseMacros(e),i=u.default.parsePreferences(e);return{fragment:t,vertex:t,attributes:n,uniforms:r,macros:o,states:i}}},{key:"_getHash",value:function(e){var t=0,n=void 0,r=void 0,o=void 0;if(0===e.length)return t;for(n=0,o=this.length;n<o;n++)r=e.charCodeAt(n),t=(t<<5)-t+r,t|=0;return t}}]),e}();s._parsedCache={},t.default=s},function(e,t){"use strict";function n(e,t){if(e.length!==t)throw new Error("Unmatching argument count on preference parse");return e.map(function(e){var t=WebGLRenderingContext[e];if("number"!=typeof t)throw new Error("Unknown WebGL constant "+e+" was specified");return t})}function r(e,t){if(e.length!==t)throw new Error("Unmatching argument count on preference parse");return e.map(function(e){var t=Number.parseFloat(e);if(isNaN(t))throw new Error("Failed to parse number on preference parsing");return t})}function o(e,t){if(e.length!==t)throw new Error("Unmatching argument count on preference parse");return e.map(function(e){if("true"!==e&&"false"!==e)throw new Error(e+" is not boolean");return"true"===e})}Object.defineProperty(t,"__esModule",{value:!0}),t.default={Enable:function(e,t){var n=WebGLRenderingContext[t[0]];if("number"!=typeof n)throw new Error('Unknown WebGL constant "'+t[0]+'" was specified on @Enable');e.enable.push(n)},Disable:function(e,t){var n=WebGLRenderingContext[t[0]];if("number"!=typeof n)throw new Error('Unknown WebGL constant "'+t[0]+'" was specified on @Disable');var r=e.enable.indexOf(n);r!==r&&e.enable.splice(r,1)},BlendFunc:function(e,t){var r=n(t,2);e.functions.blendFuncSeparate=[r[0],r[1],r[0],r[1]]},BlendFuncSeparate:function(e,t){e.functions.blendFuncSeparate=n(t,4)},BlendEquation:function(e,t){var r=n(t,1);e.functions.blendEquationSeparate=[r[0],r[0]]},BlendEquationSeparate:function(e,t){e.functions.blendEquationSeparate=n(t,4)},BlendColor:function(e,t){e.functions.blendColor=r(t,4)},ColorMask:function(e,t){e.functions.colorMask=o(t,4),e.enable.push(WebGLRenderingContext.COLOR_WRITEMASK)},CullFace:function(e,t){e.functions.cullFace=n(t,1)},DepthFunc:function(e,t){e.functions.depthFunc=n(t,1)},DepthRange:function(e,t){e.functions.depthRange=r(t,2)},FrontFace:function(e,t){e.functions.frontFace=n(t,1)},LineWidth:function(e,t){e.functions.lineWidth=r(t,1)},PolygonOffset:function(e,t){e.functions.polygonOffset=r(t,2),e.enable.push(WebGLRenderingContext.POLYGON_OFFSET_FILL)},Scissor:function(e,t){e.functions.scissor=r(t,4),e.enable.push(WebGLRenderingContext.SCISSOR_TEST)},ExposeMacro:function(e,t){}}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(75),u=r(a),s=n(77),l=r(s),f=n(73),c=r(f),d=n(72),h=r(d),p=function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{s(r.next(e))}catch(e){i(e)}}function u(e){try{s(r.throw(e))}catch(e){i(e)}}function s(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(a,u)}s((r=r.apply(e,t)).next())})},_=function(){function e(){o(this,e)}return i(e,null,[{key:"separateTechniqueSource",value:function(t){if(t.indexOf("@Technique")===-1)return{default:t};for(var n={},r=/@Technique\s+([a-zA-Z0-9_]+)/g,o=void 0;o=r.exec(t);){var i=o[1];if(void 0!==n[i])throw new Error("Technique name "+i+" is dupelicated");n[i]=e.obtainNextSection(t,"{","}",o.index+o.length)}return n}},{key:"separatePassSource",value:function(t){if(t.indexOf("@Pass")===-1)return[t];for(var n=[],r=/@Pass/g,o=void 0;o=r.exec(t);)n.push(e.obtainNextSection(t,"{","}",o.index+o.length));return n}},{key:"fetchDrawOrder",value:function(e){var t=/@DrawOrder\s*\((\w+)\)/g.exec(e);if(t){var n=e.indexOf("@Pass");if(n!==-1&&n<t.index)throw new Error("DrawOrder preference should be just under @Technique section");return t[1]}return null}},{key:"removePreferences",value:function(e){var t=/@.+$/gm;return e.replace(t,"")}},{key:"resolveImports",value:function(t){return p(this,void 0,void 0,regeneratorRuntime.mark(function n(){var r,o;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(r=/\s*@import\s+"([^"]+)"/.exec(t)){n.next=4;break}return n.abrupt("break",17);case 4:return o=void 0,n.t0=e,n.next=8,h.default.resolve(r[1]);case 8:return n.t1=n.sent,n.next=11,n.t0.resolveImports.call(n.t0,n.t1);case 11:if(o=n.sent){n.next=14;break}throw new Error("Required shader chunk '"+r[1]+"' was not found!!");case 14:t=t.replace(r[0],"\n"+o+"\n"),n.next=0;break;case 17:return n.abrupt("return",t);case 18:case"end":return n.stop()}},n,this)}))}},{key:"parseMacros",value:function(e){for(var t={},n=/@ExposeMacro\s*\(\s*([a-zA-Z0-9_]+)\s*,\s*([a-zA-Z0-9_]+)\s*,\s*([a-zA-Z0-9_]+)\s*,\s*([a-zA-Z0-9_]+)\s*\)/g,r=void 0;r=n.exec(e);){if(!(r[1]&&r[2]&&r[3]&&r[4]))throw new Error("Invalid parameter was passed on @ExposeMacro preference on '"+r[0]+"'");if("bool"!==r[1]&&"int"!==r[1])throw new Error('Invalid macro type "'+r[1]+'". regexResult type must be int or bool');var o=void 0;if("bool"===r[1]){if("true"!==r[4]&&"false"!==r[4])throw new Error('Default macro value "'+r[4]+'" is invalid for bool type macro. Must be true or false');o="true"===r[4]}else if(o=parseFloat(r[4]),isNaN(o))throw new Error('Default macro value "'+r[4]+'" is invalid for int type macro. Must be a number.');t[r[2]]={name:r[2],macroName:r[3],type:r[1],value:o}}return t}},{key:"parsePreferences",value:function(e){for(var t={enable:[WebGLRenderingContext.CULL_FACE,WebGLRenderingContext.BLEND,WebGLRenderingContext.DEPTH_TEST],functions:{blendColor:[0,0,0,0],cullFace:[WebGLRenderingContext.BACK],blendFuncSeparate:[WebGLRenderingContext.SRC_ALPHA,WebGLRenderingContext.ONE_MINUS_SRC_ALPHA,WebGLRenderingContext.SRC_ALPHA,WebGLRenderingContext.ONE_MINUS_SRC_ALPHA],blendEquationSeparate:[WebGLRenderingContext.FUNC_ADD,WebGLRenderingContext.FUNC_ADD],lineWidth:[1],frontFace:[WebGLRenderingContext.CCW],depthRange:[0,1],depthFunc:[WebGLRenderingContext.LESS]}},n=/@([A-Za-z]+)\(([a-zA-Z_0-9,\.\-]*)\)/g,r=void 0;r=n.exec(e);){var o=u.default[r[1]];if(!o)throw new Error("Unknown pass preference "+r[1]+" was specified.");o(t,r[2].split(","))}return t}},{key:"asValidJSON",value:function(e){var t=/([\{,]\s*)([a-zA-Z0-9_]+)(\s*\:)/gm,n=e.replace(t,'$1"$2"$3');return n}},{key:"removeComment",value:function(e){for(var t="",n=!1,r=!1,o=0;o<e.length;o++){var i=e.charAt(o);if("/"===i&&o+1<e.length){if("/"===e.charAt(o+1)&&!r){n=!0,o++;continue}if("*"===e.charAt(o+1)&&!n){r=!0,o++;continue}}if("*"===i&&r&&o+1<e.length&&"/"===e.charAt(o+1))r=!1,o++;else{if("\n"===i){if(n){n=!1;continue}r&&(t+="\n")}n||r||(t+=i)}}return t}},{key:"obtainNextSection",value:function(e,t,n,r){var o=e.indexOf(t,r);if(o===-1)throw new Error("Begining section charactor '"+t+"' was not found.");if(t.length>1||n.length>1)throw new Error("Invalid parameter");for(var i=1,a=t.charCodeAt(0),u=n.charCodeAt(0),s=o+1;s<e.length;s++){var l=e.charCodeAt(s);if(l===a?i++:l===u&&i--,0===i)return e.substring(o+1,s)}throw new Error("Invalid bracket matching")}},{key:"generateVariableFetchRegex",value:function(e){return new RegExp("(?:@([a-zA-Z0-9_]+)?(\\{.+\\})?)?\\s*"+e+"\\s+(?:(lowp|mediump|highp)\\s+)?([a-z0-9A-Z]+)\\s+([a-zA-Z0-9_]+)(?:\\s*\\[\\s*([a-zA-Z0-9_]+)\\s*\\]\\s*)?\\s*;","g")}},{key:"parseVariables",value:function(t,n){for(var r={},o=e.generateVariableFetchRegex(n),i=void 0;i=o.exec(t);){var a=i[5],u=l.default[i[4]],s=i[3],f=i[2],d=void 0!==i[6],h=void 0,p=i[1];p||(p=c.default[n][a],p||(p="uniform"===n?"USER_VALUE":a.toUpperCase())),d&&(h=parseInt(i[6],10),isNaN(h)&&(h=i[6])),r[a]={semantic:p,name:a,type:u,precision:s,attributes:f?JSON.parse(e.asValidJSON(f)):{},isArray:d,count:h}}return r}}]),e}();t.default=_},function(e,t){"use strict";if(Object.defineProperty(t,"__esModule",{value:!0}),!WebGLRenderingContext.ONE)throw new Error("WebGLRenderingContext constant can not be retrived!");var n=WebGLRenderingContext,r={vec2:n.FLOAT_VEC2,vec3:n.FLOAT_VEC3,vec4:n.FLOAT_VEC4,ivec2:n.INT_VEC2,ivec3:n.INT_VEC3,ivec4:n.INT_VEC4,bvec2:n.BOOL_VEC2,bvec3:n.BOOL_VEC3,bvec4:n.BOOL_VEC4,float:n.FLOAT,int:n.INT,bool:n.BOOL,sampler2D:n.SAMPLER_2D,samplerCube:n.SAMPLER_CUBE,mat4:n.FLOAT_MAT4,mat3:n.FLOAT_MAT3,mat2:n.FLOAT_MAT2};t.default=r},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.math.AABB},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.math.Quaternion},function(e,t){e.exports="/*Header start*/\n// helper macros\n#ifdef FS\n  #define FS_PREC(prec,type) precision prec type;\n  #define VS_PREC(prec,type)\n#endif\n#ifdef VS\n#define VS_PREC(prec,type) precision prec type;\n#define FS_PREC(prec,type)\n#endif\n// constants\n#define PI 3.141592653589793\n#define E 2.718281828459045\n#define LN2 0.6931471805599453\n#define LN10 2.302585092994046\n#define LOG2E 1.4426950408889634\n#define LOG10E 0.4342944819032518\n#define SQRT2 1.4142135623730951\n#define SQRT1_2 0.7071067811865476\n/*Header end*/\n"},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(7),i=r(o),a=n(6),u=r(a);u.default.add("MODELVIEWPROJECTION",function(e){return function(t,n){t.uniformMatrix(e.name,n.transform.calcPVM(n.camera))}}),u.default.add("LOCAL",function(e){return function(t,n){t.uniformMatrix(e.name,n.transform.localTransform)}}),u.default.add("MODEL",function(e){return function(t,n){t.uniformMatrix(e.name,n.transform.globalTransform)}}),u.default.add("VIEW",function(e){return function(t,n){t.uniformMatrix(e.name,n.camera.ViewMatrix)}}),u.default.add("PROJECTION",function(e){return function(t,n){t.uniformMatrix(e.name,n.camera.ProjectionMatrix)}}),u.default.add("MODELINVERSE",function(e){return function(t,n){t.uniformMatrix(e.name,i.default.inverse(n.transform.globalTransform))}}),u.default.add("VIEWINVERSE",function(e){return function(t,n){t.uniformMatrix(e.name,i.default.inverse(n.camera.ViewMatrix))}}),u.default.add("PROJECTIONINVERSE",function(e){return function(t,n){t.uniformMatrix(e.name,n.camera.InvProjectionMatrix)}}),u.default.add("MODELVIEWINVERSE",function(e){return function(t,n){t.uniformMatrix(e.name,i.default.inverse(n.transform.calcVM(n.camera)))}}),u.default.add("MODELVIEWPROJECTIONINVERSE",function(e){return function(t,n){t.uniformMatrix(e.name,i.default.inverse(n.transform.calcPVM(n.camera)))}}),u.default.add("MODELINVERSETRANSPOSE",function(e){return function(t,n){t.uniformMatrix(e.name,i.default.transpose(i.default.inverse(n.transform.globalTransform)))}}),u.default.add("MODELVIEWINVERSETRANSPOSE",function(e){return function(t,n){t.uniformMatrix(e.name,i.default.transpose(i.default.inverse(n.transform.calcVM(n.camera))))}}),t.default=null},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(87),i=r(o),a=n(14),u=r(a),s=n(6),l=r(s);l.default.add("VIEWPORT",function(e){return function(t,n){var r=n.viewport;t.uniformVector4(e.name,new u.default(r.Left,r.Top,r.Width,r.Height))}}),l.default.add("VIEWPORT_SIZE",function(e){return function(t,n){var r=n.viewport;t.uniformVector2(e.name,new i.default(r.Width,r.Height))}}),l.default.add("TIME",function(e){return function(t,n){t.uniformFloat(e.name,Date.now()%1e7)}}),l.default.add("HAS_TEXTURE",function(e,t){var n=e.attributes.sampler;if(!n)throw new Error("The variable having HAS_TEXTURE as semantics must have sampler attribute");return function(r,o){var i=!!t.arguments[n]&&!!t.arguments[n].get(o.buffers);r.uniformBool(e.name,i)}}),l.default.add("CAMERA_POSITION",function(e){return function(t,n){t.uniformVector3(e.name,n.camera.transform.globalPosition)}}),l.default.add("CAMERA_DIRECTION",function(e){return function(t,n){t.uniformVector3(e.name,n.camera.transform.forward)}}),t.default=null},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t,n,r,o){var i=void 0;i=t?s.array:s.single,i[e]=function(e,t){return t.addArgument(e.name,{converter:n,default:e.attributes.default?e.attributes.default:r}),{register:function(n,r){o(n,e.name,t.arguments[e.name],r)},dispose:function(){t.deleteArgument(e.name)}}}}Object.defineProperty(t,"__esModule",{value:!0});var i=n(6),a=r(i),u=WebGLRenderingContext,s={array:{},single:{}};a.default.add("USER_VALUE",function(e,t){var n=void 0;if(e.count){if(n=s.array[e.type],!n)throw new Error("No user_value registerer was registered for "+e.type+"[]")}else if(n=s.single[e.type],!n)throw new Error("No user_value registerer was registered for "+e.type);return n(e,t)}),o(u.FLOAT,!1,"Number",0,function(e,t,n){return e.uniformFloat(t,n)}),o(u.INT,!1,"Number",0,function(e,t,n){return e.uniformInt(t,n)}),o(u.BOOL,!1,"Boolean",!1,function(e,t,n){return e.uniformBool(t,n)}),o(u.INT_VEC2,!1,"Vector2",[0,0],function(e,t,n){return e.uniformVector2(t,n)}),o(u.INT_VEC3,!1,"Vector3",[0,0,0],function(e,t,n){return e.uniformVector3(t,n)}),o(u.INT_VEC4,!1,"Vector4",[0,0,0,0],function(e,t,n){return e.uniformVector4(t,n)}),o(u.FLOAT_VEC2,!1,"Vector2",[0,0],function(e,t,n){return e.uniformVector2(t,n)}),o(u.FLOAT_MAT4,!0,"Object",[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],function(e,t,n){return e.uniformMatrixArray(t,n)}),o(u.SAMPLER_2D,!1,"Texture",null,function(e,t,n,r){var o=void 0;n&&(o=n.get(r.buffers))?e.uniformTexture2D(t,o):e.uniformTexture2D(t,r.defaultTexture)}),s.single[u.FLOAT_VEC3]=function(e,t){var n="color"===e.attributes.type,r=e.attributes.default,o=r?r:n?[1,1,1]:[0,0,0];return t.addArgument(e.name,{converter:n?"Color3":"Vector3",default:o}),{register:n?function(n,r){n.uniformColor3(e.name,t.arguments[e.name])}:function(n,r){n.uniformVector3(e.name,t.arguments[e.name])},dispose:function(){t.deleteArgument(e.name)}}},s.single[u.FLOAT_VEC4]=function(e,t){var n="color"===e.attributes.type,r=e.attributes.default,o=r?r:n?[1,1,1,1]:[0,0,0,0];return t.addArgument(e.name,{converter:n?"Color4":"Vector4",default:o}),{register:n?function(n,r){n.uniformColor4(e.name,t.arguments[e.name])}:function(n,r){n.uniformVector4(e.name,t.arguments[e.name])},dispose:function(){t.deleteArgument(e.name)}}},t.default=null},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(57),i=r(o),a=n(54),u=r(a),s=n(9),l=r(s),f=n(27),c=r(f),d=n(28),h=r(d),p=n(29),_=r(p),b=n(30),v=r(b),m=n(31),y=r(m),g=n(32),w=r(g),E=n(33),R=r(E),O=n(18),C=r(O),x=n(19),T=r(x),M=n(5),P=r(M),A=n(34),S=r(A),k=n(35),j=r(k),L=n(36),N=r(L),I=n(37),G=r(I),F=n(38),W=r(F),D=n(41),B=r(D),V=n(42),U=r(V),z=n(39),q=r(z),H=n(40),$=r(H),X=n(10),Y=r(X),J=n(43),Z=r(J),Q=n(20),K=r(Q),ee=n(3),te=r(ee),ne=n(44),re=r(ne),oe=n(45),ie=r(oe),ae=n(46),ue=r(ae),se=n(47),le=r(se),fe=n(48),ce=r(fe),de=n(52),he=r(de),pe=n(49),_e=r(pe),be=n(50),ve=r(be),me=n(51),ye=r(me),ge=n(53),we=r(ge),Ee=function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{s(r.next(e))}catch(e){i(e)}}function u(e){try{s(r.throw(e))}catch(e){i(e)}}function s(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(a,u)}s((r=r.apply(e,t)).next())})};t.default=function(){l.default.register(function(){return Ee(void 0,void 0,void 0,regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=l.default.ns("HTTP://GRIMOIRE.GL/NS/DEFAULT"),l.default.registerComponent(t("AssetLoadingManager"),c.default),l.default.registerComponent(t("Camera"),h.default),l.default.registerComponent(t("CanvasInitializer"),_.default),l.default.registerComponent(t("Fullscreen"),v.default),l.default.registerComponent(t("Geometry"),y.default),l.default.registerComponent(t("GeometryRegistory"),w.default),l.default.registerComponent(t("HTMLBinder"),R.default),l.default.registerComponent(t("LoopManager"),C.default),l.default.registerComponent(t("Material"),T.default),l.default.registerComponent(t("MaterialContainer"),P.default),l.default.registerComponent(t("MaterialImporter"),S.default),l.default.registerComponent(t("MaterialManager"),j.default),l.default.registerComponent(t("MeshRenderer"),N.default),l.default.registerComponent(t("MouseCameraControl"),G.default),l.default.registerComponent(t("RenderBuffer"),W.default),
l.default.registerComponent(t("Renderer"),B.default),l.default.registerComponent(t("RendererManager"),U.default),l.default.registerComponent(t("RenderQuad"),q.default),l.default.registerComponent(t("RenderScene"),$.default),l.default.registerComponent(t("Scene"),Y.default),l.default.registerComponent(t("TextureBuffer"),Z.default),l.default.registerComponent(t("Texture"),K.default),l.default.registerComponent(t("Transform"),te.default),l.default.registerConverter(t("CanvasSize"),re.default),l.default.registerConverter(t("Component"),ie.default),l.default.registerConverter(t("Enum"),ue.default),l.default.registerConverter(t("Geometry"),le.default),l.default.registerConverter(t("Material"),ce.default),l.default.registerConverter(t("Texture"),he.default),l.default.registerConverter(t("NumberArray"),_e.default),l.default.registerConverter(t("Number"),ve.default),l.default.registerConverter(t("Object"),ye.default),l.default.registerConverter(t("Texture2D"),he.default),l.default.registerConverter(t("Viewport"),we.default),l.default.registerNode("goml",["CanvasInitializer","LoopManager","AssetLoadingManager","GeometryRegistory","MaterialManager","RendererManager","Fullscreen"]),l.default.registerNode("renderer",["Renderer"]),l.default.registerNode("scene",["Scene"]),l.default.registerNode("camera",["Camera"],{position:"0,0,10"},"object"),l.default.registerNode("empty",[]),l.default.registerNode("object",["Transform"]),l.default.registerNode("geometry",["Geometry"]),l.default.registerNode("texture",["Texture"]),l.default.registerNode("mesh",["MaterialContainer","MeshRenderer"],{},"object"),l.default.registerNode("material",["Material"]),l.default.registerNode("import-material",["MaterialImporter"]),l.default.registerNode("texture-buffer",["TextureBuffer"]),l.default.registerNode("render-buffer",["RenderBuffer"]),l.default.registerNode("render-scene",["MaterialContainer","RenderScene"],{material:null}),l.default.registerNode("render-quad",["MaterialContainer","RenderQuad"],{material:null}),u.default.register(),i.default.register();case 52:case"end":return e.stop()}},e,this)}))})}},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.math.Color4},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.math.Rectangle},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.math.Vector2},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.Base.EEObject},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.Base.IDObject},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.GrimoireInterface},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.Node.GomlNode},function(e,t){e.exports='<div style="width:100%;height:100%;position: relative;">\n    <div style="width: 55px;height: 55px;border-radius: 100%;border: 5px solid #381794;border-right-color: #FC659D;animation: rotate 1s linear infinite;position: absolute;top: 0;left: 0;right: 0;bottom: 0;margin: auto;"></div>\n</div>\n<style type="text/css">\n    @keyframes rotate {\n        from {\n            transform: rotate(0deg);\n        }\n        to {\n            transform: rotate(360deg);\n        }\n    }\n</style>\n'},function(e,t){e.exports='@Technique default{\n@Pass{\n  @BlendFunc(SRC_ALPHA,ONE_MINUS_SRC_ALPHA)\n  @ExposeMacro(bool,test,TEST,true)\n  @ExposeMacro(int,test2,TEST2,3)\n  FS_PREC(mediump,float)\n  varying vec2 vTexCoord;\n  #ifdef VS\n\n  attribute vec3 position;\n  attribute vec2 texCoord;\n  @MODELVIEWPROJECTION\n  uniform mat4 _matPVM;\n  void main()\n  {\n    gl_Position = _matPVM * vec4(position,1.0);\n    vTexCoord = texCoord;\n  }\n  #endif\n  #ifdef FS\n  @{type:"color",default:"white"}\n  uniform vec4 color;\n\n  uniform sampler2D texture;\n  @HAS_TEXTURE{sampler:"texture"}\n  uniform bool _textureUsed;\n\n  uniform float _time;\n  void main(void)\n  {\n    if(_textureUsed){\n      gl_FragColor = color * texture2D(texture,vTexCoord);\n    }else{\n      gl_FragColor = color;\n   }\n  }\n  #endif\n}\n}\n'}])});
//# sourceMappingURL=grimoire-fundamental.min.js.map