!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var r=t();for(var n in r)("object"==typeof exports?exports:e)[n]=r[n]}}(this,function(){return function(e){function t(n){if(r[n])return r[n].exports;var o=r[n]={exports:{},id:n,loaded:!1};return e[n].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var r={};return t.m=e,t.c=r,t.p="",t(0)}([function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=r(27),i=n(o),a=r(14),u=n(a),s=r(15),l=n(s),f=r(16),c=n(f),d=r(28),h=n(d),p=r(29),b=n(p),v=r(30),m=n(v),g=r(31),y=n(g),_=r(32),w=n(_),x=r(33),R=n(x),E=r(34),C=n(E),k=r(35),P=n(k),O=r(36),M=n(O),T=r(37),A=n(T),j=r(38),S=n(j),N=r(17),L=n(N),G=r(39),F=n(G),I=r(40),W=n(I),Y=r(41),B=n(Y),D=r(42),U=n(D),z=r(43),V=n(z),q=r(44),H=n(q),$=r(47),X=n($),Z=r(48),Q=n(Z),J=r(45),K=n(J),ee=r(46),te=n(ee),re=r(7),ne=n(re),oe=r(49),ie=n(oe),ae=r(18),ue=n(ae),se=r(4),le=n(se),fe=r(98),ce=n(fe),de=r(99),he=n(de),pe=r(100),be=n(pe),ve=r(101),me=n(ve),ge=r(50),ye=n(ge),_e=r(51),we=n(_e),xe=r(52),Re=n(xe),Ee=r(53),Ce=n(Ee),ke=r(54),Pe=n(ke),Oe=r(55),Me=n(Oe),Te=r(56),Ae=n(Te),je=r(57),Se=n(je),Ne=r(58),Le=n(Ne),Ge=r(59),Fe=n(Ge),Ie=r(60),We=n(Ie),Ye=r(61),Be=n(Ye),De=r(62),Ue=n(De),ze=r(63),Ve=n(ze),qe=r(64),He=n(qe),$e=r(65),Xe=n($e),Ze=r(66),Qe=n(Ze),Je=r(67),Ke=n(Je),et=r(68),tt=n(et),rt=r(19),nt=n(rt),ot=r(69),it=n(ot),at=r(8),ut=n(at),st=r(70),lt=n(st),ft=r(71),ct=n(ft),dt=r(72),ht=n(dt),pt=r(73),bt=n(pt),vt=r(74),mt=n(vt),gt=r(75),yt=n(gt),_t=r(76),wt=n(_t),xt=r(9),Rt=n(xt),Et=r(77),Ct=n(Et),kt=r(78),Pt=n(kt),Ot=r(10),Mt=n(Ot),Tt=r(79),At=n(Tt),jt=r(80),St=n(jt),Nt=r(81),Lt=n(Nt),Gt=r(82),Ft=n(Gt),It=r(83),Wt=n(It),Yt=r(84),Bt=n(Yt),Dt=r(85),Ut=n(Dt),zt=r(86),Vt=n(zt),qt=r(87),Ht=n(qt),$t=r(88),Xt=n($t),Zt=r(20),Qt=n(Zt),Jt=r(89),Kt=n(Jt),er=r(90),tr=n(er),rr=r(21),nr=n(rr),or=r(2),ir=n(or),ar=r(91),ur=n(ar),sr=r(5),lr=n(sr),fr=r(92),cr=n(fr),dr=r(22),hr=n(dr),pr=r(93),br=n(pr),vr=r(94),mr=n(vr),gr=r(23),yr=n(gr),_r=r(24),wr=n(_r),xr=r(103),Rr=n(xr),Er={Asset:{AssetLoader:i.default,CacheResolver:u.default,ExternalResourceResolver:l.default,ImageResolver:c.default,TextFileResolver:h.default},Camera:{BasicCamera:b.default,ViewCameraBase:m.default},Components:{AssetLoadingManagerComponent:y.default,CameraComponent:w.default,CanvasInitializerComponent:R.default,FullscreenComponent:C.default,GeometryComponent:P.default,GeometryRegistoryComponent:M.default,HTMLBinderComponent:A.default,LoopManagerComponent:S.default,MaterialComponent:L.default,MaterialContainerComponent:F.default,MaterialImporterComponent:W.default,MaterialManagerComponent:B.default,MeshRendererComponent:U.default,MouseCameraControlComponent:V.default,RenderBufferComponent:H.default,RendererComponent:X.default,RendererManagerComponent:Q.default,RenderQuadComponent:K.default,RenderSceneComponent:te.default,SceneComponent:ne.default,TextureBufferComponent:ie.default,TextureComponent:ue.default,TransformComponent:le.default},Constraint:{ChildrenComponentConstraint:ce.default,NoChildConstraint:he.default,ParentConstraint:be.default,RootConstraint:me.default},Converters:{Angle2DConverter:ye.default,BooleanConverter:we.default,CanvasSizeConverter:Re.default,Color3Converter:Ce.default,Color4Converter:Pe.default,ComponentConverter:Me.default,EnumConverter:Ae.default,GeometryConverter:Se.default,MaterialConverter:Le.default,NumberArrayConverter:Fe.default,NumberConverter:We.default,ObjectConverter:Be.default,Rotation3Converter:Ue.default,TextureConverter:Ve.default,Vector2Converter:He.default,Vector3Converter:Xe.default,Vector4Converter:Qe.default,ViewportConverter:Ke.default},Geometry:{DefaultPrimitives:tt.default,Geometry:nt.default,GeometryBuilder:it.default,GeometryFactory:ut.default,GeometryUtility:lt.default},Material:{DefaultMacro:ct.default,DefaultMaterial:ht.default,EnvUniformValueResolver:bt.default,ImportResolver:mt.default,MacroRegistory:yt.default,Material:wt.default,MaterialFactory:Rt.default,Pass:Ct.default,PassFactory:Pt.default,SORTPass:Mt.default,TextureReference:At.default,Transformers:{AnnotationRemover:St.default,CommentRemover:Lt.default,GLSLUtil:Ft.default,ImportTransformer:Wt.default,SORTPassParser:Bt.default,UniformRegisterer:Ut.default,VariableAnnotationRemover:Vt.default,VariableParser:Ht.default}},Resource:{Buffer:Xt.default,FrameBuffer:Qt.default,GLExtRequestor:Kt.default,Program:tr.default,RenderBuffer:nr.default,ResourceBase:ir.default,Shader:ur.default,Texture2D:lr.default,UniformProxy:cr.default},SceneRenderer:{DrawPriorty:hr.default,RenderQueue:br.default,RenderQueueRegistry:mr.default},Util:{RotationParser:yr.default,TextureSizeCalculator:wr.default}},Cr=(0,Rr.default)();Object.assign(Cr||{},Er),window.GrimoireJS.lib.fundamental=Er,t.default=Cr},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.Node.Component},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),s=r(106),l=n(s),f=function(e){function t(e){o(this,t);var r=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r.gl=e,r.destroyed=!1,r.valid=!1,r}return a(t,e),u(t,[{key:"destroy",value:function(){this.destroyed=!0}},{key:"valid",get:function(){return this._valid},set:function(e){var t=this;this._valid!==e&&(this._valid=e,this._valid?this._validResolve(this):this.validPromise=new Promise(function(e){t._validResolve=e}))}}]),t}(l.default);t.default=f},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.math.Vector3},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),s=r(11),l=n(s),f=r(3),c=n(f),d=r(13),h=n(d),p=r(12),b=n(p),v=r(26),m=n(v),g=r(1),y=n(g),_=m.default.mat4,w=m.default.vec3,x=m.default.vec4,R=function(e){function t(){o(this,t);var e=i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return e.localTransform=new l.default,e.globalTransform=new l.default,e._children=[],e._cachePVM=new l.default,e._cacheVM=new l.default,e._forward=new c.default([0,0,-1,0]),e._up=new c.default([0,1,0,0]),e._right=new c.default([1,0,0,0]),e._globalPosition=new c.default([0,0,0]),e._globalScale=new c.default([1,1,1]),e._matrixTransformMode=!1,e}return a(t,e),u(t,[{key:"calcPVM",value:function(e){return _.mul(this._cachePVM.rawElements,e.getProjectionViewMatrix().rawElements,this.globalTransform.rawElements),this._cachePVM}},{key:"calcVM",value:function(e){return _.mul(this._cacheVM.rawElements,e.getViewMatrix().rawElements,this.globalTransform.rawElements),this._cacheVM}},{key:"$awake",value:function(){var e=this;this.getAttributeRaw("position").watch(function(t){e._localPosition=t,e._matrixTransformMode=!1,e.updateTransform()}),this.getAttributeRaw("rotation").watch(function(t){e._localRotation=t,e._matrixTransformMode=!1,e.updateTransform()}),this.getAttributeRaw("scale").watch(function(t){e._localScale=t,e._matrixTransformMode=!1,e.updateTransform()}),this.getAttributeRaw("rawMatrix").watch(function(t){if(null!==t){var r=t;e._matrixTransformMode=!0,e.localTransform=r,e.updateGlobalTransform()}}),this._localPosition=this.getAttribute("position"),this._localRotation=this.getAttribute("rotation"),this._localScale=this.getAttribute("scale"),this.updateTransform()}},{key:"$mount",value:function(){this._parentTransform=this.node.parent.getComponent(t),this._parentTransform&&this._parentTransform._children.push(this),this.updateTransform()}},{key:"$unmount",value:function(){this._parentTransform&&(this._parentTransform._children.splice(this._parentTransform._children.indexOf(this),1),this._parentTransform=null)}},{key:"updateTransform",value:function(){this._matrixTransformMode||_.fromRotationTranslationScale(this.localTransform.rawElements,this._localRotation.rawElements,this._localPosition.rawElements,this._localScale.rawElements),this.updateGlobalTransform()}},{key:"updateGlobalTransform",value:function(){this._parentTransform?_.mul(this.globalTransform.rawElements,this._parentTransform.globalTransform.rawElements,this.localTransform.rawElements):_.copy(this.globalTransform.rawElements,this.localTransform.rawElements),this._updateDirections(),this._updateGlobalProperty(),this.node.sendMessage("transformUpdated",this),this._children.forEach(function(e){return e.updateGlobalTransform()})}},{key:"_updateDirections",value:function(){x.transformMat4(this._forward.rawElements,t._forwardBase.rawElements,this.globalTransform.rawElements),x.transformMat4(this._up.rawElements,t._upBase.rawElements,this.globalTransform.rawElements),x.transformMat4(this._right.rawElements,t._rightBase.rawElements,this.globalTransform.rawElements)}},{key:"_updateGlobalProperty",value:function(){this._parentTransform?(w.transformMat4(this._globalPosition.rawElements,this._localPosition.rawElements,this._parentTransform.globalTransform.rawElements),w.transformMat4(this._globalScale.rawElements,this._localScale.rawElements,this._parentTransform.globalTransform.rawElements)):(w.copy(this._globalPosition.rawElements,this._localPosition.rawElements),w.copy(this._globalScale.rawElements,this._localScale.rawElements))}},{key:"globalPosition",get:function(){return this._globalPosition}},{key:"localPosition",get:function(){return this._localPosition},set:function(e){this._localPosition=e,this.setAttribute("position",e)}},{key:"localRotation",get:function(){return this._localRotation},set:function(e){this._localRotation=e,this.setAttribute("rotation",e)}},{key:"globalScale",get:function(){return this._globalScale}},{key:"localScale",get:function(){return this._localScale},set:function(e){this._localScale=e,this.setAttribute("scale",e)}},{key:"forward",get:function(){return this._forward}},{key:"up",get:function(){return this._up}},{key:"right",get:function(){return this._right}}]),t}(y.default);t.default=R,R.attributes={position:{converter:"Vector3",default:c.default.Zero},rotation:{converter:"Rotation3",default:b.default.Identity},scale:{converter:"Vector3",default:c.default.One},rawMatrix:{converter:"Object",default:null}},R._forwardBase=new h.default(0,0,-1,0),R._upBase=new h.default(0,1,0,0),R._rightBase=new h.default(1,0,0,0)},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),s=function e(t,r,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,r,n)}if("value"in o)return o.value;var a=o.get;if(void 0!==a)return a.call(n)},l=r(2),f=n(l),c=function(e){function t(e){o(this,t);var r=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r._texParameterChanged=!0,r._magFilter=WebGLRenderingContext.LINEAR,r._minFilter=WebGLRenderingContext.LINEAR,r._wrapS=WebGLRenderingContext.REPEAT,r._wrapT=WebGLRenderingContext.REPEAT,r.texture=e.createTexture(),r}return a(t,e),u(t,[{key:"update",value:function(e,t,r,n,o,i,a,u){this.gl.bindTexture(WebGLRenderingContext.TEXTURE_2D,this.texture);var s=void 0,l=void 0,f=void 0,c=void 0;void 0===r?(s=t||{flipY:!1,premultipliedAlpha:!1},l=e):(c=e,f=t,s=u||{flipY:!1,premultipliedAlpha:!1}),void 0===s.flipY&&(s.flipY=!1),void 0===s.premultipliedAlpha&&(s.premultipliedAlpha=!1),this.gl.pixelStorei(WebGLRenderingContext.UNPACK_FLIP_Y_WEBGL,s.flipY?1:0),this.gl.pixelStorei(WebGLRenderingContext.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s.premultipliedAlpha?1:0),void 0===r?l instanceof HTMLImageElement?this.gl.texImage2D(WebGLRenderingContext.TEXTURE_2D,0,WebGLRenderingContext.RGBA,WebGLRenderingContext.RGBA,WebGLRenderingContext.UNSIGNED_BYTE,this._justifyImage(l)):l instanceof HTMLCanvasElement?this.gl.texImage2D(WebGLRenderingContext.TEXTURE_2D,0,WebGLRenderingContext.RGBA,WebGLRenderingContext.RGBA,WebGLRenderingContext.UNSIGNED_BYTE,this._justifyCanvas(l)):l instanceof HTMLVideoElement&&this.gl.texImage2D(WebGLRenderingContext.TEXTURE_2D,0,WebGLRenderingContext.RGBA,WebGLRenderingContext.RGBA,WebGLRenderingContext.UNSIGNED_BYTE,this._justifyVideo(l)):(void 0===a&&(a=null),this.gl.texImage2D(WebGLRenderingContext.TEXTURE_2D,c,o,f,r,n,o,i,a)),this._ensureMipmap(),this.valid=!0}},{key:"register",value:function(e){this.gl.activeTexture(WebGLRenderingContext.TEXTURE0+e),this.gl.bindTexture(WebGLRenderingContext.TEXTURE_2D,this.texture),this._texParameterChanged&&this._updateTexParameter()}},{key:"destroy",value:function(){s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",this).call(this),this.gl.deleteTexture(this.texture)}},{key:"_justifyImage",value:function(e){var t=e.naturalWidth,r=e.naturalHeight,n=Math.pow(2,Math.log(Math.min(t,r))/Math.LN2|0);if(t!==r||t!==n){var o=document.createElement("canvas");return o.height=o.width=n,o.getContext("2d").drawImage(e,0,0,t,r,0,0,n,n),o}return e}},{key:"_justifyCanvas",value:function(e){var t=e.width,r=e.height,n=Math.pow(2,Math.log(Math.min(t,r))/Math.LN2|0);return t===r&&t===n||(e.height=e.width=2*n),e}},{key:"_justifyVideo",value:function(e){var t=e.videoWidth,r=e.videoHeight,n=Math.pow(2,Math.log(Math.min(t,r))/Math.LN2|0);if(t!==r||t!==n){var o=document.createElement("canvas");return o.height=o.width=n,o.getContext("2d").drawImage(e,0,0,t,r,0,0,n,n),o}return e}},{key:"_updateTexParameter",value:function(){this.gl.texParameteri(WebGLRenderingContext.TEXTURE_2D,WebGLRenderingContext.TEXTURE_MIN_FILTER,this._minFilter),this.gl.texParameteri(WebGLRenderingContext.TEXTURE_2D,WebGLRenderingContext.TEXTURE_MAG_FILTER,this._magFilter),this.gl.texParameteri(WebGLRenderingContext.TEXTURE_2D,WebGLRenderingContext.TEXTURE_WRAP_S,this._wrapS),this.gl.texParameteri(WebGLRenderingContext.TEXTURE_2D,WebGLRenderingContext.TEXTURE_WRAP_T,this._wrapT),this._texParameterChanged=!1}},{key:"_ensureMipmap",value:function(){(t._filtersNeedsMipmap.indexOf(this.magFilter)>=0||t._filtersNeedsMipmap.indexOf(this.minFilter)>=0)&&(this.gl.bindTexture(WebGLRenderingContext.TEXTURE_2D,this.texture),this.gl.generateMipmap(WebGLRenderingContext.TEXTURE_2D))}},{key:"magFilter",get:function(){return this._magFilter},set:function(e){this._magFilter!==e&&(this._texParameterChanged=!0,this._magFilter=e,this._ensureMipmap())}},{key:"minFilter",get:function(){return this._minFilter},set:function(e){this._minFilter!==e&&(this._texParameterChanged=!0,this._minFilter=e,this._ensureMipmap())}},{key:"wrapS",get:function(){return this._wrapS},set:function(e){this._wrapS!==e&&(this._texParameterChanged=!0,this._wrapS=e)}},{key:"wrapT",get:function(){return this._wrapT},set:function(e){this._wrapT!==e&&(this._texParameterChanged=!0,this._wrapT=e)}}]),t}(f.default);t.default=c,c._filtersNeedsMipmap=[WebGLRenderingContext.LINEAR_MIPMAP_LINEAR,WebGLRenderingContext.LINEAR_MIPMAP_NEAREST,WebGLRenderingContext.NEAREST_MIPMAP_LINEAR,WebGLRenderingContext.NEAREST_MIPMAP_NEAREST]},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),s=r(94),l=n(s),f=r(1),c=n(f),d=function(e){function t(){o(this,t);var e=i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return e.sceneDescription={},e.queueRegistory=new l.default,e}return a(t,e),u(t,[{key:"updateScene",value:function(e){this._lastUpdateIndex!==e&&(this.node.broadcastMessage("update",this.sceneDescription),this._lastUpdateIndex=e)}}]),t}(c.default);t.default=d,d.attributes={}},function(e,t){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=function(){function e(t){r(this,e),this.gl=t}return n(e,[{key:"instanciate",value:function(t,r){var n=e.factoryDelegates[t];if(!n)throw new Error("Can not instanciate unknown geometry type "+t);return n(this.gl,r)}},{key:"instanciateAsDefault",value:function(t){var r=e.factoryArgumentDeclarations[t],n={};for(var o in r){var i=r[o];n[o]=i.default}return this.instanciate(t,n)}}],[{key:"addType",value:function(t,r,n){e.factoryDelegates[t]=n,e.factoryArgumentDeclarations[t]=r}}]),e}();t.default=o,o.factoryDelegates={},o.factoryArgumentDeclarations={}},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=r(22),u=n(a),s=r(10),l=n(s),f=r(75),c=n(f),d=r(78),h=n(d),p=r(28),b=n(p),v=r(76),m=n(v),g=r(114),y=n(g),_=function(e,t,r,n){return new(r||(r=Promise))(function(o,i){function a(e){try{s(n.next(e))}catch(e){i(e)}}function u(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){e.done?o(e.value):new r(function(t){t(e.value)}).then(a,u)}s((n=n.apply(e,t)).next())})},w=function(){function e(t){o(this,e),this.gl=t,this.shaderHeader=e.defaultShaderHeader,this.macro=new c.default}return i(e,[{key:"instanciate",value:function(t){return _(this,void 0,void 0,regeneratorRuntime.mark(function r(){return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(!e.factories[t]){r.next=4;break}return r.abrupt("return",e.factories[t](this));case 4:return r.next=6,this._waitForRegistered(t);case 6:return r.abrupt("return",r.sent);case 7:case"end":return r.stop()}},r,this)}))}},{key:"_waitForRegistered",value:function(t){var r=this;return new Promise(function(n){e._onRegister(t,function(){n(e.factories[t](r))})})}}],[{key:"addMaterialType",value:function(t,r){e.factories[t]=r,e.registerdHandlers[t]&&e.registerdHandlers[t].forEach(function(e){return e()})}},{key:"addSORTMaterial",value:function(t,r){return _(this,void 0,void 0,regeneratorRuntime.mark(function n(){var o;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,h.default.passInfoFromSORT(r);case 2:o=n.sent,e.addMaterialType(t,function(t){var n=o.map(function(e){return new l.default(t,e)});return new m.default(n,e._parseSortDrawOrder(r))});case 4:case"end":return n.stop()}},n,this)}))}},{key:"addSORTMaterialFromURL",value:function(t,r){return _(this,void 0,void 0,regeneratorRuntime.mark(function n(){var o;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,b.default.resolve(r);case 2:return o=n.sent,n.next=5,e.addSORTMaterial(t,o);case 5:case"end":return n.stop()}},n,this)}))}},{key:"_onRegister",value:function(t,r){e.registerdHandlers[t]?e.registerdHandlers[t].push(r):e.registerdHandlers[t]=[r]}},{key:"_parseSortDrawOrder",value:function(e){var t=/@DrawOrder\(\s*([a-zA-Z0-9]+)\s*\)/,r=t.exec(e);if(r){var n=r[1];if(void 0===u.default[n])throw new Error("Specified draw order "+n+" was not found.");return n}}}]),e}();t.default=w,w.defaultShaderHeader=y.default,w.factories={},w.registerdHandlers={}},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),s=r(91),l=n(s),f=r(90),c=n(f),d=r(77),h=n(d),p=function(e){function t(e,r){o(this,t);var n=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));n.factory=e,n.sort=r,n._macroValues={},n.attributes=Object.keys(r.attributes),n.gl=e.gl,n.fs=new l.default(n.gl,WebGLRenderingContext.FRAGMENT_SHADER),n.vs=new l.default(n.gl,WebGLRenderingContext.VERTEX_SHADER),n.program=new c.default(n.gl);for(var a=0;a<r.macros.length;a++){var u=r.macros[a];"boolean"===u.type?u.default&&(n._macroValues[u.macroName]=""):n._macroValues[u.macroName]=u.default}return e.macro.addObserver(function(){n._updateProgram()}),n._updateProgram(),n}return a(t,e),u(t,[{key:"setMacro",value:function(e,t){this._macroValues[e]!==t&&("boolean"==typeof t?this._macroValues[e]=t?"":null:this._macroValues[e]=t,this._updateProgram())}},{key:"getMacro",value:function(e){return this._macroValues[e]}},{key:"__beforeDraw",value:function(e){for(var t in this.sort.gomlAttributes)this.sort.gomlAttributes[t].register(this.program.uniforms,e);var r=!0,n=!1,o=void 0;try{for(var i,a=this.sort.systemRegisterers[Symbol.iterator]();!(r=(i=a.next()).done);r=!0){var u=i.value;u(this.program.uniforms,e)}}catch(e){n=!0,o=e}finally{try{!r&&a.return&&a.return()}finally{if(n)throw o}}var s=!0,l=!1,f=void 0;try{for(var c,d=this.sort.configurator[Symbol.iterator]();!(s=(c=d.next()).done);s=!0){var h=c.value;h(this.gl)}}catch(e){l=!0,f=e}finally{try{!s&&d.return&&d.return()}finally{if(l)throw f}}}},{key:"_updateProgram",value:function(){this.fs.update(this._generateShaderCode("FS")),this.vs.update(this._generateShaderCode("VS")),this.program.update([this.vs,this.fs])}},{key:"_generateShaderCode",value:function(e){return"#define "+e+"\n"+this.factory.shaderHeader+"\n"+this.factory.macro.macroString+"\n"+this._getMaterialMacro()+"\n/*BEGINNING OF USER CODE*/\n"+this.sort.shaderSource}},{key:"_getMaterialMacro",value:function(){var e="";for(var t in this._macroValues)null!==this._macroValues[t]&&(e+="#define "+t+" "+this._macroValues[t]+"\n");return e}}]),t}(h.default);t.default=p},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.math.Matrix},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.math.Quaternion},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.math.Vector4},function(e,t){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=function(e,t,r,n){return new(r||(r=Promise))(function(o,i){function a(e){try{s(n.next(e))}catch(e){i(e)}}function u(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){e.done?o(e.value):new r(function(t){t(e.value)}).then(a,u)}s((n=n.apply(e,t)).next())})},i=function(){function e(t){r(this,e),this.toAbsolute=t,this.cache={},this.resolvers={}}return n(e,[{key:"resolve",value:function(e,t){return o(this,void 0,void 0,regeneratorRuntime.mark(function r(){var n,o;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(n=this.toAbsolute(e),!this._cached(n)){r.next=5;break}return r.abrupt("return",this.cache[n]);case 5:if(!this._resolving(n)){r.next=11;break}return r.next=8,this.resolvers[n];case 8:return r.abrupt("return",r.sent);case 11:return this.resolvers[n]=t(n),r.next=14,this.resolvers[n];case 14:return o=r.sent,this._resolved(n,o),r.abrupt("return",o);case 17:case"end":return r.stop()}},r,this)}))}},{key:"_cached",value:function(e){return"undefined"!=typeof this.cache[e]}},{key:"_resolving",value:function(e){return"undefined"!=typeof this.resolvers[e]}},{key:"_resolved",value:function(e,t){delete this.resolvers[e],this.cache[e]=t}}]),e}();t.default=i},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),s=r(14),l=n(s),f=function(e){function t(){return o(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,t._toAbsolute))}return a(t,e),u(t,null,[{key:"_toAbsolute",value:function(e){var t=document.createElement("a");return t.href=e,t.protocol+"//"+t.host+t.pathname+t.search+t.hash}}]),t}(l.default);t.default=f},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.ImageResolver=void 0;var u=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),s=function e(t,r,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,r,n)}if("value"in o)return o.value;var a=o.get;if(void 0!==a)return a.call(n)},l=r(15),f=n(l),c=t.ImageResolver=function(e){function t(){return o(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,e),u(t,[{key:"resolve",value:function(e){return s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"resolve",this).call(this,e,function(e){return new Promise(function(t,r){var n=new Image;n.onload=function(){t(n)},n.onerror=function(e){r(e)},n.src=e})})}}]),t}(f.default);t.default=new c},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),l=r(10),f=n(l),c=r(1),d=n(c),h=r(2),p=n(h),b=function(e,t,r,n){return new(r||(r=Promise))(function(o,i){function a(e){try{s(n.next(e))}catch(e){i(e)}}function u(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){e.done?o(e.value):new r(function(t){
t(e.value)}).then(a,u)}s((n=n.apply(e,t)).next())})},v=function(e){function t(){o(this,t);var e=i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return e.materialArgs={},e}return a(t,e),s(t,[{key:"$mount",value:function(){var e=this.getAttribute("type");e&&(this.materialPromise=this.companion.get("MaterialFactory").instanciate(e),this._registerAttributes())}},{key:"_registerAttributes",value:function(){return b(this,void 0,void 0,regeneratorRuntime.mark(function e(){var t,r=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.materialPromise;case 2:return this.material=e.sent,t=[],this.material.pass.forEach(function(e){if(e instanceof f.default){var n=function(){var n=e,o=function(e){r.__addAtribute(e,n.sort.gomlAttributes[e]),r.getAttributeRaw(e).watch(function(t){r.materialArgs[e]=t});var o=r.materialArgs[e]=r.getAttribute(e);o instanceof p.default&&t.push(o.validPromise)};for(var i in n.sort.gomlAttributes)o(i);var a=!0,s=!1,l=void 0;try{for(var f,c=function(){var e=f.value;switch(e.type){case"int":return r.__addAtribute(e.attributeName,{converter:"Number",default:e.default}),r.getAttributeRaw(e.attributeName).watch(function(t){n.setMacro(e.macroName,""+Math.floor(t))},!0),{v:{v:void 0}};case"bool":return r.__addAtribute(e.attributeName,{converter:"Boolean",default:e.default}),r.getAttributeRaw(e.attributeName).watch(function(t){n.setMacro(e.macroName,t)},!0),{v:{v:void 0}};default:throw new Error("Unexpected macro type "+e.type)}},d=n.sort.macros[Symbol.iterator]();!(a=(f=d.next()).done);a=!0){var h=c();if("object"===("undefined"==typeof h?"undefined":u(h)))return h.v}}catch(e){s=!0,l=e}finally{try{!a&&d.return&&d.return()}finally{if(s)throw l}}}();if("object"===("undefined"==typeof n?"undefined":u(n)))return n.v}}),e.next=7,Promise.all(t);case 7:this.ready=!0;case 8:case"end":return e.stop()}},e,this)}))}}]),t}(d.default);t.default=v,v.attributes={type:{converter:"String",default:null}}},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),s=r(5),l=n(s),f=r(1),c=n(f),d=r(16),h=n(d),p=function(e,t,r,n){return new(r||(r=Promise))(function(o,i){function a(e){try{s(n.next(e))}catch(e){i(e)}}function u(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){e.done?o(e.value):new r(function(t){t(e.value)}).then(a,u)}s((n=n.apply(e,t)).next())})},b=function(e){function t(){return o(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,e),u(t,[{key:"$mount",value:function(){var e=this,t=this.getAttribute("src");this.texture=new l.default(this.companion.get("gl")),this.texture.magFilter=this.getAttribute("magFilter"),this.texture.minFilter=this.getAttribute("minFilter"),this.texture.wrapT=this.getAttribute("wrapT"),this.texture.wrapS=this.getAttribute("wrapS"),this.getAttributeRaw("magFilter").watch(function(t){return e.texture.magFilter=t}),this.getAttributeRaw("minFilter").watch(function(t){return e.texture.minFilter=t}),this.getAttributeRaw("wrapS").watch(function(t){return e.texture.wrapS=t}),this.getAttributeRaw("wrapT").watch(function(t){return e.texture.wrapT=t}),t&&this._loadTask(t)}},{key:"_loadTask",value:function(e){return p(this,void 0,void 0,regeneratorRuntime.mark(function t(){var r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,h.default.resolve(e);case 2:r=t.sent,this.texture.update(r);case 4:case"end":return t.stop()}},t,this)}))}}]),t}(c.default);t.default=b,b.attributes={src:{converter:"String",default:null},minFilter:{converter:"Enum",default:"LINEAR",table:{LINEAR:WebGLRenderingContext.LINEAR,NEAREST:WebGLRenderingContext.NEAREST,NEAREST_MIPMAP_NEAREST:WebGLRenderingContext.NEAREST_MIPMAP_NEAREST,NEAREST_MIPMAP_LINEAR:WebGLRenderingContext.NEAREST_MIPMAP_LINEAR,LINEAR_MIPMAP_NEAREST:WebGLRenderingContext.LINEAR_MIPMAP_NEAREST,LINEAR_MIPMAP_LINEAR:WebGLRenderingContext.LINEAR_MIPMAP_LINEAR}},magFilter:{converter:"Enum",default:"LINEAR",table:{LINEAR:WebGLRenderingContext.LINEAR,NEAREST:WebGLRenderingContext.NEAREST}},wrapS:{converter:"Enum",default:"REPEAT",table:{REPEAT:WebGLRenderingContext.REPEAT,MIRRORED_REPEAT:WebGLRenderingContext.MIRRORED_REPEAT,CLAMP_TO_EDGE:WebGLRenderingContext.CLAMP_TO_EDGE}},wrapT:{converter:"Enum",default:"REPEAT",table:{REPEAT:WebGLRenderingContext.REPEAT,MIRRORED_REPEAT:WebGLRenderingContext.MIRRORED_REPEAT,CLAMP_TO_EDGE:WebGLRenderingContext.CLAMP_TO_EDGE}}}},function(e,t){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=function(){function e(t,n,o,i){r(this,e),this.verticies=t,this.attribInfo=n,this.indices=o,this.aabb=i;for(var a in n)if("undefined"==typeof t[n[a].bufferName])throw new Error("The buffer request by "+n[a].bufferName+" is not contained in geometry.")}return n(e,[{key:"drawByDefault",value:function(t,r,n){var o=this,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Number.MAX_VALUE,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;r.forEach(function(t){e.bindBufferToAttribute(o,n,t,t)}),e.drawWithCurrentVertexBuffer(this,n,t,i,a)}}],[{key:"bindBufferToAttribute",value:function(e,t,r,n){var o=t.findAttributeLocation(r);if(o<0)return!1;var i=e.attribInfo[n];if(!i)throw new Error('Specified buffer "'+n+' was not found on this geometry while attempt to bind "'+r+'" of attribute variables.\n\n\t  All of the vertex buffer available on this geometry is '+Object.keys(e.attribInfo)+'"');var a=e.verticies[i.bufferName];return a.bind(),t.gl.vertexAttribPointer(o,i.size,i.type,!1,i.stride,i.offset),!0}},{key:"drawWithCurrentVertexBuffer",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Number.MAX_VALUE,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=e.indices[r];if(void 0===i)throw new Error('Specified index buffer "'+r+'" was not found on this geometry.All of the index buffer available on this geometry is "'+Object.keys(e.indices)+'"');i.index.bind(),t.gl.drawElements(i.topology,Math.min(i.count,n),i.type,Math.min(o*i.byteSize+i.byteOffset,(i.count-1)*i.byteSize))}}]),e}();t.default=o},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),s=function e(t,r,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,r,n)}if("value"in o)return o.value;var a=o.get;if(void 0!==a)return a.call(n)},l=r(21),f=n(l),c=r(5),d=n(c),h=r(2),p=n(h),b=function(e){function t(e){o(this,t);var r=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.fbo=e.createFramebuffer(),r}return a(t,e),u(t,[{key:"update",value:function(e,t,r){if(this.gl.bindFramebuffer(WebGLRenderingContext.FRAMEBUFFER,this.fbo),e instanceof d.default){if("undefined"==typeof r&&(r=0),"undefined"==typeof t&&(t=0),this.gl.framebufferTexture2D(WebGLRenderingContext.FRAMEBUFFER,WebGLRenderingContext.COLOR_ATTACHMENT0+r,WebGLRenderingContext.TEXTURE_2D,e.texture,t),this.gl.checkFramebufferStatus(WebGLRenderingContext.FRAMEBUFFER)!==WebGLRenderingContext.FRAMEBUFFER_COMPLETE)throw new Error("INCOMPLETE framebuffer")}else if(e instanceof f.default){var n=t;"undefined"==typeof t&&(n=WebGLRenderingContext.DEPTH_ATTACHMENT),this.gl.framebufferRenderbuffer(WebGLRenderingContext.FRAMEBUFFER,n,WebGLRenderingContext.RENDERBUFFER,e.renderBuffer)}this.gl.bindFramebuffer(WebGLRenderingContext.FRAMEBUFFER,null)}},{key:"bind",value:function(){this.gl.bindFramebuffer(WebGLRenderingContext.FRAMEBUFFER,this.fbo)}},{key:"destroy",value:function(){s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",this).call(this),this.gl.deleteFramebuffer(this.fbo)}}]),t}(p.default);t.default=b},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),s=function e(t,r,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,r,n)}if("value"in o)return o.value;var a=o.get;if(void 0!==a)return a.call(n)},l=r(2),f=n(l),c=function(e){function t(e){o(this,t);var r=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.renderBuffer=e.createRenderbuffer(),r}return a(t,e),u(t,[{key:"update",value:function(e,t,r){this.gl.bindRenderbuffer(WebGLRenderingContext.RENDERBUFFER,this.renderBuffer),this.gl.renderbufferStorage(WebGLRenderingContext.RENDERBUFFER,e,t,r),this.valid=!0}},{key:"bind",value:function(){this.gl.bindRenderbuffer(WebGLRenderingContext.RENDERBUFFER,this.renderBuffer)}},{key:"destroy",value:function(){this.gl.deleteRenderbuffer(this.renderBuffer),s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",this).call(this)}}]),t}(f.default);t.default=c},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={Background:{priorty:1e3},NoAlpha:{priorty:2e3},UseAlpha:{priorty:3e3,descending:!0},NoDepth:{priorty:4e3,descending:!0},Overlay:{priorty:5e3,descending:!0}}},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=r(3),u=n(a),s=r(12),l=n(s),f=function(){function e(){o(this,e)}return i(e,null,[{key:"parseAngle",value:function(e){var t=/^ *(-?[\de+-.]*) *(?:\/ *([\de+-.]*))? *(p|prad|deg|d|r|rad)? *$/gm,r=t.exec(e);if(null==r)throw new Error("faild parse Angle string:'"+e+"'");var n=parseFloat(r[1]);r[2]&&(n/=parseFloat(r[2]));var o=r[3];return null==o&&(o="d"),"r"===o||"rad"===o?n:"p"===o||"prad"===o?n*Math.PI:n/180*Math.PI}},{key:"parseRotation3D",value:function(t){var r=/^ *(x|y|z) *\(([^\(\)]+)\) *$/gm,n=/^ *axis *\(([^\(\),]+),([^\(\),]+),([^\(\),]+),([^\(\),]+)\) *$/gm,o=/^ *([^\(\),]+),([^\(\),]+),([^\(\),]+) *$/gm,i=r.exec(t);if(i){if("x"===i[1])return l.default.angleAxis(e.parseAngle(i[2]),u.default.XUnit);if("y"===i[1])return l.default.angleAxis(e.parseAngle(i[2]),u.default.YUnit);if("z"===i[1])return l.default.angleAxis(e.parseAngle(i[2]),u.default.ZUnit)}var a=n.exec(t);if(a){var s=e.parseAngle(a[1]),f=parseFloat(a[2]),c=parseFloat(a[3]),d=parseFloat(a[4]);return l.default.angleAxis(s,new u.default(f,c,d))}var h=o.exec(t);if(h)return l.default.euler(e.parseAngle(h[1]),e.parseAngle(h[2]),e.parseAngle(h[3]));throw new Error("Unknown format for rotation3D:'"+t+"'")}}]),e}();t.default=f},function(e,t){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=function(){function e(){r(this,e)}return n(e,null,[{key:"getPow2Size",value:function(e,t){var r=Math.pow(2,Math.log(e)/Math.LN2|0),n=Math.pow(2,Math.log(t)/Math.LN2|0);return{width:r,height:n}}}]),e}();t.default=o},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.math.Color4},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.math.GLM},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),s=r(105),l=n(s),f=function(e,t,r,n){return new(r||(r=Promise))(function(o,i){function a(e){try{s(n.next(e))}catch(e){i(e)}}function u(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){e.done?o(e.value):new r(function(t){t(e.value)}).then(a,u)}s((n=n.apply(e,t)).next())})},c=function(e){function t(){o(this,t);var e=i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return e.registerCount=0,e.loadCount=0,e.completeCount=0,e.errorCount=0,e.promise=new Promise(function(t){e._resolve=t}),e}return a(t,e),u(t,[{key:"register",value:function(e){var t=this;return this.registerCount++,new Promise(function(r,n){(function(){return f(this,void 0,void 0,regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e;case 3:t.t0=t.sent,r(t.t0),this.loadCount++,t.next=12;break;case 8:t.prev=8,t.t1=t.catch(0),n(t.t1),this.errorCount++;case 12:this.completeCount++,this._checkLoadCompleted();case 14:case"end":return t.stop()}},t,this,[[0,8]])}))}).bind(t)()})}},{key:"_checkLoadCompleted",value:function(){this.emit("progress",this),this.registerCount===this.completeCount&&this._resolve()}}]),t}(l.default);t.default=c},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.TextFileResolver=void 0;var u=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),s=function e(t,r,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,r,n)}if("value"in o)return o.value;var a=o.get;if(void 0!==a)return a.call(n)},l=r(15),f=n(l),c=t.TextFileResolver=function(e){function t(){return o(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,e),u(t,[{key:"resolve",value:function(e){return s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"resolve",this).call(this,e,function(e){return new Promise(function(t,r){var n=new XMLHttpRequest;n.open("GET",e),n.onload=function(e){t(n.responseText)},n.onerror=function(e){r(e)},n.send()})})}}]),t}(f.default);t.default=new c},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),s=r(30),l=n(s),f=r(26),c=n(f),d=c.default.mat4,h=(c.default.vec3,c.default.vec4,function(e){function t(){o(this,t);var e=i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return e._orthographic=!1,e}return a(t,e),u(t,[{key:"getViewMatrix",value:function(){return this.__viewMatrix}},{key:"getProjectionMatrix",value:function(){return this.__projectionMatrix}},{key:"getInvProjectionMatrix",value:function(){return this.__invProjectionMatrix}},{key:"getProjectionViewMatrix",value:function(){return this.__projectionViewMatrix}},{key:"getFar",value:function(){return this._far}},{key:"setFar",value:function(e){this._far=e,this._recalculateProjection()}},{key:"getNear",value:function(){return this._near}},{key:"setNear",value:function(e){this._near=e,this._recalculateProjection()}},{key:"getAspect",value:function(){return this._aspect}},{key:"setAspect",value:function(e){this._aspect=e,this._recalculateProjection()}},{key:"getFovy",value:function(){return this._fovy}},{key:"setFovy",value:function(e){this._fovy=e,this._recalculateProjection()}},{key:"getOrthoSize",value:function(){return this._orthoSize}},{key:"setOrthoSize",value:function(e){this._orthoSize=e}},{key:"setOrthographicMode",value:function(e){this._orthographic=e,this._recalculateProjection()}},{key:"getOrthographicMode",value:function(){return this._orthographic}},{key:"_recalculateProjection",value:function(){this._orthographic?d.ortho(this.__projectionMatrix.rawElements,-this._orthoSize*this._aspect,this._orthoSize*this._aspect,-this._orthoSize,this._orthoSize,this._near,this._far):d.perspective(this.__projectionMatrix.rawElements,this._fovy,this._aspect,this._near,this._far),d.mul(this.__projectionViewMatrix.rawElements,this.__projectionMatrix.rawElements,this.__viewMatrix.rawElements),d.invert(this.__invProjectionMatrix.rawElements,this.__projectionMatrix.rawElements)}}]),t}(l.default));t.default=h},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=r(3),u=n(a),s=r(11),l=n(s),f=r(13),c=n(f),d=r(26),h=n(d),p=h.default.mat4,b=h.default.vec3,v=h.default.vec4,m=function(){function e(){o(this,e),this._eyeCache=u.default.Zero,this._lookAtCache=u.default.Zero,this._upCache=u.default.Zero,this.__viewMatrix=new l.default,this.__projectionMatrix=new l.default,this.__invProjectionMatrix=new l.default,this.__projectionViewMatrix=new l.default}return i(e,[{key:"updateTransform",value:function(t){b.transformMat4(this._eyeCache.rawElements,u.default.Zero.rawElements,t.globalTransform.rawElements),v.transformMat4(this._lookAtCache.rawElements,e._frontOrigin.rawElements,t.globalTransform.rawElements),b.add(this._lookAtCache.rawElements,this._lookAtCache.rawElements,this._eyeCache.rawElements),v.transformMat4(this._upCache.rawElements,e._upOrigin.rawElements,t.globalTransform.rawElements),p.lookAt(this.__viewMatrix.rawElements,this._eyeCache.rawElements,this._lookAtCache.rawElements,this._upCache.rawElements),p.mul(this.__projectionViewMatrix.rawElements,this.__projectionMatrix.rawElements,this.__viewMatrix.rawElements)}}]),e}();m._frontOrigin=new c.default(0,0,-1,0),m._upOrigin=new c.default(0,1,0,0),t.default=m},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),s=r(6),l=n(s),f=r(27),c=n(f),d=r(1),h=n(d),p=r(110),b=n(p),v=function(e,t,r,n){return new(r||(r=Promise))(function(o,i){function a(e){try{s(n.next(e))}catch(e){i(e)}}function u(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){e.done?o(e.value):new r(function(t){t(e.value)}).then(a,u)}s((n=n.apply(e,t)).next())})},m=function(e){function t(){o(this,t);var e=i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return e.loader=new c.default,e}return a(t,e),u(t,[{key:"$treeInitialized",value:function(){this.getAttribute("autoStart")&&this._autoStart(),this._documentResolver()}},{key:"$awake",value:function(){var e=this;this.companion.set(l.default.ns(this.name.ns)("loader"),this.loader),this.loader.register(new Promise(function(t){e._documentResolver=t}));var t=this.companion.get("canvasContainer");if(this.getAttribute("enableLoader")){var r=document.createElement("div");r.innerHTML=b.default,r.style.width=r.style.height="100%",t.appendChild(r),this._loaderElement=r}}},{key:"_autoStart",value:function(){return v(this,void 0,void 0,regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.loader.promise;case 2:this._loaderElement&&this._loaderElement.remove(),this.node.emit("asset-load-completed"),this.tree("goml").setAttribute("loopEnabled",!0);case 5:case"end":return e.stop()}},e,this)}))}}]),t}(h.default);t.default=m,m.attributes={loadingProgress:{default:0,converter:"Number"},autoStart:{default:!0,converter:"Boolean"},anableLoader:{default:!1,converter:"Boolean"}}},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),s=r(93),l=n(s),f=r(4),c=n(f),d=r(29),h=n(d),p=r(7),b=n(p),v=r(1),m=n(v),g=function(e){function t(){o(this,t);var e=i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return e._renderQueue=new l.default,e}return a(t,e),u(t,[{key:"$awake",value:function(){var e=this.camera=new h.default;this.transform=this.node.getComponent(c.default),this.$transformUpdated(this.transform),this.getAttributeRaw("far").watch(function(t){e.setFar(t)},!0),this.getAttributeRaw("near").watch(function(t){e.setNear(t)},!0),this.getAttributeRaw("fovy").watch(function(t){e.setFovy(t)},!0),this.getAttributeRaw("aspect").watch(function(t){e.setAspect(t)},!0),this.getAttributeRaw("orthoSize").watch(function(t){e.setOrthoSize(t)},!0),this.getAttributeRaw("orthogonal").watch(function(t){e.setOrthographicMode(t)},!0),this.getAttributeRaw("autoAspect").boundTo("_autoAspect")}},{key:"$mount",value:function(){this.containedScene=t._findContainedScene(this.node),this.containedScene.queueRegistory.registerQueue(this._renderQueue)}},{key:"$unmount",value:function(){this.containedScene.queueRegistory.unregisterQueue(this._renderQueue),this.containedScene=null}},{key:"updateContainedScene",value:function(e){this.containedScene&&this.containedScene.updateScene(e)}},{key:"renderScene",value:function(e){this.containedScene&&(this._justifyAspect(e),e.sceneDescription=this.containedScene.sceneDescription,e.defaultTexture=this.companion.get("defaultTexture"),this._renderQueue.renderAll(e,!0,e.loopIndex),this.node.broadcastMessage("render",e))}},{key:"$transformUpdated",value:function(e){this.camera&&this.camera.updateTransform(e)}},{key:"_justifyAspect",value:function(e){if(this._autoAspect){var t=e.viewport.Width/e.viewport.Height;this._aspectCache!==t&&(this.setAttribute("aspect",t),this._aspectCache=t)}}}],[{key:"_findContainedScene",value:function(e){if(e.parent){var r=e.parent.getComponent("Scene");return r&&r instanceof b.default?r:t._findContainedScene(e.parent)}return null}}]),t}(m.default);t.default=g,g.attributes={fovy:{default:"45d",converter:"Angle2D"},near:{default:.01,converter:"Number"},far:{default:100,converter:"Number"},aspect:{default:1.6,converter:"Number"},autoAspect:{default:!0,converter:"Boolean"},orthoSize:{default:100,converter:"Number"},orthogonal:{default:!1,converter:"Boolean"}}},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u,s=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),l=r(107),f=n(l),c=r(5),d=n(c),h=r(89),p=n(h),b=r(1),v=n(b),m=f.default.ns("HTTP://GRIMOIRE.GL/NS/DEFAULT");!function(e){e[e.Aspect=0]="Aspect",e[e.Fit=1]="Fit",e[e.Manual=2]="Manual"}(u||(u={}));var g=function(e){function t(){return o(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,e),s(t,[{key:"$awake",value:function(){var e=this;this._scriptTag=this.companion.get("scriptElement"),this._isContainedInBody(this._scriptTag)&&this._generateCanvas(this._scriptTag),this.getAttributeRaw("width").watch(function(t){e._resize()}),this.getAttributeRaw("height").watch(function(t){e._resize()})}},{key:"_generateCanvas",value:function(e){var t=this;this.canvas=document.createElement("canvas"),window.addEventListener("resize",function(){return t._onWindowResize()}),this._configureCanvas(this.canvas,e);var r=this._getContext(this.canvas);return this._defaultTexture=new d.default(r),this._defaultTexture.update(0,1,1,0,WebGLRenderingContext.RGBA,WebGLRenderingContext.UNSIGNED_BYTE,new Uint8Array([0,0,0,0])),this.companion.set(m("gl"),r),this.companion.set(m("canvasElement"),this.canvas),this.companion.set(m("GLExtRequestor"),new p.default(r)),this.companion.set(m("defaultTexture"),this._defaultTexture),this.canvas}},{key:"_resize",value:function(e){var t=(this.companion.get("canvasElement"),this.getAttribute("width")),r=this.getAttribute("height");if(this._widthMode=this._asResizeMode(t),this._heightMode=this._asResizeMode(r),this._widthMode===this._heightMode&&this._widthMode===u.Aspect)throw new Error("Width and height could not have aspect mode in same time!");this._widthMode===u.Aspect&&(this._ratio=t.aspect),this._heightMode===u.Aspect&&(this._ratio=r.aspect),this._widthMode===u.Manual&&this._applyManualWidth(t.size,e),this._heightMode===u.Manual&&this._applyManualHeight(r.size,e),this._onWindowResize(e)}},{key:"_onWindowResize",value:function(e){var t=this._getParentSize();this._widthMode===u.Fit&&this._applyManualWidth(t.width,e),this._heightMode===u.Fit&&(0===t.height&&f.default.debug&&console.warn("Canvas height parameter specified as fit and height of parent element is 0.\n This is possibly the reason you haven't set css to html or body element."),this._applyManualHeight(t.height,e))}},{key:"_applyManualWidth",value:function(e,t){e!==this.canvas.width&&(this.canvas.width=e,this._canvasContainer.style.width=e+"px",t||this.node.broadcastMessage(1,"resizeCanvas"),
this._heightMode===u.Aspect&&this._applyManualHeight(e/this._ratio,t))}},{key:"_applyManualHeight",value:function(e,t){e!==this.canvas.height&&(this.canvas.height=e,this._canvasContainer.style.height=e+"px",t||this.node.broadcastMessage(1,"resizeCanvas"),this._widthMode===u.Aspect&&this._applyManualWidth(e*this._ratio,t))}},{key:"_getParentSize",value:function(){var e=this._canvasContainer.parentElement,t=e.getBoundingClientRect();return t}},{key:"_asResizeMode",value:function(e){return"fit"===e.mode?u.Fit:"aspect"===e.mode?u.Aspect:u.Manual}},{key:"_configureCanvas",value:function(e,t){e.style.position="absolute",e.style.top="0px",e.style.left="0px",this._canvasContainer=document.createElement("div"),this._canvasContainer.style.position="relative",this._canvasContainer.style.overflow="hidden",this._canvasContainer.appendChild(e),this.getAttribute("containerId")&&(this._canvasContainer.id=this.getAttribute("containerId")),this.getAttribute("containerClass")&&(this._canvasContainer.className=this.getAttribute("containerClass")),this.companion.set(m("canvasContainer"),this._canvasContainer),t.parentElement.insertBefore(this._canvasContainer,t.nextSibling),this._resize(!0)}},{key:"_getContext",value:function(e){var t=e.getContext("webgl");return t||(t=e.getContext("webgl-experimental")),t}},{key:"_isContainedInBody",value:function(e){return!!e.parentElement&&("BODY"===e.parentNode.nodeName||this._isContainedInBody(e.parentElement))}}]),t}(v.default);g.attributes={width:{default:"fit",converter:"CanvasSize"},height:{default:480,converter:"CanvasSize"},containerId:{default:"",converter:"String"},containerClass:{default:"gr-container",converter:"String"}},t.default=g},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),s=r(1),l=n(s),f=function(e){function t(){o(this,t);var e=i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return e._fullscreen=!1,e}return a(t,e),u(t,[{key:"$awake",value:function(){var e=this;this.getAttributeRaw("fullscreen").watch(function(t){e._fullscreen!==t&&(e._fullscreen=t,e._switchFullscreen())})}},{key:"_switchFullscreen",value:function(){this._fullscreen?this.requestFullscreen(this.companion.get("canvasContainer")):this.exitFullscreen()}},{key:"requestFullscreen",value:function(e){if(e.webkitRequestFullscreen)e.webkitRequestFullscreen();else if(e.mozRequestFullScreen)e.mozRequestFullScreen();else if(e.msRequestFullscreen)e.msRequestFullscreen();else{if(!e.requestFullscreen)return void console.error("");e.requestFullscreen()}}},{key:"exitFullscreen",value:function(){document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen?document.msExitFullscreen():document.cancelFullScreen?document.cancelFullScreen():document.exitFullscreen&&document.exitFullscreen()}}]),t}(l.default);t.default=f,f.attributes={fullscreen:{converter:"Boolean",default:!1}}},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),s=r(8),l=n(s),f=r(1),c=n(f),d=function(e){function t(){return o(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,e),u(t,[{key:"$mount",value:function(){var e=this.getAttribute("type");if(e){var t=this.companion.get("GeometryFactory"),r=l.default.factoryArgumentDeclarations[e],n={};for(var o in r)this.__addAtribute(o,r[o]),n[o]=this.getAttribute(o);this.geometry=t.instanciate(e,n);var i=this.companion.get("GeometryRegistory"),a=this.getAttribute("name");if(!a)throw new Error("Name was not specified");i.addGeometry(a,this.geometry)}}}]),t}(c.default);t.default=d,d.attributes={type:{converter:"String",default:null},name:{converter:"String",default:null}}},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),s=r(8),l=n(s),f=r(1),c=n(f),d=r(6),h=n(d),p=function(e){function t(){o(this,t);var e=i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return e._geometries={},e}return a(t,e),u(t,[{key:"$awake",value:function(){this._factory=new l.default(this.companion.get("gl")),this.companion.set(this.name,this),this.companion.set(h.default.ns(this.name.ns)("GeometryFactory"),this._factory);var e=!0,t=!1,r=void 0;try{for(var n,o=this.getAttribute("defaultGeometry")[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){var i=n.value;this.addGeometry(i,this._factory.instanciateAsDefault(i))}}catch(e){t=!0,r=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw r}}}},{key:"addGeometry",value:function(e,t){this._geometries[e]=t}},{key:"removeGeometry",value:function(e){this._geometries[e]&&delete this._geometries[e]}},{key:"getGeometry",value:function(e){return this._geometries[e]}}]),t}(c.default);t.default=p,p.attributes={defaultGeometry:{converter:"StringArray",default:["quad","cube","sphere"]}}},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),s=r(4),l=n(s),f=r(1),c=n(f),d=r(13),h=n(d),p=r(11),b=n(p),v=function(e){function t(){o(this,t);var e=i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return e._isFirstCall=!0,e}return a(t,e),u(t,[{key:"$awake",value:function(){this._canvasContainer=this.companion.get("canvasContainer"),this._currentTransform=this.node.getComponent(l.default)}},{key:"$mount",value:function(){this._canvasContainer=this.companion.get("canvasContainer"),this._currentTransform=this.node.getComponent(l.default)}},{key:"$treeInitialized",value:function(){var e=this;this.getAttributeRaw("targetRenderer").watch(function(t){e._rendererQuery!==t&&e._onRendererChanged()},!0),this.getAttributeRaw("htmlQuery").watch(function(t){e._onQueryChanged(t)},!0)}},{key:"$render",value:function(e){if(this._isFirstCall&&(this._onRendererChanged(),this._isFirstCall=!1),this._queriedElement&&e.caller.node===this._targetNode){var t=e.viewport,r=b.default.transform(this._currentTransform.calcPVM(e.camera.camera),new h.default(0,0,0,1)),n={x:r.X/r.W,y:r.Y/r.W,z:r.Z/r.W};if(n.z>=-1&&n.z<=1){var o={x:t.Left+(n.x+1)/2*t.Width,y:t.Top+(n.y+1)/2*t.Height};this._queriedElement.style.visibility="visible",this._queriedElement.style.left=o.x+"px",this._queriedElement.style.bottom=o.y+"px"}else this._queriedElement.style.visibility="hidden"}}},{key:"_restoreDefault",value:function(){this._canvasContainer.removeChild(this._queriedElement),this._parentCache.appendChild(this._queriedElement);var e=this._queriedElement.style,t=this._styleCache;e.position=t.position,e.left=t.left,e.bottom=t.bottom,e.visibility=t.visibility}},{key:"_beginTrack",value:function(){this._parentCache.removeChild(this._queriedElement),this._canvasContainer.appendChild(this._queriedElement),this._queriedElement.style.position="absolute"}},{key:"_onRendererChanged",value:function(){var e=this,t=!1;this.tree(this.getAttribute("targetRenderer")).forEach(function(r){return!!t||(e._targetNode=r,void(t=!0))})}},{key:"_onQueryChanged",value:function(e){var t=void 0;if(e&&""!==e&&(t=document.querySelectorAll(e)),this._queriedElement&&this._restoreDefault(),t&&0!==t.length){this._queriedElement=t.item(0);var r=this._queriedElement.style;this._styleCache={position:r.position,visibility:r.visibility,left:r.left,bottom:r.bottom},this._parentCache=this._queriedElement.parentElement,this._beginTrack()}else this._queriedElement=void 0,this._parentCache=void 0}}]),t}(c.default);t.default=v,v.attributes={htmlQuery:{default:null,converter:"String"},targetRenderer:{default:"render-scene",converter:"String"}}},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),s=r(1),l=n(s),f=function(e){function t(){o(this,t);var e=i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return e._loopActions=[],e._loopIndex=0,e}return a(t,e),u(t,[{key:"$awake",value:function(){var e=this;this.getAttributeRaw("loopEnabled").watch(function(t){t&&e._begin()}),this._registerNextLoop=window.requestAnimationFrame?function(){window.requestAnimationFrame(e._loop.bind(e))}:function(){window.setTimeout(e._loop.bind(e),1e3/60)}}},{key:"register",value:function(e,t){this._loopActions.push({action:e,priorty:t}),this._loopActions.sort(function(e,t){return e.priorty-t.priorty})}},{key:"_begin",value:function(){this._registerNextLoop()}},{key:"_loop",value:function(){var e=this;this._loopActions.forEach(function(t){return t.action(e._loopIndex)}),this._loopIndex++,this._registerNextLoop()}}]),t}(l.default);f.attributes={loopEnabled:{default:!1,converter:"Boolean"}},t.default=f},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),l=r(22),f=n(l),c=r(2),d=n(c),h=r(10),p=n(h),b=r(1),v=n(b),m=r(6),g=n(m),y=function(e,t,r,n){return new(r||(r=Promise))(function(o,i){function a(e){try{s(n.next(e))}catch(e){i(e)}}function u(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){e.done?o(e.value):new r(function(t){t(e.value)}).then(a,u)}s((n=n.apply(e,t)).next())})},_=function(e){function t(){o(this,t);var e=i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return e.materialArgs={},e.ready=!1,e.useMaterial=!1,e}return a(t,e),s(t,[{key:"getDrawPriorty",value:function(e){if(!this.ready)return Number.MAX_VALUE;var t=f.default[this._drawOrder?this._drawOrder:this.material.drawOrder];return t.descending?(1-e/1e4)*t.priorty:e/1e4*t.priorty}},{key:"$mount",value:function(){this.getAttributeRaw("material").watch(this._onMaterialChanged),this.companion.get("loader").register(this._onMaterialChanged()),this.getAttributeRaw("drawOrder").boundTo("_drawOrder")}},{key:"_onMaterialChanged",value:function(){return y(this,void 0,void 0,regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.getAttribute("material"),void 0!==t){e.next=4;break}return this.useMaterial=!1,e.abrupt("return");case 4:this.useMaterial=!0,this._materialComponent?this._prepareExternalMaterial(t):this._prepareInternalMaterial(t);case 6:case"end":return e.stop()}},e,this)}))}},{key:"_prepareExternalMaterial",value:function(e){return y(this,void 0,void 0,regeneratorRuntime.mark(function t(){var r,n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=this.companion.get("loader"),r.register(e),t.next=4,e;case 4:n=t.sent,this.material=n,this.materialArgs=this._materialComponent.materialArgs,this.ready=!0;case 8:case"end":return t.stop()}},t,this)}))}},{key:"_prepareInternalMaterial",value:function(e){return y(this,void 0,void 0,regeneratorRuntime.mark(function t(){var r,n,o,i=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r=this.companion.get("loader"),r.register(e),e){t.next=4;break}return t.abrupt("return");case 4:return t.next=6,e;case 6:n=t.sent,o=[],n.pass.forEach(function(e){if(e instanceof p.default){var t=function(){var t=e,r=function(e){var r=t.sort.gomlAttributes[e];i.__addAtribute(e,r),i.getAttributeRaw(e).watch(function(t){i.materialArgs[e]=t});var n=i.materialArgs[e]=i.getAttribute(e);n instanceof d.default&&o.push(n.validPromise)};for(var n in t.sort.gomlAttributes)r(n);var a=!0,s=!1,l=void 0;try{for(var f,c=function(){var e=f.value;switch(e.type){case"int":return i.__addAtribute(e.attributeName,{converter:"Number",default:e.default}),i.getAttributeRaw(e.attributeName).watch(function(r){t.setMacro(e.macroName,""+Math.floor(r))},!0),{v:{v:void 0}};case"bool":return i.__addAtribute(e.attributeName,{converter:"Boolean",default:e.default}),i.getAttributeRaw(e.attributeName).watch(function(r){t.setMacro(e.macroName,r)},!0),{v:{v:void 0}}}},h=t.sort.macros[Symbol.iterator]();!(a=(f=h.next()).done);a=!0){var p=c();if("object"===("undefined"==typeof p?"undefined":u(p)))return p.v}}catch(e){s=!0,l=e}finally{try{!a&&h.return&&h.return()}finally{if(s)throw l}}}();if("object"===("undefined"==typeof t?"undefined":u(t)))return t.v}}),Promise.all(o),this.material=n,this.ready=!0;case 12:case"end":return t.stop()}},t,this)}))}}],[{key:"rewriteDefaultMaterial",value:function(e){e!==t._defaultMaterial&&(t._defaultMaterial=e,g.default.componentDeclarations.get("MaterialContainer").attributes.material.default="new("+e+")")}},{key:"defaultMaterial",get:function(){return this._defaultMaterial}}]),t}(v.default);t.default=_,_.attributes={material:{converter:"Material",default:"new(unlit)",componentBoundTo:"_materialComponent"},drawOrder:{converter:"String",default:null}},_._defaultMaterial="unlit"},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),s=r(9),l=n(s),f=r(1),c=n(f),d=function(e){function t(){return o(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,e),u(t,[{key:"$awake",value:function(){if(!this.getAttribute("typeName")||!this.getAttribute("src"))throw new Error("type or src cannot be null in material importer");l.default.addSORTMaterialFromURL(this.getAttribute("typeName"),this.getAttribute("src"))}}]),t}(c.default);t.default=d,d.attributes={typeName:{default:null,converter:"String"},src:{default:null,converter:"String"}}},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),s=r(6),l=n(s),f=r(9),c=n(f),d=r(1),h=n(d),p=function(e){function t(){return o(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,e),u(t,[{key:"$awake",value:function(){var e=l.default.ns(this.name.ns);this.companion.set(e("MaterialFactory"),new c.default(this.companion.get("gl")))}}]),t}(h.default);t.default=p,p.attributes={}},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),s=r(7),l=n(s),f=r(4),c=n(f),d=r(1),h=n(d),p=function(e){function t(){return o(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,e),u(t,[{key:"getRenderingPriorty",value:function(e,t,r){return this._materialContainer.getDrawPriorty(e.transform.globalPosition.addWith(this._geometry.aabb.Center).subtractWith(this._transformComponent.globalPosition).magnitude)}},{key:"$awake",value:function(){this.getAttributeRaw("targetBuffer").boundTo("_targetBuffer"),this.getAttributeRaw("layer").boundTo("_layer"),this.getAttributeRaw("drawOffset").boundTo("_drawOffset"),this.getAttributeRaw("drawCount").boundTo("_drawCount"),this.getAttributeRaw("geometry").boundTo("_geometry")}},{key:"$mount",value:function(){this._transformComponent=this.node.getComponent(c.default),this._materialContainer=this.node.getComponent("MaterialContainer"),this._containedScene=t._findContainedScene(this.node),this._containedScene.queueRegistory.addRenderable(this)}},{key:"$unmount",value:function(){this._containedScene.queueRegistory.removeRenderable(this)}},{key:"render",value:function(e){if(this.node.isActive&&this.enabled&&this._layer===e.layer&&this._geometry&&(e.material||this._materialContainer.ready)){var t={targetBuffer:this._targetBuffer,geometry:this._geometry,attributeValues:null,camera:e.camera,transform:this._transformComponent,buffers:e.buffers,viewport:e.viewport,drawCount:this._drawCount,drawOffset:this._drawOffset,sceneDescription:e.sceneDescription,defaultTexture:e.defaultTexture};e.material?(t.attributeValues=e.materialArgs,e.material.draw(t)):(t.attributeValues=this._materialContainer.materialArgs,this._materialContainer.material.draw(t)),this.companion.get("gl").flush(),this.node.sendMessage("render",e)}}}],[{key:"_findContainedScene",value:function(e){if(e.parent){var r=e.parent.getComponent("Scene");return r&&r instanceof l.default?r:t._findContainedScene(e.parent)}return null}}]),t}(h.default);t.default=p,p.attributes={geometry:{converter:"Geometry",default:"quad"},targetBuffer:{converter:"String",default:"default"},layer:{converter:"String",default:"default"},drawCount:{converter:"Number",default:Number.MAX_VALUE},drawOffset:{converter:"Number",default:0}}},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),s=r(3),l=n(s),f=r(12),c=n(f),d=r(11),h=n(d),p=r(4),b=n(p),v=r(1),m=n(v),g=function(e){function t(){o(this,t);var e=i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return e._lastScreenPos=null,e._xsum=0,e._ysum=0,e._center=0,e}return a(t,e),u(t,[{key:"$awake",value:function(){this.getAttributeRaw("center").boundTo("_center"),this.getAttributeRaw("rotateSpeed").boundTo("_rotateSpeed"),this.getAttributeRaw("zoomSpeed").boundTo("_zoomSpeed"),this.getAttributeRaw("moveSpeed").boundTo("_moveSpeed"),this.getAttributeRaw("origin").boundTo("_origin"),this._transform=this.node.getComponent(b.default)}},{key:"$mount",value:function(){this._initialRight=l.default.copy(this._transform.right),this._initialUp=l.default.copy(this._transform.up),this._initialDirection=this._transform.localPosition.subtractWith(this._origin),this._initialRotation=this._transform.localRotation,this._origin=this._transform.localPosition.addWith(this._transform.forward.multiplyWith(this._center));var e=this.companion.get("canvasElement");e.addEventListener("mousemove",this._mouseMove.bind(this)),e.addEventListener("contextmenu",this._contextMenu.bind(this)),e.addEventListener("mousewheel",this._mouseWheel.bind(this))}},{key:"_contextMenu",value:function(e){e.preventDefault()}},{key:"_mouseMove",value:function(e){if(null===this._lastScreenPos)return void(this._lastScreenPos={x:e.screenX,y:e.screenY});var t=!1,r=e.screenX-this._lastScreenPos.x,n=e.screenY-this._lastScreenPos.y,o=this._transform.localPosition.subtractWith(this._origin).magnitude;if((1&e.buttons)>0&&(this._xsum+=r,this._ysum+=n,this._ysum=Math.min(50*Math.PI,this._ysum),this._ysum=Math.max(50*-Math.PI,this._ysum),t=!0),(2&e.buttons)>0){var i=-r*this._moveSpeed*.01,a=n*this._moveSpeed*.01;this._origin=this._origin.addWith(this._transform.right.multiplyWith(i)).addWith(this._transform.up.multiplyWith(a)),o=this._transform.localPosition.subtractWith(this._origin).magnitude,t=!0}if(t){var u=c.default.angleAxis(-this._xsum*this._rotateSpeed*.01,this._initialUp),s=c.default.angleAxis(-this._ysum*this._rotateSpeed*.01,this._initialRight),f=c.default.multiply(u,s),d=h.default.rotationQuaternion(f),p=h.default.transformNormal(d,this._initialDirection);this._transform.localPosition=this._origin.addWith(l.default.normalize(p).multiplyWith(o)),this._transform.localRotation=c.default.multiply(this._initialRotation,f)}this._lastScreenPos={x:e.screenX,y:e.screenY}}},{key:"_mouseWheel",value:function(e){var t=l.default.normalize(l.default.subtract(this._transform.localPosition,this._origin)),r=-e.deltaY*this._zoomSpeed*.05,n=l.default.subtract(this._origin,this._transform.localPosition).magnitude,o=Math.max(1,n-r);this._transform.localPosition=this._origin.addWith(t.multiplyWith(o)),e.preventDefault()}}]),t}(m.default);t.default=g,g.attributes={rotateSpeed:{default:1,converter:"Number"},zoomSpeed:{default:1,converter:"Number"},moveSpeed:{default:1,converter:"Number"},center:{default:20,converter:"Number"},origin:{default:"0,0,0",converter:"Vector3"}}},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),s=r(21),l=n(s),f=r(1),c=n(f),d=r(24),h=n(d),p=function(e){function t(){return o(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,e),u(t,[{key:"$mount",value:function(){this.buffer=new l.default(this.companion.get("gl"))}},{key:"$unmount",value:function(){this.buffer.destroy(),this.buffer=null}},{key:"$resizeBuffer",value:function(e){var t=this.getAttribute("name");if(!t)throw new Error("Attribute 'name' must be specified.");var r=h.default.getPow2Size(e.width,e.height);this.buffer.update(WebGLRenderingContext.DEPTH_COMPONENT16,r.width,r.height),e.bufferSizes[t]={width:r.width,height:r.height},e.buffers[t]=this.buffer}}]),t}(c.default);t.default=p,p.attributes={name:{converter:"String",default:null}}},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),s=r(20),l=n(s),f=r(1),c=n(f),d=function(e){function t(){return o(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,e),u(t,[{key:"$awake",value:function(){this.getAttributeRaw("targetBuffer").boundTo("_targetBuffer"),this.getAttributeRaw("clearColor").boundTo("_clearColor"),this.getAttributeRaw("clearColorEnabled").boundTo("_clearColorEnabled"),this.getAttributeRaw("clearDepthEnabled").boundTo("_clearDepthEnabled"),this.getAttributeRaw("clearDepth").boundTo("_clearDepth")}},{key:"$mount",value:function(){this._gl=this.companion.get("gl"),this._canvas=this.companion.get("canvasElement");var e=this.companion.get("GeometryRegistory");this._geom=e.getGeometry("quad"),this._materialContainer=this.node.getComponent("MaterialContainer")}},{key:"$bufferUpdated",value:function(e){var t=this.getAttribute("out");"default"!==t&&(this._fbo=new l.default(this.companion.get("gl")),this._fbo.update(e.buffers[t]),this._fboSize=e.bufferSizes[t]);var r=this.getAttribute("depthBuffer");r&&this._fbo&&this._fbo.update(e.buffers[r])}},{key:"$render",value:function(e){if(this._materialContainer.ready){this._fbo?(this._fbo.bind(),this._gl.viewport(0,0,this._fboSize.width,this._fboSize.height)):(this._gl.bindFramebuffer(WebGLRenderingContext.FRAMEBUFFER,null),this._gl.viewport(e.viewport.Left,this._canvas.height-e.viewport.Bottom,e.viewport.Width,e.viewport.Height)),this._fbo&&this._clearColorEnabled&&(this._gl.clearColor(this._clearColor.R,this._clearColor.G,this._clearColor.B,this._clearColor.A),this._gl.clear(WebGLRenderingContext.COLOR_BUFFER_BIT)),
this._clearDepthEnabled&&(this._gl.clearDepth(this._clearDepth),this._gl.clear(WebGLRenderingContext.DEPTH_BUFFER_BIT));var t={targetBuffer:this._targetBuffer,geometry:this._geom,attributeValues:{},camera:null,transform:null,buffers:e.buffers,viewport:e.viewport,defaultTexture:this.companion.get("defaultTexture")};t.attributeValues=this._materialContainer.materialArgs,this._materialContainer.material.draw(t),this._gl.flush()}}}]),t}(c.default);t.default=d,d.attributes={out:{default:"default",converter:"String"},depthBuffer:{default:null,converter:"String"},targetBuffer:{default:"default",converter:"String"},clearColor:{default:"#0000",converter:"Color4"},clearColorEnabled:{default:!0,converter:"Boolean"},clearDepthEnabled:{default:!0,converter:"Boolean"},clearDepth:{default:1,converter:"Number"}}},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),s=r(1),l=n(s),f=r(20),c=n(f),d=function(e){function t(){return o(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,e),u(t,[{key:"$awake",value:function(){this.getAttributeRaw("layer").boundTo("_layer"),this.getAttributeRaw("clearColor").boundTo("_clearColor"),this.getAttributeRaw("clearColorEnabled").boundTo("_clearColorEnabled"),this.getAttributeRaw("clearDepthEnabled").boundTo("_clearDepthEnabled"),this.getAttributeRaw("clearDepth").boundTo("_clearDepth"),this.getAttributeRaw("camera").boundTo("_camera")}},{key:"$mount",value:function(){this._gl=this.companion.get("gl"),this._canvas=this.companion.get("canvasElement"),this._materialContainer=this.node.getComponent("MaterialContainer")}},{key:"$bufferUpdated",value:function(e){var t=this.getAttribute("out");"default"!==t&&(this._fbo=new c.default(this.companion.get("gl")),this._fbo.update(e.buffers[t]),this._fboSize=e.bufferSizes[t]);var r=this.getAttribute("depthBuffer");r&&this._fbo&&this._fbo.update(e.buffers[r])}},{key:"$render",value:function(e){var t=this._camera?this._camera:e.camera;if(t){this._fbo?(this._fbo.bind(),this._gl.viewport(0,0,this._fboSize.width,this._fboSize.height)):(this._gl.bindFramebuffer(WebGLRenderingContext.FRAMEBUFFER,null),this._gl.viewport(e.viewport.Left,this._canvas.height-e.viewport.Bottom,e.viewport.Width,e.viewport.Height)),this._fbo&&this._clearColorEnabled&&(this._gl.clearColor(this._clearColor.R,this._clearColor.G,this._clearColor.B,this._clearColor.A),this._gl.clear(WebGLRenderingContext.COLOR_BUFFER_BIT)),this._clearDepthEnabled&&(this._gl.clearDepth(this._clearDepth),this._gl.clear(WebGLRenderingContext.DEPTH_BUFFER_BIT)),e.camera.updateContainedScene(e.loopIndex);var r=this._materialContainer.useMaterial;e.camera.renderScene({caller:this,camera:t,buffers:e.buffers,layer:this._layer,viewport:e.viewport,material:r?this._materialContainer.material:void 0,materialArgs:r?this._materialContainer.material:void 0,loopIndex:e.loopIndex})}}}]),t}(l.default);t.default=d,d.attributes={layer:{converter:"String",default:"default"},depthBuffer:{default:null,converter:"String"},out:{converter:"String",default:"default"},clearColor:{default:"#0000",converter:"Color4"},clearColorEnabled:{default:!0,converter:"Boolean"},clearDepthEnabled:{default:!0,converter:"Boolean"},clearDepth:{default:1,converter:"Number"},camera:{default:null,converter:"Component",target:"Camera"}}},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),s=r(1),l=n(s),f=function(e){function t(){o(this,t);var e=i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments));return e._buffers={},e._bufferSizes={},e}return a(t,e),u(t,[{key:"$mount",value:function(){var e=this;this._gl=this.companion.get("gl"),this._canvas=this.companion.get("canvasElement"),this._camera=this.getAttribute("camera"),this.getAttributeRaw("camera").watch(function(t){return e._camera=t}),this.getAttributeRaw("viewport").watch(function(t){e._viewportSizeGenerator=t,e.$resizeCanvas()}),this._viewportSizeGenerator=this.getAttribute("viewport")}},{key:"$treeInitialized",value:function(){this.$resizeCanvas()}},{key:"$resizeCanvas",value:function(){this._viewportCache=this._viewportSizeGenerator(this._canvas),0===this.node.children.length&&this.node.addChildByName("render-scene",{}),this.node.broadcastMessage("resizeBuffer",{width:this._viewportCache.Width,height:this._viewportCache.Height,buffers:this._buffers,bufferSizes:this._bufferSizes}),this.node.broadcastMessage("bufferUpdated",{buffers:this._buffers,bufferSizes:this._bufferSizes})}},{key:"$renderViewport",value:function(e){this.node.broadcastMessage("render",{camera:this._camera,viewport:this._viewportCache,bufferSizes:this._bufferSizes,buffers:this._buffers,loopIndex:e.loopIndex})}}]),t}(l.default);t.default=f,f.attributes={camera:{converter:"Component",default:"camera",target:"Camera"},viewport:{converter:"Viewport",default:"auto"}}},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),s=r(25),l=n(s),f=r(1),c=n(f),d=function(e){function t(){return o(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,e),u(t,[{key:"$awake",value:function(){this.getAttributeRaw("bgColor").boundTo("_bgColor"),this.getAttributeRaw("clearDepth").boundTo("_clearDepth")}},{key:"$mount",value:function(){this.gl=this.companion.get("gl")}},{key:"$treeInitialized",value:function(){this.node.getComponent("LoopManager").register(this.onloop.bind(this),1e3),this.getAttribute("complementRenderer")&&0===this.node.getChildrenByNodeName("renderer").length&&this.node.addChildByName("renderer",{})}},{key:"onloop",value:function(e){if(this.enabled){var t=this._bgColor;this.gl.clearColor(t.R,t.G,t.B,t.A),this.gl.clearDepth(this._clearDepth),this.gl.clear(WebGLRenderingContext.COLOR_BUFFER_BIT|WebGLRenderingContext.DEPTH_BUFFER_BIT),this.node.broadcastMessage(1,"renderViewport",{loopIndex:e})}}}]),t}(c.default);t.default=d,d.attributes={bgColor:{default:new l.default(0,0,0,0),converter:"Color4"},clearDepth:{default:1,converter:"Number"},complementRenderer:{default:!0,converter:"Boolean"}}},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),s=r(5),l=n(s),f=r(1),c=n(f),d=r(24),h=n(d),p=function(e){function t(){return o(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,e),u(t,[{key:"$mount",value:function(){this.buffer=new l.default(this.companion.get("gl"))}},{key:"$unmount",value:function(){this.buffer.destroy(),this.buffer=null}},{key:"$resizeBuffer",value:function(e){var t=this.getAttribute("name");if(!t)throw new Error("Attribute 'name' must be specified.");var r=this.getAttribute("format"),n=h.default.getPow2Size(e.width,e.height);this.buffer.update(0,n.width,n.height,0,r,WebGLRenderingContext.UNSIGNED_BYTE,null),e.bufferSizes[t]={width:n.width,height:n.height},e.buffers[t]=this.buffer}}]),t}(c.default);t.default=p,p.attributes={name:{converter:"String",default:null},format:{converter:"Enum",default:WebGLRenderingContext.RGBA,table:{RGBA:WebGLRenderingContext.RGBA,RGB:WebGLRenderingContext.RGB,ALPHA:WebGLRenderingContext.ALPHA,LUMINANCE:WebGLRenderingContext.LUMINANCE,LUMINANCE_ALPHA:WebGLRenderingContext.LUMINANCE_ALPHA,SRGB_EXT:WebGLRenderingContext.SRGB_EXT,SRGB_ALPHA_EXT:WebGLRenderingContext.SRGB_ALPHA_EXT,DEPTH_COMPONENT:WebGLRenderingContext.DEPTH_COMPONENT,DEPTH_STENCIL:WebGLRenderingContext.DEPTH_STENCIL}}}},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e){if("number"==typeof e)return e;if("string"==typeof e)return a.default.parseAngle(e);throw new Error('Passed argument "'+e+"\" can't be parsed as angle.")}Object.defineProperty(t,"__esModule",{value:!0});var i=r(23),a=n(i);t.default=o},function(e,t){"use strict";function r(e){if("boolean"==typeof e)return e;if("string"==typeof e)switch(e){case"true":return!0;case"false":return!1;default:throw new Error("Invalid string "+e+" for parsing as boolean")}throw new Error("Unsupported type to be parsed as boolean")}Object.defineProperty(t,"__esModule",{value:!0}),t.default=r},function(e,t){"use strict";function r(e){if("fit"===e)return{mode:"fit"};if("string"==typeof e){var t=/aspect\(([\d+(?.\d*)?]+)\)/.exec(e);if(t)return{mode:"aspect",aspect:Number.parseFloat(t[1])}}return{mode:"manual",size:Number.parseFloat(e)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=r},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e){if(e instanceof a.default)return e;if(e instanceof s.default)return new a.default(e.R,e.G,e.B);if("string"==typeof e)return a.default.parse(e);if(Array.isArray(e))return new a.default(e[0],e[1],e[2]);throw new Error(e+" can not be parsed as Color4.")}Object.defineProperty(t,"__esModule",{value:!0});var i=r(96),a=n(i),u=r(25),s=n(u);t.default=o},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e){if(e instanceof s.default)return e;if(e instanceof a.default)return new s.default(e.R,e.G,e.B,1);if("string"==typeof e)return s.default.parse(e);if(Array.isArray(e))return new s.default(e[0],e[1],e[2],e[3]);throw new Error(e+" can not be parsed as Color4.")}Object.defineProperty(t,"__esModule",{value:!0});var i=r(96),a=n(i),u=r(25),s=n(u);t.default=o},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e){if(!this.declaration.target)throw new Error("Component converter require to be specified target");if(null===e)return null;if(e instanceof s.default)return e.getComponent(this.declaration.target);if(e instanceof a.default){if(e.name===this.declaration.target)return e;throw new Error("Specified component must be "+this.declaration.target)}var t=this.tree(e).first();return t?t.getComponent(this.declaration.target):null}Object.defineProperty(t,"__esModule",{value:!0});var i=r(1),a=n(i),u=r(108),s=n(u);t.default=o},function(e,t){"use strict";function r(e){if(!this.declaration.table)throw new Error("Enum converter needs to be specified table in attribute dictionary");if("number"==typeof e)return e;if("string"==typeof e){var t=this.declaration.table[e];if(t)return t;throw new Error("Specified value is not exisiting in the relation table")}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=r},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e){if("string"==typeof e)return this.companion.get("GeometryRegistory").getGeometry(e);if(e instanceof a.default)return e;throw new Error('Specified geometry "'+e+'" is not supported for converting into geometry.')}Object.defineProperty(t,"__esModule",{value:!0});var i=r(19),a=n(i);t.default=o},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e){if("string"==typeof e){var t=/\s*new\s*\(\s*([a-zA-Z\d\-]+)\s*\)/,r=void 0;if(r=t.exec(e))return this.component[this.declaration.componentBoundTo]=null,this.companion.get("MaterialFactory").instanciate(r[1]);var n=this.tree(e).single().getComponent(a.default);return this.component[this.declaration.componentBoundTo]=n,n.materialPromise}return null}Object.defineProperty(t,"__esModule",{value:!0});var i=r(17),a=n(i);t.default=o},function(e,t){"use strict";function r(e){if(e instanceof Array)return e;if("string"==typeof e){var t=e.split(",");return t.map(function(e){return Number.parseFloat(e)})}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=r},function(e,t){"use strict";function r(e){if("number"==typeof e)return e;if("string"==typeof e)return Number.parseFloat(e);throw new Error("Unsupported input to convert into number!")}Object.defineProperty(t,"__esModule",{value:!0}),t.default=r},function(e,t){"use strict";function r(e){return e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=r},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e){return e instanceof s.default?e:Array.isArray(e)?new s.default([e[0],e[1],e[2],e[3]]):a.default.parseRotation3D(e)}Object.defineProperty(t,"__esModule",{value:!0});var i=r(23),a=n(i),u=r(12),s=n(u);t.default=o},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){e.update(t),requestAnimationFrame(function(){return o(e,t)})}function i(e){var t=/(query|backbuffer|video)\((.+)\)[^\)]*$/,r=void 0;return(r=t.exec(e))?{type:r[1],param:r[2]}:null}function a(e){var t=document.createElement("video");return t.src=e,t}function u(e,t){var r=new b.default(e);return t.play(),r.update(t),o(r,t),r}function s(e){var t=this;if(e instanceof b.default)return new h.default(e);if("string"==typeof e){var r=i(e);if(r){var n=function(){var e=r.param,n=function(){switch(r.type){case"backbuffer":return{v:{v:new h.default(function(t){return t[e]})}};case"video":return{v:{v:new h.default(u(t.companion.get("gl"),a(e)))}};case"query":var n=t.tree(e),o=n.first().getComponent(c.default);return{v:{v:new h.default(function(){return o.texture})}}}}();if("object"===("undefined"==typeof n?"undefined":l(n)))return n.v}();if("object"===("undefined"==typeof n?"undefined":l(n)))return n.v}else{var o=function(){var r=new b.default(t.companion.get("gl"));return m.default.resolve(e).then(function(e){r.update(e)}),t.companion.get("loader").register(r.validPromise),{v:new h.default(r)}}();if("object"===("undefined"==typeof o?"undefined":l(o)))return o.v}}if("object"===("undefined"==typeof e?"undefined":l(e)))if(e instanceof HTMLImageElement){var s=function(){var r=new b.default(t.companion.get("gl"));return e.complete&&e.naturalWidth?r.update(e):e.onload=function(){r.update(e)},{v:new h.default(r)}}();if("object"===("undefined"==typeof s?"undefined":l(s)))return s.v}else{if(e instanceof HTMLCanvasElement){var f=new b.default(this.companion.get("gl"));return f.update(e),new h.default(f)}if(e instanceof HTMLVideoElement)return new h.default(u(this.companion.get("gl"),e))}return null}Object.defineProperty(t,"__esModule",{value:!0});var l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},f=r(18),c=n(f),d=r(79),h=n(d),p=r(5),b=n(p),v=r(16),m=n(v);t.default=s},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e){return e instanceof a.default?e:"string"==typeof e?a.default.parse(e):"number"==typeof e?new a.default(e,e):Array.isArray(e)?new a.default(e[0],e[1]):void 0}Object.defineProperty(t,"__esModule",{value:!0});var i=r(97),a=n(i);t.default=o},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e){return e instanceof a.default?e:"string"==typeof e?a.default.parse(e):"number"==typeof e?new a.default(e,e,e):Array.isArray(e)?new a.default(e[0],e[1],e[2]):void 0}Object.defineProperty(t,"__esModule",{value:!0});var i=r(3),a=n(i);t.default=o},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e){return e instanceof a.default?e:"string"==typeof e?a.default.parse(e):"number"==typeof e?new a.default(e,e,e,e):Array.isArray(e)?new a.default(e[0],e[1],e[2],e[3]):void 0}Object.defineProperty(t,"__esModule",{value:!0});var i=r(13),a=n(i);t.default=o},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){var r=/(\d+)\s*%/,n=void 0;if(n=r.exec(t)){var o=Number.parseFloat(n[1]);return Math.floor(e*o*.01)}return Math.floor(Number.parseFloat(t))}function i(e){if(e instanceof s.default)return function(){return e};if("string"==typeof e){if("auto"===e)return function(e){return new s.default(0,0,e.width,e.height)};var t=function(){var t=e.split(",");if(4!==t.length)throw new Error("Invalid viewport size was specified.");return{v:function(e){return new s.default(o(e.width,t[0]),o(e.height,t[1]),o(e.width,t[2]),o(e.height,t[3]))}}}();if("object"===("undefined"==typeof t?"undefined":a(t)))return t.v}throw new Error(e+" could not be parsed")}Object.defineProperty(t,"__esModule",{value:!0});var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u=r(104),s=n(u);t.default=i},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=r(95),u=n(a),s=r(3),l=n(s),f=r(70),c=n(f),d=r(8),h=n(d),p=r(69),b=n(p),v=new u.default;v.expand(new l.default(-1,-1,-1)),v.expand(new l.default(1,1,1));var m=function(){function e(){o(this,e)}return i(e,null,[{key:"register",value:function(){e._registerTriangle(),e._registerQuad(),e._registerCube(),e._registerSphere(),e._registerCircle(),e._registerCylinder(),e._registerCone(),e._registerPlane()}},{key:"_registerTriangle",value:function(){h.default.addType("triangle",{},function(e,t){return b.default.build(e,{indices:{default:{generator:regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.delegateYield(c.default.triangleIndex(0),"t0",1);case 1:case"end":return e.stop()}},e,this)}),topology:WebGLRenderingContext.TRIANGLES},wireframe:{generator:regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.delegateYield(c.default.linesFromTriangles(c.default.triangleIndex(0)),"t0",1);case 1:case"end":return e.stop()}},e,this)}),topology:WebGLRenderingContext.LINES}},vertices:{main:{size:{position:3,normal:3,texCoord:2},count:c.default.triangleSize(),getGenerators:function(){return{position:regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.delegateYield(c.default.trianglePosition(l.default.Zero,l.default.YUnit,l.default.XUnit),"t0",1);case 1:case"end":return e.stop()}},e,this)}),normal:regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.delegateYield(c.default.triangleNormal(l.default.ZUnit),"t0",1);case 1:case"end":return e.stop()}},e,this)}),texCoord:regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.delegateYield(c.default.triangleTexCoord(),"t0",1);case 1:case"end":return e.stop()}},e,this)})}}}}})})}},{key:"_registerQuad",value:function(){h.default.addType("quad",{},function(e,t){return b.default.build(e,{indices:{default:{generator:regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.delegateYield(c.default.quadIndex(0),"t0",1);case 1:case"end":return e.stop()}},e,this)}),topology:WebGLRenderingContext.TRIANGLES},wireframe:{generator:regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.delegateYield(c.default.linesFromTriangles(c.default.quadIndex(0)),"t0",1);case 1:case"end":return e.stop()}},e,this)}),topology:WebGLRenderingContext.LINES}},vertices:{main:{size:{position:3,normal:3,texCoord:2},count:c.default.quadSize(),getGenerators:function(){return{position:regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.delegateYield(c.default.quadPosition(l.default.Zero,l.default.YUnit,l.default.XUnit),"t0",1);case 1:case"end":return e.stop()}},e,this)}),normal:regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.delegateYield(c.default.quadNormal(l.default.ZUnit),"t0",1);case 1:case"end":return e.stop()}},e,this)}),texCoord:regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.delegateYield(c.default.quadTexCoord(),"t0",1);case 1:case"end":return e.stop()}},e,this)})}}}}})})}},{key:"_registerCube",value:function(){h.default.addType("cube",{},function(e,t){return b.default.build(e,{indices:{default:{generator:regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.delegateYield(c.default.cubeIndex(0),"t0",1);case 1:case"end":return e.stop()}},e,this)}),topology:WebGLRenderingContext.TRIANGLES},wireframe:{generator:regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.delegateYield(c.default.linesFromTriangles(c.default.cubeIndex(0)),"t0",1);case 1:case"end":return e.stop()}},e,this)}),topology:WebGLRenderingContext.LINES}},vertices:{main:{size:{position:3,normal:3,texCoord:2},count:c.default.cubeSize(),getGenerators:function(){return{position:regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.delegateYield(c.default.cubePosition(l.default.Zero,l.default.YUnit,l.default.XUnit,l.default.ZUnit.negateThis()),"t0",1);case 1:case"end":return e.stop()}},e,this)}),normal:regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.delegateYield(c.default.cubeNormal(l.default.Zero,l.default.YUnit,l.default.XUnit,l.default.ZUnit.negateThis()),"t0",1);case 1:case"end":return e.stop()}},e,this)}),texCoord:regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.delegateYield(c.default.cubeTexCoord(),"t0",1);case 1:case"end":return e.stop()}},e,this)})}}}},aabb:v})})}},{key:"_registerSphere",value:function(){h.default.addType("sphere",{divVertical:{converter:"Number",default:100},divHorizontal:{converter:"Number",default:100}},function(e,t){var r=t.divHorizontal,n=t.divVertical;return b.default.build(e,{indices:{default:{generator:regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.delegateYield(c.default.sphereIndex(0,r,n),"t0",1);case 1:case"end":return e.stop()}},e,this)}),topology:WebGLRenderingContext.TRIANGLES},wireframe:{generator:regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.delegateYield(c.default.linesFromTriangles(c.default.sphereIndex(0,r,n)),"t0",1);case 1:case"end":return e.stop()}},e,this)}),topology:WebGLRenderingContext.LINES}},vertices:{main:{size:{position:3,normal:3,texCoord:2},count:c.default.sphereSize(r,n),getGenerators:function(){return{position:regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.delegateYield(c.default.spherePosition(l.default.Zero,l.default.YUnit,l.default.XUnit,l.default.ZUnit.negateThis(),r,n),"t0",1);case 1:case"end":return e.stop()}},e,this)}),normal:regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.delegateYield(c.default.sphereNormal(l.default.YUnit,l.default.XUnit,l.default.ZUnit.negateThis(),r,n),"t0",1);case 1:case"end":return e.stop()}},e,this)}),texCoord:regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.delegateYield(c.default.sphereTexCoord(r,n),"t0",1);case 1:case"end":return e.stop()}},e,this)})}}}},aabb:v})})}},{key:"_registerCircle",value:function(){h.default.addType("circle",{divide:{converter:"Number",default:50}},function(e,t){var r=t.divide;return b.default.build(e,{indices:{default:{generator:regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.delegateYield(c.default.ellipseIndex(0,r),"t0",1);case 1:case"end":return e.stop()}},e,this)}),topology:WebGLRenderingContext.TRIANGLES},wireframe:{generator:regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.delegateYield(c.default.linesFromTriangles(c.default.ellipseIndex(0,r)),"t0",1);case 1:case"end":return e.stop()}},e,this)}),topology:WebGLRenderingContext.LINES}},vertices:{main:{size:{position:3,normal:3,texCoord:2},count:c.default.ellipseSize(r),getGenerators:function(){return{position:regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.delegateYield(c.default.ellipsePosition(l.default.Zero,l.default.YUnit,l.default.XUnit,r),"t0",1);case 1:case"end":return e.stop()}},e,this)}),normal:regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.delegateYield(c.default.ellipseNormal(l.default.ZUnit,r),"t0",1);case 1:case"end":return e.stop()}},e,this)}),texCoord:regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.delegateYield(c.default.ellipseTexCoord(r),"t0",1);case 1:case"end":return e.stop()}},e,this)})}}}}})})}},{key:"_registerCylinder",value:function(){h.default.addType("cylinder",{divide:{converter:"Number",default:50}},function(e,t){var r=t.divide;return b.default.build(e,{indices:{default:{generator:regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.delegateYield(c.default.cylinderIndex(0,r),"t0",1);case 1:case"end":return e.stop()}},e,this)}),topology:WebGLRenderingContext.TRIANGLES},wireframe:{generator:regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.delegateYield(c.default.linesFromTriangles(c.default.cylinderIndex(0,r)),"t0",1);case 1:case"end":return e.stop()}},e,this)}),topology:WebGLRenderingContext.LINES}},vertices:{main:{size:{position:3,normal:3,texCoord:2},count:c.default.cylinderSize(r),getGenerators:function(){return{position:regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.delegateYield(c.default.cylinderPosition(l.default.Zero,l.default.YUnit,l.default.XUnit,l.default.ZUnit.negateThis(),r),"t0",1);case 1:case"end":return e.stop()}},e,this)}),normal:regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.delegateYield(c.default.cylinderNormal(l.default.Zero,l.default.YUnit,l.default.XUnit,l.default.ZUnit.negateThis(),r),"t0",1);case 1:case"end":return e.stop()}},e,this)}),texCoord:regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.delegateYield(c.default.cylinderTexCoord(r),"t0",1);case 1:case"end":return e.stop()}},e,this)})}}}},aabb:v})})}},{key:"_registerCone",value:function(){h.default.addType("cone",{divide:{converter:"Number",default:50}},function(e,t){var r=t.divide;return b.default.build(e,{indices:{default:{generator:regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.delegateYield(c.default.coneIndex(0,r),"t0",1);case 1:case"end":return e.stop()}},e,this)}),topology:WebGLRenderingContext.TRIANGLES},wireframe:{generator:regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.delegateYield(c.default.linesFromTriangles(c.default.coneIndex(0,r)),"t0",1);case 1:case"end":return e.stop()}},e,this)}),topology:WebGLRenderingContext.LINES}},vertices:{main:{size:{position:3,normal:3,texCoord:2},count:c.default.coneSize(r),getGenerators:function(){return{position:regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.delegateYield(c.default.conePosition(l.default.Zero,l.default.YUnit,l.default.XUnit,l.default.ZUnit.negateThis(),r),"t0",1);case 1:case"end":return e.stop()}},e,this)}),normal:regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.delegateYield(c.default.coneNormal(l.default.Zero,l.default.YUnit,l.default.XUnit,l.default.ZUnit.negateThis(),r),"t0",1);case 1:case"end":return e.stop()}},e,this)}),
texCoord:regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.delegateYield(c.default.coneTexCoord(r),"t0",1);case 1:case"end":return e.stop()}},e,this)})}}}},aabb:v})})}},{key:"_registerPlane",value:function(){h.default.addType("plane",{divide:{converter:"Number",default:10}},function(e,t){var r=t.divide;return b.default.build(e,{indices:{default:{generator:regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.delegateYield(c.default.planeIndex(0,r),"t0",1);case 1:case"end":return e.stop()}},e,this)}),topology:WebGLRenderingContext.TRIANGLES},wireframe:{generator:regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.delegateYield(c.default.linesFromTriangles(c.default.planeIndex(0,r)),"t0",1);case 1:case"end":return e.stop()}},e,this)}),topology:WebGLRenderingContext.LINES}},vertices:{main:{size:{position:3,normal:3,texCoord:2},count:c.default.planeSize(r),getGenerators:function(){return{position:regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.delegateYield(c.default.planePosition(l.default.Zero,l.default.YUnit,l.default.XUnit,r),"t0",1);case 1:case"end":return e.stop()}},e,this)}),normal:regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.delegateYield(c.default.planeNormal(l.default.ZUnit,r),"t0",1);case 1:case"end":return e.stop()}},e,this)}),texCoord:regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.delegateYield(c.default.planeTexCoord(r),"t0",1);case 1:case"end":return e.stop()}},e,this)})}}}}})})}}]),e}();t.default=m},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=r(3),u=n(a),s=r(95),l=n(s),f=r(88),c=n(f),d=r(19),h=n(d),p=function(){function e(){o(this,e)}return i(e,null,[{key:"build",value:function(e,t){if(t.verticies|t.indicies)throw new Error("Misspelled API was fixed already. use vertices and indices");var r={},n={},o=t.aabb,i=!o;i&&(o=new l.default);for(var a in t.vertices){var s=4,f=t.vertices[a],d=0;for(var p in f.size){if(n[p])throw new Error("Attribute variable name was dupelicated");var b=f.size[p];n[p]={size:b,offset:d*s,bufferName:a,type:f.type?f.type:WebGLRenderingContext.FLOAT,stride:0},d+=b}for(var v in f.size)n[v].stride=d*s;var m=new Array(d*f.count),g=f.getGenerators(),y=[],_=0,w=[],x=g.beforeEach?g.beforeEach():void 0;for(var R in f.size)if("beforeEach"!==R){var E=g[R];y.push(E()),w.push(f.size[R]),"position"===R&&(_=y.length-1)}for(var C=0,k=0;k<f.count;k++){if(x&&x.next().done)throw new Error("before each was ended before reaching count.");for(var P=0;P<y.length;P++){for(var O=y[P],M=0;M<w[P];M++){var T=O.next();if(T.done)throw new Error("Generator function finished before reaching specified count");m[C]=T.value,C++}i&&P===_&&o.expand(new u.default(m[C-3],m[C-2],m[C-1]))}}r[a]=new c.default(e,WebGLRenderingContext.ARRAY_BUFFER,f.usage?f.usage:WebGLRenderingContext.STATIC_DRAW),r[a].update(new Float32Array(m))}return new h.default(r,n,this._generateIndices(e,t.indices),o)}},{key:"_generateIndices",value:function(e,t){var r={};for(var n in t){var o=[],i=t[n],a=!0,u=!1,s=void 0;try{for(var l,f=i.generator()[Symbol.iterator]();!(a=(l=f.next()).done);a=!0){var d=l.value;o.push(d)}}catch(e){u=!0,s=e}finally{try{!a&&f.return&&f.return()}finally{if(u)throw s}}var h=this._getIndexType(o.length),p=new c.default(e,WebGLRenderingContext.ELEMENT_ARRAY_BUFFER,WebGLRenderingContext.STATIC_DRAW);p.update(new h.ctor(o)),r[n]={count:o.length,index:p,type:h.format,byteSize:h.byteSize,byteOffset:0,topology:i.topology?i.topology:WebGLRenderingContext.TRIANGLES}}return r}},{key:"_getIndexType",value:function(e){var t=WebGLRenderingContext.UNSIGNED_INT,r=Uint32Array,n=4;if(e<256)t=WebGLRenderingContext.UNSIGNED_BYTE,r=Uint8Array,n=1;else if(e<65535)t=WebGLRenderingContext.UNSIGNED_SHORT,r=Uint16Array,n=2;else if(e>=4294967296)throw new Error("Too many index of geometry!");return{format:t,ctor:r,byteSize:n}}}]),e}();t.default=p},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=r(3),u=n(a),s=function(){function e(){o(this,e)}return i(e,null,[{key:"linesFromTriangles",value:regeneratorRuntime.mark(function e(t){var r,n,o,i,a,u,s,l,f,c,d;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r=new Array(3),n=0,o=!0,i=!1,a=void 0,e.prev=5,u=t[Symbol.iterator]();case 7:if(o=(s=u.next()).done){e.next=17;break}if(l=s.value,r[n%3]=l,n%3!==2){e.next=13;break}return f=r[0],c=r[1],d=r[2],e.delegateYield([f,c,c,d,d,f],"t0",13);case 13:n++;case 14:o=!0,e.next=7;break;case 17:e.next=23;break;case 19:e.prev=19,e.t1=e.catch(5),i=!0,a=e.t1;case 23:e.prev=23,e.prev=24,!o&&u.return&&u.return();case 26:if(e.prev=26,!i){e.next=29;break}throw a;case 29:return e.finish(26);case 30:return e.finish(23);case 31:case"end":return e.stop()}},e,this,[[5,19,23,31],[24,,26,30]])})},{key:"ellipsePosition",value:regeneratorRuntime.mark(function e(t,r,n,o){var i,a,u,s,l;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.X;case 2:return e.next=4,t.Y;case 4:return e.next=6,t.Z;case 6:i=2*Math.PI/o,a=0;case 8:if(!(a<o)){e.next=21;break}return u=i*a,s=Math.sin(2*Math.PI-u),l=Math.cos(2*Math.PI-u),e.next=14,t.X+l*r.X+s*n.X;case 14:return e.next=16,t.Y+l*r.Y+s*n.Y;case 16:return e.next=18,t.Z+l*r.Z+s*n.Z;case 18:a++,e.next=8;break;case 21:case"end":return e.stop()}},e,this)})},{key:"trianglePosition",value:regeneratorRuntime.mark(function e(t,r,n){var o,i,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.addWith(r),i=t.subtractWith(r).addWith(n),a=t.subtractWith(r).subtractWith(n),e.delegateYield(o.rawElements,"t0",4);case 4:return e.delegateYield(i.rawElements,"t1",5);case 5:return e.delegateYield(a.rawElements,"t2",6);case 6:case"end":return e.stop()}},e,this)})},{key:"cubePosition",value:regeneratorRuntime.mark(function t(r,n,o,i){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.delegateYield(e.quadPosition(r.subtractWith(i),n,o),"t0",1);case 1:return t.delegateYield(e.quadPosition(r.addWith(i),n,o.negateThis()),"t1",2);case 2:return t.delegateYield(e.quadPosition(r.addWith(n),i,o),"t2",3);case 3:return t.delegateYield(e.quadPosition(r.addWith(o),i,n.negateThis()),"t3",4);case 4:return t.delegateYield(e.quadPosition(r.subtractWith(n),i,o.negateThis()),"t4",5);case 5:return t.delegateYield(e.quadPosition(r.subtractWith(o),i,n),"t5",6);case 6:case"end":return t.stop()}},t,this)})},{key:"quadPosition",value:regeneratorRuntime.mark(function e(t,r,n){var o,i,a,u;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.subtractWith(n).addWith(r),i=t.addWith(n).addWith(r),a=t.addWith(n).subtractWith(r),u=t.subtractWith(n).subtractWith(r),e.delegateYield(o.rawElements,"t0",5);case 5:return e.delegateYield(i.rawElements,"t1",6);case 6:return e.delegateYield(a.rawElements,"t2",7);case 7:return e.delegateYield(u.rawElements,"t3",8);case 8:case"end":return e.stop()}},e,this)})},{key:"planePosition",value:regeneratorRuntime.mark(function e(t,r,n,o){var i,a,u,s,l,f;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:i=t.addWith(n).multiplyWith(2),a=t.subtractWith(r).multiplyWith(2),u=-o/2;case 3:if(!(u<o/2+1)){e.next=13;break}s=-o/2;case 5:if(!(s<o/2+1)){e.next=10;break}return e.delegateYield(i.multiplyWith(s/o).addWith(a.multiplyWith(u/o)).rawElements,"t0",7);case 7:s++,e.next=5;break;case 10:u++,e.next=3;break;case 13:l=-o/2;case 14:if(!(l<o/2+1)){e.next=24;break}f=-o/2;case 16:if(!(f<o/2+1)){e.next=21;break}return e.delegateYield(i.multiplyWith(f/o).addWith(a.multiplyWith(l/o)).rawElements,"t1",18);case 18:f++,e.next=16;break;case 21:l++,e.next=14;break;case 24:case"end":return e.stop()}},e,this)})},{key:"cylinderPosition",value:regeneratorRuntime.mark(function t(r,n,o,i,a){var s,l,f,c,d,h,p,b,v,m;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.delegateYield(e.ellipsePosition(r.addWith(n),i,o,a),"t0",1);case 1:return t.delegateYield(e.ellipsePosition(r.subtractWith(n),i,u.default.negate(o),a),"t1",2);case 2:s=2*Math.PI/a,l=Math.cos(s/2),f=Math.sin(s/2),c=a%2==0?s/2:0,d=0;case 7:if(!(d<a)){t.next=17;break}return h=s/2+s*d,p=Math.sin((Math.PI-s)/2-h-c),b=Math.cos((Math.PI-s)/2-h-c),v=new u.default(l*b,r.Y,l*p),m=new u.default(Math.cos(-s/2-h-c),r.Y,Math.sin(-s/2-h-c)),t.delegateYield(e.quadPosition(v,n,u.default.multiply(f,m)),"t2",14);case 14:d++,t.next=7;break;case 17:case"end":return t.stop()}},t,this)})},{key:"conePosition",value:regeneratorRuntime.mark(function t(r,n,o,i,a){var s,l,f,c,d,h,p,b,v,m;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.delegateYield(e.ellipsePosition(r.subtractWith(n),i,u.default.negate(o),a),"t0",1);case 1:s=2*Math.PI/a,l=Math.cos(s/2)/2,f=Math.sin(s/2),c=a%2==1?s/2:0,d=0;case 6:if(!(d<a)){t.next=16;break}return h=s*d,p=Math.sin((Math.PI-s)/2-h-c),b=Math.cos((Math.PI-s)/2-h-c),v=new u.default(l*b,r.Y,l*p),m=new u.default(Math.cos(-s/2-h-c),r.Y,Math.sin(-s/2-h-c)),t.delegateYield(e.trianglePosition(v,n.subtractWith(v),u.default.multiply(f,m)),"t1",13);case 13:d++,t.next=6;break;case 16:case"end":return t.stop()}},t,this)})},{key:"spherePosition",value:regeneratorRuntime.mark(function e(t,r,n,o,i,a){var u,s,l,f,c,d,h,p;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.delegateYield(t.addWith(r).rawElements,"t0",1);case 1:return e.delegateYield(t.subtractWith(r).rawElements,"t1",2);case 2:u=2*Math.PI/a,s=Math.PI/(i+1),l=1;case 5:if(!(l<=i)){e.next=19;break}f=s*l,c=Math.sin(f),d=r.multiplyWith(Math.cos(f)),h=0;case 10:if(!(h<=a)){e.next=16;break}return p=u*h,e.delegateYield(n.multiplyWith(Math.cos(p)).addWith(o.multiplyWith(Math.sin(p))).multiplyWith(c).addWith(d).rawElements,"t2",13);case 13:h++,e.next=10;break;case 16:l++,e.next=5;break;case 19:case"end":return e.stop()}},e,this)})},{key:"quadNormal",value:regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.delegateYield(t.rawElements,"t0",1);case 1:return e.delegateYield(t.rawElements,"t1",2);case 2:return e.delegateYield(t.rawElements,"t2",3);case 3:return e.delegateYield(t.rawElements,"t3",4);case 4:case"end":return e.stop()}},e,this)})},{key:"ellipseNormal",value:regeneratorRuntime.mark(function e(t,r){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=0;case 1:if(!(n<r+1)){e.next=6;break}return e.delegateYield(t.rawElements,"t0",3);case 3:n++,e.next=1;break;case 6:case"end":return e.stop()}},e,this)})},{key:"triangleNormal",value:regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.delegateYield(t.rawElements,"t0",1);case 1:return e.delegateYield(t.rawElements,"t1",2);case 2:return e.delegateYield(t.rawElements,"t2",3);case 3:case"end":return e.stop()}},e,this)})},{key:"cubeNormal",value:regeneratorRuntime.mark(function t(r,n,o,i){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.delegateYield(e.quadNormal(i.negateThis()),"t0",1);case 1:return t.delegateYield(e.quadNormal(i),"t1",2);case 2:return t.delegateYield(e.quadNormal(n),"t2",3);case 3:return t.delegateYield(e.quadNormal(o),"t3",4);case 4:return t.delegateYield(e.quadNormal(n.negateThis()),"t4",5);case 5:return t.delegateYield(e.quadNormal(o.negateThis()),"t5",6);case 6:case"end":return t.stop()}},t,this)})},{key:"cylinderNormal",value:regeneratorRuntime.mark(function t(r,n,o,i,a){var s,l,f,c,d,h,p;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.delegateYield(e.ellipseNormal(n,a),"t0",1);case 1:return t.delegateYield(e.ellipseNormal(n.negateThis(),a),"t1",2);case 2:s=2*Math.PI/a,l=new u.default(Math.cos(-s/2),r.Y,Math.sin(-s/2)),f=0;case 5:if(!(f<a)){t.next=18;break}return c=s*(f+1),d=Math.sin(Math.PI/2-c),h=Math.cos(Math.PI/2-c),p=new u.default(Math.cos(-s/2-c),r.Y,Math.sin(-s/2-c)),t.delegateYield(u.default.cross(l,n).rawElements,"t2",11);case 11:return t.delegateYield(u.default.cross(p,n).rawElements,"t3",12);case 12:return t.delegateYield(u.default.cross(p,n).rawElements,"t4",13);case 13:return t.delegateYield(u.default.cross(l,n).rawElements,"t5",14);case 14:l=p;case 15:f++,t.next=5;break;case 18:case"end":return t.stop()}},t,this)})},{key:"coneNormal",value:regeneratorRuntime.mark(function t(r,n,o,i,a){var s,l,f,c,d,h,p,b,v;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.delegateYield(e.ellipseNormal(n.negateThis(),a),"t0",1);case 1:s=Math.PI/a,l=Math.cos(s/2)/2,f=u.default.cross(new u.default(Math.cos(s/2),r.Y,Math.sin(s/2)),n.subtractWith(new u.default(l*Math.cos((Math.PI+s)/2),r.Y,l*Math.sin((Math.PI+s)/2)))),c=0;case 5:if(!(c<2*a)){t.next=18;break}return d=s*c,h=Math.sin((Math.PI-s)/2-d),p=Math.cos((Math.PI-s)/2-d),b=new u.default(l*p,r.Y,l*h),v=new u.default(Math.cos(-s/2-d),r.Y,Math.sin(-s/2-d)),t.delegateYield(u.default.cross(v,n.subtractWith(b)).rawElements,"t1",12);case 12:if(c%2!=1){t.next=15;break}return t.delegateYield(f.rawElements,"t2",14);case 14:f=u.default.cross(v,n.subtractWith(b));case 15:c++,t.next=5;break;case 18:return t.delegateYield(u.default.cross(new u.default(Math.cos(s/2),r.Y,Math.sin(s/2)),n.subtractWith(new u.default(l*Math.cos((Math.PI+s)/2),r.Y,l*Math.sin((Math.PI+s)/2)))).rawElements,"t3",19);case 19:case"end":return t.stop()}},t,this)})},{key:"planeNormal",value:regeneratorRuntime.mark(function t(r,n){var o,i,a;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:o=e.planeSize(n)/2,i=0;case 2:if(!(i<o)){t.next=7;break}return t.delegateYield(r.rawElements,"t0",4);case 4:i++,t.next=2;break;case 7:a=0;case 8:if(!(a<o)){t.next=13;break}return t.delegateYield(r.negateThis().rawElements,"t1",10);case 10:a++,t.next=8;break;case 13:case"end":return t.stop()}},t,this)})},{key:"sphereNormal",value:regeneratorRuntime.mark(function t(r,n,o,i,a){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.delegateYield(e.spherePosition(u.default.Zero,r,n,o,i,a),"t0",1);case 1:case"end":return t.stop()}},t,this)})},{key:"sphereTexCoord",value:regeneratorRuntime.mark(function e(t,r){var n,o,i,a,u,s,l;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.delegateYield([0,0,0,1],"t0",1);case 1:n=2*Math.PI/r,o=Math.PI/(t+1),i=1;case 4:if(!(i<=t)){e.next=17;break}a=o*i,u=Math.sin(a),s=0;case 8:if(!(s<=r)){e.next=14;break}return l=n*s,e.delegateYield([l/Math.PI/2,a/Math.PI],"t1",11);case 11:s++,e.next=8;break;case 14:i++,e.next=4;break;case 17:case"end":return e.stop()}},e,this)})},{key:"quadTexCoord",value:regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.delegateYield([0,0],"t0",1);case 1:return e.delegateYield([1,0],"t1",2);case 2:return e.delegateYield([1,1],"t2",3);case 3:return e.delegateYield([0,1],"t3",4);case 4:case"end":return e.stop()}},e,this)})},{key:"cubeTexCoord",value:regeneratorRuntime.mark(function t(){var r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:r=0;case 1:if(!(r<6)){t.next=6;break}return t.delegateYield(e.quadTexCoord(),"t0",3);case 3:r++,t.next=1;break;case 6:case"end":return t.stop()}},t,this)})},{key:"triangleTexCoord",value:regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.delegateYield([0,0],"t0",1);case 1:return e.delegateYield([1,0],"t1",2);case 2:return e.delegateYield([0,1],"t2",3);case 3:case"end":return e.stop()}},e,this)})},{key:"ellipseTexCoord",value:regeneratorRuntime.mark(function e(t){var r,n,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.delegateYield([.5,.5],"t0",1);case 1:r=2*Math.PI/t,n=0;case 3:if(!(n<t)){e.next=9;break}return o=r*n,e.delegateYield([.5+Math.cos(o+Math.PI)/2,.5+Math.sin(o+Math.PI)/2],"t1",6);case 6:n++,e.next=3;break;case 9:case"end":return e.stop()}},e,this)})},{key:"planeTexCoord",value:regeneratorRuntime.mark(function e(t){var r,n,o,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r=0;case 1:if(!(r<t+1)){e.next=11;break}n=0;case 3:if(!(n<t+1)){e.next=8;break}return e.delegateYield([n/t,r/t],"t0",5);case 5:n++,e.next=3;break;case 8:r++,e.next=1;break;case 11:o=0;case 12:if(!(o<t+1)){e.next=22;break}i=0;case 14:if(!(i<t+1)){e.next=19;break}return e.delegateYield([i/t,o/t],"t1",16);case 16:i++,e.next=14;break;case 19:o++,e.next=12;break;case 22:case"end":return e.stop()}},e,this)})},{key:"cylinderTexCoord",value:regeneratorRuntime.mark(function t(r){var n,o;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.delegateYield(e.ellipseTexCoord(r),"t0",1);case 1:return t.delegateYield(e.ellipseTexCoord(r),"t1",2);case 2:n=1/r,o=0;case 4:if(!(o<r)){t.next=12;break}return t.delegateYield([n*o,0],"t2",6);case 6:return t.delegateYield([n*(o+1),0],"t3",7);case 7:return t.delegateYield([n*(o+1),1],"t4",8);case 8:return t.delegateYield([n*o,1],"t5",9);case 9:o++,t.next=4;break;case 12:case"end":return t.stop()}},t,this)})},{key:"coneTexCoord",value:regeneratorRuntime.mark(function t(r){var n,o,i;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.delegateYield(e.ellipseTexCoord(r),"t0",1);case 1:n=Math.PI/2/r,o=0;case 3:if(!(o<r)){t.next=11;break}return i=-n*o,t.delegateYield([0,0],"t1",6);case 6:return t.delegateYield([Math.cos(i-n),Math.sin(i-n)],"t2",7);case 7:return t.delegateYield([Math.cos(i),Math.sin(i)],"t3",8);case 8:o++,t.next=3;break;case 11:case"end":return t.stop()}},t,this)})},{key:"triangleIndex",value:regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t,e.delegateYield([r,r+2,r+1],"t0",2);case 2:case"end":return e.stop()}},e,this)})},{key:"quadIndex",value:regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t,e.delegateYield([r,r+2,r+1,r,r+3,r+2],"t0",2);case 2:case"end":return e.stop()}},e,this)})},{key:"cubeIndex",value:regeneratorRuntime.mark(function t(r){var n,o;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:n=e.quadSize(),o=0;case 2:if(!(o<6)){t.next=7;break}return t.delegateYield(e.quadIndex(r+n*o),"t0",4);case 4:o++,t.next=2;break;case 7:case"end":return t.stop()}},t,this)})},{key:"sphereIndex",value:regeneratorRuntime.mark(function e(t,r,n){var o,i,a,u,s,l,f;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:o=function(e,r){return t+(n+1)*r+2+e},i=t,a=t+1,u=0;case 4:if(!(u<n)){e.next=14;break}return e.next=7,i;case 7:return e.next=9,o(u,0);case 9:return e.next=11,o(u+1,0);case 11:u++,e.next=4;break;case 14:s=0;case 15:if(!(s<r-1)){e.next=36;break}l=0;case 17:if(!(l<n)){e.next=33;break}return e.next=20,o(l,s);case 20:return e.next=22,o(l,s+1);case 22:return e.next=24,o(l+1,s);case 24:return e.next=26,o(l,s+1);case 26:return e.next=28,o(l+1,s+1);case 28:return e.next=30,o(l+1,s);case 30:l++,e.next=17;break;case 33:s++,e.next=15;break;case 36:f=0;case 37:if(!(f<n)){e.next=47;break}return e.next=40,a;case 40:return e.next=42,o(f+1,r-1);case 42:return e.next=44,o(f,r-1);case 44:f++,e.next=37;break;case 47:case"end":return e.stop()}},e,this)})},{key:"cylinderIndex",value:regeneratorRuntime.mark(function t(r,n){var o,i,a;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return o=e.ellipseSize(n),i=e.quadSize(),t.delegateYield(e.ellipseIndex(r,n),"t0",3);case 3:return t.delegateYield(e.ellipseIndex(r+o,n),"t1",4);case 4:a=0;case 5:if(!(a<n)){t.next=10;break}return t.delegateYield(e.quadIndex(r+2*o+i*a),"t2",7);case 7:a++,t.next=5;break;case 10:case"end":return t.stop()}},t,this)})},{key:"coneIndex",value:regeneratorRuntime.mark(function t(r,n){var o,i,a;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return o=e.ellipseSize(n),i=e.triangleSize(),t.delegateYield(e.ellipseIndex(r,n),"t0",3);case 3:a=0;case 4:if(!(a<n)){t.next=9;break}return t.delegateYield(e.triangleIndex(r+o+a*i),"t1",6);case 6:a++,t.next=4;break;case 9:case"end":return t.stop()}},t,this)})},{key:"planeIndex",value:regeneratorRuntime.mark(function t(r,n){var o,i,a,u,s,l;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:o=r,i=e.planeSize(n)/2,a=0;case 3:if(!(a<n)){t.next=15;break}u=0;case 5:if(!(u<n)){t.next=12;break}return o=r+u+a*(n+1),t.delegateYield([o,o+n+2,o+1],"t0",8);case 8:return t.delegateYield([o,o+n+1,o+n+2],"t1",9);case 9:u++,t.next=5;break;case 12:a++,t.next=3;break;case 15:s=0;case 16:if(!(s<n)){t.next=28;break}l=0;case 18:if(!(l<n)){t.next=25;break}return o=r+l+s*(n+1)+i,t.delegateYield([o,o+1,o+n+2],"t2",21);case 21:return t.delegateYield([o,o+n+2,o+n+1],"t3",22);case 22:l++,t.next=18;break;case 25:s++,t.next=16;break;case 28:case"end":return t.stop()}},t,this)})},{key:"ellipseIndex",value:regeneratorRuntime.mark(function e(t,r){var n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=0;case 1:if(!(n<r-1)){e.next=6;break}return e.delegateYield([t,t+1+n,t+2+n],"t0",3);case 3:n++,e.next=1;break;case 6:return e.delegateYield([t,t+r,t+1],"t1",7);case 7:case"end":return e.stop()}},e,this)})},{key:"quadSize",value:function(){return 4}},{key:"triangleSize",value:function(){return 3}},{key:"cubeSize",value:function(){return 6*e.quadSize()}},{key:"sphereSize",value:function(e,t){return 2+e*(t+1)}},{key:"cylinderSize",value:function(t){return 2*e.ellipseSize(t)+t*e.quadSize()}},{key:"coneSize",value:function(t){return e.ellipseSize(t)+t*e.triangleSize()}},{key:"planeSize",value:function(e){return(e+1)*(e+1)*2}},{key:"ellipseSize",value:function(e){return e+1}}]),e}();t.default=s},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={GRIMOIRE:null,WEBGL_VERSION:"1"}},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=r(9),u=n(a),s=r(113),l=n(s),f=r(111),c=n(f),d=r(112),h=n(d),p=function(){function e(){o(this,e)}return i(e,null,[{key:"register",value:function(){u.default.addSORTMaterial("unlit",l.default),u.default.addSORTMaterial("unlit-texture",h.default),u.default.addSORTMaterial("unlit-color",c.default)}}]),e}();t.default=p},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=r(97),u=n(a),s=function(){function e(){o(this,e)}return i(e,null,[{key:"addResolver",value:function(t,r){e.resolvers[t]=r}},{key:"addDynamicResolver",value:function(t){e.dynamicResolvers.push(t)}},{key:"resolve",value:function(t,r){if(e.resolvers[t])return e.resolvers[t](r,t);for(var n=null,o=0;o<e.dynamicResolvers.length;o++)if(n=e.dynamicResolvers[o](r,t),null!=n)return n}}]),e}();t.default=s,s.resolvers={},s.dynamicResolvers=[],s.addResolver("_matPVM",function(e,t){return function(e,r){return e.uniformMatrix(t,r.transform.calcPVM(r.camera.camera))}}),s.addResolver("_matP",function(e,t){return function(e,r){return e.uniformMatrix(t,r.camera.camera.getProjectionMatrix())}}),s.addResolver("_matV",function(e,t){return function(e,r){return e.uniformMatrix(t,r.camera.camera.getViewMatrix())}}),s.addResolver("_matM",function(e,t){return function(e,r){return e.uniformMatrix(t,r.transform.globalTransform)}}),s.addResolver("_matVM",function(e,t){return function(e,r){return e.uniformMatrix(t,r.transform.calcVM(r.camera.camera))}}),s.addResolver("_matPV",function(e,t){return function(e,r){return e.uniformMatrix(t,r.camera.camera.getProjectionViewMatrix())}}),s.addResolver("_time",function(e,t){return function(e,r){return e.uniformFloat(t,Date.now()%1e6)}}),s.addResolver("_viewportSize",function(e,t){var r=new u.default(0,0);return function(e,n){r.X=n.viewport.Width,r.Y=n.viewport.Height,e.uniformVector2(t,r)}}),s.addResolver("_cameraPosition",function(e,t){return function(e,r){return e.uniformVector3(t,r.camera.transform.globalPosition)}}),s.addResolver("_cameraDirection",function(e,t){return function(e,r){return e.uniformVector3(t,r.camera.transform.forward)}})},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.ImportResolver=void 0;var u=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),s=function e(t,r,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,r,n)}if("value"in o)return o.value;var a=o.get;if(void 0!==a)return a.call(n)},l=r(14),f=n(l),c=function(e,t,r,n){return new(r||(r=Promise))(function(o,i){function a(e){try{s(n.next(e))}catch(e){i(e)}}function u(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){e.done?o(e.value):new r(function(t){t(e.value)}).then(a,u)}s((n=n.apply(e,t)).next())})},d=t.ImportResolver=function(e){function t(){o(this,t);var e=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,function(e){var r=/^https?:\/\/.*/gm;return r.test(e)?t._toAbsolute(e):e}));return e.staticImports={},e}return a(t,e),u(t,[{key:"resolve",value:function(e){var r=this;return s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"resolve",this).call(this,e,function(t){return r._resolve(e)})}},{key:"_resolve",value:function(e){return c(this,void 0,void 0,regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.staticImports[e]){t.next=4;break}return t.abrupt("return",this.staticImports[e]);case 4:return t.next=6,this._fromExternal(e);case 6:return t.abrupt("return",t.sent);case 7:case"end":return t.stop()}},t,this)}))}},{key:"_fromExternal",value:function(e){return new Promise(function(t,r){var n=new XMLHttpRequest;n.open("GET",e),n.onload=function(e){t(n.responseText)},n.onerror=function(e){r(e)},n.send()})}}],[{key:"_toAbsolute",value:function(e){var t=document.createElement("a");return t.href=e,t.protocol+"//"+t.host+t.pathname+t.search+t.hash}}]),t}(f.default);t.default=new d},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=r(71),u=n(a),s=function(){function e(){o(this,e),this.macroString="",this._macro={},this._observers=[];for(var t in u.default)this.setValue(t,u.default[t])}return i(e,[{key:"setValue",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._macro[e]!==t&&(this._macro[e]=t,this.macroString=this._getMacroString(),this._notifyMacroChanged())}},{key:"getValue",value:function(e){return this._macro[e]}},{key:"addObserver",value:function(e){this._observers.push(e)}},{key:"removeObserver",value:function(e){for(var t=0;t<this._observers.length;t++)this._observers[t]===e&&this._observers.splice(t,1)}},{key:"_getMacroString",value:function(){var e="";for(var t in this._macro)e+=this._genSingleMacroString(t,this._macro[t]);return e}},{key:"_notifyMacroChanged",value:function(){for(var e=0;e<this._observers.length;e++)this._observers[e]()}},{key:"_genSingleMacroString",value:function(e,t){if(void 0===t)throw new Error("Macro value of "+e+" can't be undefined");return null===t?"#define "+e+"\n":"#define "+e+" "+t+"\n"}}]),e}();t.default=s},function(e,t){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"UseAlpha";r(this,e),this.pass=t,this.drawOrder=n}return n(e,[{key:"draw",value:function(e){this.pass.forEach(function(t){return t.draw(e)})}}]),e}();t.default=o},function(e,t){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=function(){function e(){r(this,e),this.attributes=[]}return n(e,[{key:"draw",value:function(e){this.program&&(this.program.use(),this.__beforeDraw(e),e.geometry.drawByDefault(e.targetBuffer,this.attributes,this.program,e.drawCount,e.drawOffset))}},{key:"__beforeDraw",value:function(e){}}]),e}();t.default=o},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{
value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=r(84),u=n(a),s=function(){function e(){o(this,e)}return i(e,null,[{key:"passInfoFromSORT",value:function(e){var t=e.split("@Pass");return t.splice(0,1),Promise.all(t.map(function(e){return u.default.parse(e)}))}}]),e}();t.default=s},function(e,t){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=function(){function e(t){r(this,e),this.rawResource=t,this._isFunctionalProxy="function"==typeof t}return n(e,[{key:"get",value:function(e){return this._isFunctionalProxy?this.rawResource(e):this.rawResource}}]),e}();t.default=o},function(e,t){"use strict";function r(e){for(var t=/(\s*@[a-zA-Z]*\([^)]*\))/;;){var r=t.exec(e);if(!r)break;e=e.replace(r[0],"")}return e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return n(this,void 0,void 0,regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.info.shaderSource=r(e.info.shaderSource),t.abrupt("return",e);case 2:case"end":return t.stop()}},t,this)}))};var n=function(e,t,r,n){return new(r||(r=Promise))(function(o,i){function a(e){try{s(n.next(e))}catch(e){i(e)}}function u(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){e.done?o(e.value):new r(function(t){t(e.value)}).then(a,u)}s((n=n.apply(e,t)).next())})}},function(e,t){"use strict";function r(e){for(var t="",r=!1,n=!1,o=0;o<e.length;o++){var i=e.charAt(o);if("/"===i&&o+1<e.length){if("/"===e.charAt(o+1)&&!n){r=!0,o++;continue}if("*"===e.charAt(o+1)&&!r){n=!0,o++;continue}}"*"===i&&n&&o+1<e.length&&"/"===e.charAt(o+1)?(n=!1,o++):"\n"===i&&r?r=!1:r||n||(t+=i)}return t}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return n(this,void 0,void 0,regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.info.shaderSource=r(e.info.shaderSource),t.abrupt("return",e);case 2:case"end":return t.stop()}},t,this)}))};var n=function(e,t,r,n){return new(r||(r=Promise))(function(o,i){function a(e){try{s(n.next(e))}catch(e){i(e)}}function u(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){e.done?o(e.value):new r(function(t){t(e.value)}).then(a,u)}s((n=n.apply(e,t)).next())})}},function(e,t){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=function(){function e(){r(this,e)}return n(e,null,[{key:"isPrimitive",value:function(t){return e._primitives.indexOf(t)>=0}}]),e}();t.default=o,o._primitives=["float","bool","int","vec2","vec3","vec4","ivec2","ivec3","ivec4","bvec2","bvec3","bvec4","mat2","mat3","mat4","sampler1D","sampler2D","sampler3D","samplerCube","sampler1DShadow","sampler2DShadow"]},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e){return u(this,void 0,void 0,regeneratorRuntime.mark(function t(){var r,n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r=/\s*@import\s+"([^"]+)"/.exec(e)){t.next=4;break}return t.abrupt("break",16);case 4:return n=void 0,t.next=7,a.default.resolve(r[1]);case 7:return t.t0=t.sent,t.next=10,o(t.t0);case 10:if(n=t.sent){t.next=13;break}throw new Error("Required shader chunk '"+r[1]+"' was not found!!");case 13:e=e.replace(r[0],"\n"+n+"\n"),t.next=0;break;case 16:return t.abrupt("return",e);case 17:case"end":return t.stop()}},t,this)}))}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return u(this,void 0,void 0,regeneratorRuntime.mark(function t(){var r;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,o(e.info.shaderSource);case 2:return r=t.sent,e.info.shaderSource=r,t.abrupt("return",e);case 5:case"end":return t.stop()}},t,this)}))};var i=r(74),a=n(i),u=function(e,t,r,n){return new(r||(r=Promise))(function(o,i){function a(e){try{s(n.next(e))}catch(e){i(e)}}function u(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){e.done?o(e.value):new r(function(t){t(e.value)}).then(a,u)}s((n=n.apply(e,t)).next())})}},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=r(85),u=n(a),s=r(81),l=n(s),f=r(83),c=n(f),d=r(87),h=n(d),p=r(86),b=n(p),v=r(102),m=n(v),g=r(80),y=n(g),_=function(e,t,r,n){return new(r||(r=Promise))(function(o,i){function a(e){try{s(n.next(e))}catch(e){i(e)}}function u(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){e.done?o(e.value):new r(function(t){t(e.value)}).then(a,u)}s((n=n.apply(e,t)).next())})},w=function(){function e(){o(this,e)}return i(e,null,[{key:"parse",value:function(t){return _(this,void 0,void 0,regeneratorRuntime.mark(function r(){var n,o;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:n={origin:t,info:{shaderSource:t,uniforms:{},attributes:{},macros:[],configurator:[],systemRegisterers:[],gomlAttributes:{}}},o=0;case 2:if(!(o<e.transformers.length)){r.next=9;break}return r.next=5,e.transformers[o](n);case 5:n=r.sent;case 6:o++,r.next=2;break;case 9:return r.abrupt("return",n.info);case 10:case"end":return r.stop()}},r,this)}))}}]),e}();t.default=w,w.transformers=[l.default,c.default,(0,h.default)("uniform"),(0,h.default)("attribute"),m.default,y.default,b.default,u.default]},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t,r){return{converter:e,default:t,register:r}}function i(e,t){return e.variableAnnotation.default?e.variableAnnotation.default:t}function a(e){return d(this,void 0,void 0,regeneratorRuntime.mark(function t(){var r,n,a,u,s;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:r=[],n=e.info.gomlAttributes,a=function(t){if("_"===t.charAt(0))return"continue";var r=t,a=e.info.uniforms,u=a[t],s=u.variableAnnotation;if(l.default.isPrimitive(u.variableType))if(u.isArray)switch(u.variableType){case"float":var f=new Array;f=f.map(function(e){return 0}),n[r]=o("NumberArray",i(u,f),function(e,t){e.uniformFloatArray(r,t.attributeValues[r])});break;case"mat4":var c=new Array;f=c.map(function(e){return 0}),n[r]=o("Object",i(u,f),function(e,t){e.uniformMatrixArray(r,t.attributeValues[r])});break;default:throw new Error("Unsupported array type "+u.variableType)}else!function(){switch(u.variableType){case"bool":n[r]=o("Boolean",i(u,!1),function(e,t){e.uniformBool(r,t.attributeValues[r])});break;case"float":n[r]=o("Number",i(u,0),function(e,t){e.uniformFloat(r,t.attributeValues[r])});break;case"vec2":n[r]=o("Vector2",i(u,"0,0"),function(e,t){e.uniformVector2(r,t.attributeValues[r])});break;case"vec3":"color"===s.type?n[r]=o("Color3",i(u,"#000"),function(e,t){e.uniformColor3(r,t.attributeValues[r])}):n[r]=o("Vector3",i(u,"0,0,0"),function(e,t){e.uniformVector3(r,t.attributeValues[r])});break;case"vec4":"color"===s.type?n[r]=o("Color4",i(u,"#0000"),function(e,t){e.uniformColor4(r,t.attributeValues[r])}):n[r]=o("Vector4",i(u,"0,0,0,0"),function(e,t){e.uniformVector4(r,t.attributeValues[r])});break;case"sampler2D":var e=void 0;s.usedFlag&&void 0!==s.usedFlag&&(e=s.usedFlag),n[r]=o("Texture",i(u,null),function(t,n){var o=void 0;n.attributeValues[r]&&(o=n.attributeValues[r].get(n.buffers))?(t.uniformTexture2D(r,o),e&&t.uniformBool(e,!0)):(t.uniformTexture2D(r,n.defaultTexture),e&&t.uniformBool(e,!1))});break;default:throw new Error("Unsupported type was found")}}()},t.t0=regeneratorRuntime.keys(e.info.uniforms);case 4:if((t.t1=t.t0()).done){t.next=11;break}if(u=t.t1.value,s=a(u),"continue"!==s){t.next=9;break}return t.abrupt("continue",4);case 9:t.next=4;break;case 11:return t.next=13,Promise.all(r);case 13:case"end":return t.stop()}},t,this)}))}function u(e){var t=e.info.systemRegisterers;for(var r in e.info.uniforms)if("_"===r.charAt(0)){var n=e.info.uniforms[r],o=c.default.resolve(r,n);if(o){t.push(o);continue}}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return d(this,void 0,void 0,regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,a(e);case 2:return u(e),t.abrupt("return",e);case 4:case"end":return t.stop()}},t,this)}))};var s=r(82),l=n(s),f=r(73),c=n(f),d=function(e,t,r,n){return new(r||(r=Promise))(function(o,i){function a(e){try{s(n.next(e))}catch(e){i(e)}}function u(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){e.done?o(e.value):new r(function(t){t(e.value)}).then(a,u)}s((n=n.apply(e,t)).next())})}},function(e,t){"use strict";function r(e){for(var t=void 0;t=/@\{.+\}/g.exec(e);)e=e.substr(0,t.index)+e.substring(t.index+t[0].length,e.length);return e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return n(this,void 0,void 0,regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.info.shaderSource=r(e.info.shaderSource),t.abrupt("return",e);case 2:case"end":return t.stop()}},t,this)}))};var n=function(e,t,r,n){return new(r||(r=Promise))(function(o,i){function a(e){try{s(n.next(e))}catch(e){i(e)}}function u(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){e.done?o(e.value):new r(function(t){t(e.value)}).then(a,u)}s((n=n.apply(e,t)).next())})}},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e){return s.default.parse(e)}function i(e){return new RegExp("(?:@(\\{.+\\}))?\\s*"+e+"\\s+(?:(lowp|mediump|highp)\\s+)?([a-z0-9A-Z]+)\\s+([a-zA-Z0-9_]+)(?:\\s*\\[\\s*([a-zA-Z0-9_]+)\\s*\\]\\s*)?\\s*;","g")}function a(e,t){for(var r={},n=i(t),a=void 0,u=function(){var e=a[4],t=a[3],n=a[2],i=a[1],u=void 0!==a[5],s=void 0;u&&!function(){var e=parseInt(a[5],10);s=function(){return e},isNaN(e)&&(s=function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e){return e[s]}))}(),r[e]={variableName:e,variableType:t,variablePrecision:n,variableAnnotation:i?o(i):{},isArray:u,arrayLength:s}};a=n.exec(e);)u();return r}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return function(t){return l(this,void 0,void 0,regeneratorRuntime.mark(function r(){var n;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:n=a(t.info.shaderSource,e),r.t0=e,r.next="uniform"===r.t0?4:"attribute"===r.t0?6:8;break;case 4:return t.info.uniforms=n,r.abrupt("break",9);case 6:return t.info.attributes=n,r.abrupt("break",9);case 8:throw new Error("Unknown variable type!!");case 9:return r.abrupt("return",t);case 10:case"end":return r.stop()}},r,this)}))}};var u=r(109),s=n(u),l=function(e,t,r,n){return new(r||(r=Promise))(function(o,i){function a(e){try{s(n.next(e))}catch(e){i(e)}}function u(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){e.done?o(e.value):new r(function(t){t(e.value)}).then(a,u)}s((n=n.apply(e,t)).next())})}},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),s=function e(t,r,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,r,n)}if("value"in o)return o.value;var a=o.get;if(void 0!==a)return a.call(n)},l=r(2),f=n(l),c=function(e){function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:WebGLRenderingContext.ARRAY_BUFFER,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:WebGLRenderingContext.ELEMENT_ARRAY_BUFFER;o(this,t);var a=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.target=r,a.usage=n,a.buffer=e.createBuffer(),a}return a(t,e),u(t,[{key:"update",value:function(e,t){this.bind(),t?(this.valid||this.gl.bufferData(this.target,e+t.byteLength,this.usage),this.gl.bufferSubData(this.target,e,t)):"number"==typeof e?this.gl.bufferData(this.target,e,this.usage):this.gl.bufferData(this.target,e,this.usage),this.valid=!0}},{key:"bind",value:function(){this.gl.bindBuffer(this.target,this.buffer)}},{key:"destroy",value:function(){s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",this).call(this),this.gl.deleteBuffer(this.buffer)}}]),t}(f.default);t.default=c},function(e,t){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=function(){function e(t){r(this,e),this.gl=t,this.extensions={},this._readyExtensions={},this._resolveRequested(),e._requestObserver.push(this._resolveExtensionSafely)}return n(e,[{key:"_resolveRequested",value:function(){var t=this;e._requestedExtensions.forEach(function(e){t._resolveExtensionSafely(e.extensionName)})}},{key:"_resolveExtensionSafely",value:function(t){var r=e._requestedExtensions[e._requestIndexOf(t)];if(!this._resolveExtension(r.extensionName)&&r.isNecessary)throw new Error("A WebGL extension '"+r.extensionName+"' was requested. But that is not supported on this device.")}},{key:"_resolveExtension",value:function(t){if(this._readyExtensions[t])return!0;var r=void 0;return r="undefined"==typeof e._customExtensionResolvers[t]?this.extensions[t]=this.gl.getExtension(t):this.extensions[t]=e._customExtensionResolvers[t](this.gl),this._readyExtensions[t]=void 0!==this.extensions[t],!!this._readyExtensions[t]}}],[{key:"request",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e._requestIndexOf(t);n>-1&&r?e._requestedExtensions[n]={extensionName:t,isNecessary:r}:n===-1&&e._requestedExtensions.push({extensionName:t,isNecessary:r}),e._requestObserver.forEach(function(e){return e(t)})}},{key:"_requestIndexOf",value:function(t){for(var r=0;r<e._requestedExtensions.length;r++)if(e._requestedExtensions[r].extensionName===t)return r;return-1}}]),e}();t.default=o,o._requestedExtensions=[],o._customExtensionResolvers={},o._requestObserver=[],o._customExtensionResolvers.WEBGL_color_buffer_float=function(e){var t=void 0;if(null===e.getExtension("WEBGL_color_buffer_float")){var r=e.createFramebuffer(),n=e.createTexture();e.bindFramebuffer(e.FRAMEBUFFER,r),e.bindTexture(e.TEXTURE_2D,n),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.FLOAT,null),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0),t=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE,e.deleteTexture(n),e.deleteFramebuffer(r)}else t=!0;return t}},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),s=function e(t,r,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,r,n)}if("value"in o)return o.value;var a=o.get;if(void 0!==a)return a.call(n)},l=r(92),f=n(l),c=r(2),d=n(c),h=function(e){function t(e){o(this,t);var r=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r._uniformLocations={},r._attributeLocations={},r.uniforms=new f.default(r),r.program=e.createProgram(),r}return a(t,e),u(t,[{key:"update",value:function(e){var t=this;if(this.valid){var r=this.gl.getAttachedShaders(this.program);r.forEach(function(e){return t.gl.detachShader(t.program,e)})}if(e.forEach(function(e){t.gl.attachShader(t.program,e.shader)}),this.gl.linkProgram(this.program),!this.gl.getProgramParameter(this.program,WebGLRenderingContext.LINK_STATUS)){var n=this.gl.getProgramInfoLog(this.program);throw new Error("LINK FAILED\n"+n)}this.valid=!0}},{key:"use",value:function(){this.gl.useProgram(this.program),this.uniforms.onUse()}},{key:"destroy",value:function(){s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",this).call(this),this.gl.deleteProgram(this.program)}},{key:"findAttributeLocation",value:function(e){return"undefined"==typeof this._attributeLocations[e]?(this._attributeLocations[e]=this.gl.getAttribLocation(this.program,e),this._safeEnableVertexAttribArray(this._attributeLocations[e]),this._attributeLocations[e]):this._attributeLocations[e]}},{key:"findUniformLocation",value:function(e){return"undefined"==typeof this._uniformLocations[e]?this._uniformLocations[e]=this.gl.getUniformLocation(this.program,e):this._uniformLocations[e]}},{key:"_safeEnableVertexAttribArray",value:function(e){e<0||this.gl.enableVertexAttribArray(e)}}]),t}(d.default);t.default=h},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),s=function e(t,r,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,r,n)}if("value"in o)return o.value;var a=o.get;if(void 0!==a)return a.call(n)},l=r(2),f=n(l),c=function(e){function t(e,r,n){o(this,t);var a=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.type=r,a.sourceCode=n,a.shader=e.createShader(r),n&&a.update(n),a}return a(t,e),u(t,[{key:"update",value:function(e){if(this.gl.shaderSource(this.shader,e),this.gl.compileShader(this.shader),!this.gl.getShaderParameter(this.shader,WebGLRenderingContext.COMPILE_STATUS))throw new Error("Compiling shader failed.\nSourceCode:\n"+e+"\n\nErrorCode:"+this.gl.getShaderInfoLog(this.shader));this.sourceCode=e,this.valid=!0}},{key:"destroy",value:function(){s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",this).call(this),this.gl.deleteShader(this.shader)}}]),t}(f.default);t.default=c},function(e,t){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=function(){function e(t){r(this,e),this.program=t,this._currentTextureRegister=0,this._gl=t.gl}return n(e,[{key:"uniformBool",value:function(e,t){var r=this;this._pass(e,function(e){return r._gl.uniform1i(e,t?1:0)})}},{key:"uniformMatrix",value:function(e,t){var r=this;this._pass(e,function(e){return r._gl.uniformMatrix4fv(e,!1,t.rawElements)})}},{key:"uniformMatrixArray",value:function(e,t){for(var r=this,n=t.length/16,o=function(n){r._passAsArray(e,n,function(e){return r._gl.uniformMatrix4fv(e,!1,new Float32Array(t.buffer,t.byteOffset+64*n))})},i=0;i<n;i++)o(i)}},{key:"uniformFloat",value:function(e,t){var r=this;this._pass(e,function(e){return r._gl.uniform1f(e,t)})}},{key:"uniformFloatArray",value:function(e,t){var r=this;this._pass(e,function(e){return r._gl.uniform1fv(e,t)})}},{key:"uniformInt",value:function(e,t){var r=this;this._pass(e,function(e){return r._gl.uniform1i(e,t)})}},{key:"uniformVector2",value:function(e,t){var r=this;this._pass(e,function(e){return r._gl.uniform2f(e,t.X,t.Y)})}},{key:"uniformVector2Array",value:function(e,t){var r=this;this._pass(e,function(e){return r._gl.uniform2fv(e,t)})}},{key:"uniformVector3",value:function(e,t){var r=this;this._pass(e,function(e){return r._gl.uniform3f(e,t.X,t.Y,t.Z)})}},{key:"uniformVector3Array",value:function(e,t){var r=this;this._pass(e,function(e){return r._gl.uniform3fv(e,t)})}},{key:"uniformColor3",value:function(e,t){var r=this;this._pass(e,function(e){return r._gl.uniform3f(e,t.R,t.G,t.B)})}},{key:"uniformVector4",value:function(e,t){var r=this;this._pass(e,function(e){return r._gl.uniform4f(e,t.X,t.Y,t.Z,t.W)})}},{key:"uniformVector4Array",value:function(e,t){var r=this;this._pass(e,function(e){return r._gl.uniform4fv(e,t)})}},{key:"uniformColor4",value:function(e,t){var r=this;this._pass(e,function(e){return r._gl.uniform4f(e,t.R,t.G,t.B,t.A)})}},{key:"uniformTexture2D",value:function(e,t){t.valid?(t.register(this._currentTextureRegister),this.uniformInt(e,this._currentTextureRegister),this._currentTextureRegister++):console.warn("The texture assigned to '"+e+"' is not valid.")}},{key:"onUse",value:function(){this._currentTextureRegister=0}},{key:"_pass",value:function(e,t){var r=this.program.findUniformLocation(e);r&&t(r)}},{key:"_passAsArray",value:function(e,t,r){var n=this.program.findUniformLocation(e+"["+t+"]");n&&r(n)}}]),e}();t.default=o},function(e,t){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=function(){function e(){r(this,e),this._rendeables=[]}return n(e,[{key:"add",value:function(e){this._rendeables.push({rendarable:e,priortyCache:Number.MIN_VALUE})}},{key:"remove",value:function(e){for(var t=0;t<this._rendeables.length;t++){var r=this._rendeables[t];if(r.rendarable.id===e.id)break}this._rendeables.length!==t&&this._rendeables.splice(t,1)}},{key:"renderAll",value:function(e,t,r){for(var n=0;n<this._rendeables.length;n++)this._rendeables[n].priortyCache=this._rendeables[n].rendarable.getRenderingPriorty(e.camera,t,this._rendeables[n].priortyCache);this._rendeables.sort(function(e,t){return e.priortyCache-t.priortyCache}),this._rendeables.forEach(function(t){t.rendarable.render(e)})}}]),e}();t.default=o},function(e,t){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=function(){function e(){r(this,e),this._queues=[],this._renderables=[]}return n(e,[{key:"registerQueue",value:function(e){this._queues.push(e),this._renderables.forEach(function(t){return e.add(t)})}},{key:"unregisterQueue",value:function(e){var t=this._queues.indexOf(e);t>-1&&this._queues.splice(t,1)}},{key:"addRenderable",value:function(e){this._renderables.push(e),this._queues.forEach(function(t){return t.add(e)})}},{key:"removeRenderable",value:function(e){var t=this._renderables.indexOf(e);t!==-1&&(this._renderables.splice(t,1),this._queues.forEach(function(t){return t.remove(e)}))}}]),e}();t.default=o},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.math.AABB},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.math.Color3},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.math.Vector2},function(e,t){"use strict";function r(e){return function(t){return o(t,e)?null:"ChildrenComponentConstraint Error:"+t.name}}function n(e,t){return t.every(function(t){return null!==e.getComponent(t)})}function o(e,t){return!!n(e,t)&&e.children.every(function(e){return o(e,t)})}Object.defineProperty(t,"__esModule",{value:!0}),t.default=r},function(e,t){"use strict";function r(){return function(e){return 0===e.children.length?null:"NoChildConstraint fail:"+e.name}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=r},function(e,t){"use strict";function r(e){return function(t){return e.every(function(e){return null!=t.getComponent(e)})?null:"ParentConstraint Error:"+t.name}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=r},function(e,t){"use strict";function r(){return function(e){return e.parent?"RootConstraint: this node: "+e.name.fqn+" must be tree root.":null}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=r},function(e,t){"use strict";function r(e){var t,r;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:t=/@([a-zA-Z]+)\(([^)]*)\)/g,r=void 0;case 2:if(!(r=t.exec(e))){n.next=7;break}return n.next=5,{name:r[1],args:r[2].split(",")};case 5:n.next=2;break;case 7:case"end":return n.stop()}},u[0],this)}function n(e,t){return t?function(t){t.enable(e)}:function(t){t.disable(e)}}function o(e,t){if(e.length!==t)throw new Error("The arguments should contain "+t+" of items but there was "+e.length);return e.map(function(e){var t=WebGLRenderingContext[e.toUpperCase().trim()];if(void 0!==t)return t;throw new Error("Specified WebGL constant "+e+" was not found")})}function i(e,t){if(4!==t.length)throw new Error("ExposeMacro must have 4 of arguments");e.macros.push({type:t[0],attributeName:t[1],macroName:t[2],default:t[3]})}function a(e){for(var t=r(e.shaderSource),a=void 0,u=[],s=!0,l=!0,f=!0;(a=t.next())&&!a.done;){var c=a.value;!function(){switch(c.name){case"NoDepth":s=!1;break;case"DepthFunc":s=!0;var t=o(c.args,1);u.push(function(e){e.depthFunc(t[0])});break;case"NoBlend":l=!1;break;case"NoCull":f=!1;break;case"CullFace":f=!0;var r=o(c.args,1);u.push(function(e){e.cullFace(r[0])});break;case"BlendFunc":l=!0;var n=o(c.args,2);u.push(function(e){e.blendFunc(n[0],n[1])});break;case"BlendFuncSeparate":l=!0;var a=o(c.args,4);u.push(function(e){e.blendFuncSeparate(a[0],a[1],a[2],a[3])});break;case"BlendEquation":l=!0;var d=o(c.args,1);u.push(function(e){e.blendEquation(d[0])});break;case"BlendEquationSeparate":l=!0;var h=o(c.args,2);u.push(function(e){e.blendEquationSeparate(h[0],h[1])});break;case"ExposeMacro":i(e,c.args)}}()}u.unshift(n(WebGLRenderingContext.DEPTH_TEST,s)),u.unshift(n(WebGLRenderingContext.BLEND,l)),u.unshift(n(WebGLRenderingContext.CULL_FACE,f)),e.configurator=u}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return s(this,void 0,void 0,regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return a(e.info),t.abrupt("return",e);case 2:case"end":return t.stop()}},t,this)}))};var u=[r].map(regeneratorRuntime.mark),s=function(e,t,r,n){return new(r||(r=Promise))(function(o,i){function a(e){try{s(n.next(e))}catch(e){i(e)}}function u(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){e.done?o(e.value):new r(function(t){t(e.value)}).then(a,u)}s((n=n.apply(e,t)).next())})}},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=r(72),i=n(o),a=r(68),u=n(a),s=r(6),l=n(s),f=r(31),c=n(f),d=r(32),h=n(d),p=r(33),b=n(p),v=r(34),m=n(v),g=r(35),y=n(g),_=r(36),w=n(_),x=r(37),R=n(x),E=r(38),C=n(E),k=r(17),P=n(k),O=r(39),M=n(O),T=r(40),A=n(T),j=r(41),S=n(j),N=r(42),L=n(N),G=r(43),F=n(G),I=r(44),W=n(I),Y=r(47),B=n(Y),D=r(48),U=n(D),z=r(45),V=n(z),q=r(46),H=n(q),$=r(7),X=n($),Z=r(49),Q=n(Z),J=r(18),K=n(J),ee=r(4),te=n(ee),re=r(50),ne=n(re),oe=r(51),ie=n(oe),ae=r(52),ue=n(ae),se=r(53),le=n(se),fe=r(54),ce=n(fe),de=r(55),he=n(de),pe=r(56),be=n(pe),ve=r(57),me=n(ve),ge=r(58),ye=n(ge),_e=r(63),we=n(_e),xe=r(59),Re=n(xe),Ee=r(60),Ce=n(Ee),ke=r(61),Pe=n(ke),Oe=r(62),Me=n(Oe),Te=r(64),Ae=n(Te),je=r(65),Se=n(je),Ne=r(66),Le=n(Ne),Ge=r(67),Fe=n(Ge),Ie=function(e,t,r,n){return new(r||(r=Promise))(function(o,i){function a(e){try{s(n.next(e))}catch(e){i(e)}}function u(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){e.done?o(e.value):new r(function(t){t(e.value)}).then(a,u)}s((n=n.apply(e,t)).next())})};t.default=function(){l.default.register(function(){return Ie(void 0,void 0,void 0,regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=l.default.ns("HTTP://GRIMOIRE.GL/NS/DEFAULT"),l.default.registerComponent(t("AssetLoadingManager"),c.default),l.default.registerComponent(t("Camera"),h.default),l.default.registerComponent(t("CanvasInitializer"),b.default),l.default.registerComponent(t("Fullscreen"),m.default),l.default.registerComponent(t("Geometry"),y.default),l.default.registerComponent(t("GeometryRegistory"),w.default),l.default.registerComponent(t("HTMLBinder"),R.default),l.default.registerComponent(t("LoopManager"),C.default),l.default.registerComponent(t("Material"),P.default),l.default.registerComponent(t("MaterialContainer"),M.default),l.default.registerComponent(t("MaterialImporter"),A.default),l.default.registerComponent(t("MaterialManager"),S.default),l.default.registerComponent(t("MeshRenderer"),L.default),
l.default.registerComponent(t("MouseCameraControl"),F.default),l.default.registerComponent(t("RenderBuffer"),W.default),l.default.registerComponent(t("Renderer"),B.default),l.default.registerComponent(t("RendererManager"),U.default),l.default.registerComponent(t("RenderQuad"),V.default),l.default.registerComponent(t("RenderScene"),H.default),l.default.registerComponent(t("Scene"),X.default),l.default.registerComponent(t("TextureBuffer"),Q.default),l.default.registerComponent(t("Texture"),K.default),l.default.registerComponent(t("Transform"),te.default),l.default.registerConverter(t("Angle2D"),ne.default),l.default.registerConverter(t("Boolean"),ie.default),l.default.registerConverter(t("CanvasSize"),ue.default),l.default.registerConverter(t("Color3"),le.default),l.default.registerConverter(t("Color4"),ce.default),l.default.registerConverter(t("Component"),he.default),l.default.registerConverter(t("Enum"),be.default),l.default.registerConverter(t("Geometry"),me.default),l.default.registerConverter(t("Material"),ye.default),l.default.registerConverter(t("Texture"),we.default),l.default.registerConverter(t("NumberArray"),Re.default),l.default.registerConverter(t("Number"),Ce.default),l.default.registerConverter(t("Object"),Pe.default),l.default.registerConverter(t("Rotation3"),Me.default),l.default.registerConverter(t("Texture2D"),we.default),l.default.registerConverter(t("Vector2"),Ae.default),l.default.registerConverter(t("Vector3"),Se.default),l.default.registerConverter(t("Vector4"),Le.default),l.default.registerConverter(t("Viewport"),Fe.default),l.default.registerNode("goml",["CanvasInitializer","LoopManager","AssetLoadingManager","GeometryRegistory","MaterialManager","RendererManager","Fullscreen"]),l.default.registerNode("renderer",["Renderer"]),l.default.registerNode("scene",["Scene"]),l.default.registerNode("camera",["Camera"],{position:"0,0,10"},"object"),l.default.registerNode("empty",[]),l.default.registerNode("object",["Transform"]),l.default.registerNode("geometry",["Geometry"]),l.default.registerNode("texture",["Texture"]),l.default.registerNode("mesh",["MaterialContainer","MeshRenderer"],{},"object"),l.default.registerNode("material",["Material"]),l.default.registerNode("import-material",["MaterialImporter"]),l.default.registerNode("texture-buffer",["TextureBuffer"]),l.default.registerNode("render-buffer",["RenderBuffer"]),l.default.registerNode("render-scene",["MaterialContainer","RenderScene"],{material:null}),l.default.registerNode("render-quad",["MaterialContainer","RenderQuad"],{material:null}),u.default.register(),i.default.register();case 60:case"end":return e.stop()}},e,this)}))})}},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.math.Rectangle},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.Base.EEObject},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.Base.IDObject},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.GrimoireInterface},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.Node.GomlNode},function(e,t,r){var n=t;n.parse=function(){"use strict";var e,t,r,n,o,i,a={"'":"'",'"':'"',"\\":"\\","/":"/","\n":"",b:"\b",f:"\f",n:"\n",r:"\r",t:"\t"},u=[" ","\t","\r","\n","\v","\f","","\ufeff"],s=function(e){return""===e?"EOF":"'"+e+"'"},l=function(n){var i=new SyntaxError;throw i.message=n+" at line "+t+" column "+r+" of the JSON5 data. Still to read: "+JSON.stringify(o.substring(e-1,e+19)),i.at=e,i.lineNumber=t,i.columnNumber=r,i},f=function(i){return i&&i!==n&&l("Expected "+s(i)+" instead of "+s(n)),n=o.charAt(e),e++,r++,("\n"===n||"\r"===n&&"\n"!==c())&&(t++,r=0),n},c=function(){return o.charAt(e)},d=function(){var e=n;for("_"!==n&&"$"!==n&&(n<"a"||n>"z")&&(n<"A"||n>"Z")&&l("Bad identifier as unquoted key");f()&&("_"===n||"$"===n||n>="a"&&n<="z"||n>="A"&&n<="Z"||n>="0"&&n<="9");)e+=n;return e},h=function(){var e,t="",r="",o=10;if("-"!==n&&"+"!==n||(t=n,f(n)),"I"===n)return e=y(),("number"!=typeof e||isNaN(e))&&l("Unexpected word for number"),"-"===t?-e:e;if("N"===n)return e=y(),isNaN(e)||l("expected word to be NaN"),e;switch("0"===n&&(r+=n,f(),"x"===n||"X"===n?(r+=n,f(),o=16):n>="0"&&n<="9"&&l("Octal literal")),o){case 10:for(;n>="0"&&n<="9";)r+=n,f();if("."===n)for(r+=".";f()&&n>="0"&&n<="9";)r+=n;if("e"===n||"E"===n)for(r+=n,f(),"-"!==n&&"+"!==n||(r+=n,f());n>="0"&&n<="9";)r+=n,f();break;case 16:for(;n>="0"&&n<="9"||n>="A"&&n<="F"||n>="a"&&n<="f";)r+=n,f()}return e="-"===t?-r:+r,isFinite(e)?e:void l("Bad number")},p=function(){var e,t,r,o,i="";if('"'===n||"'"===n)for(r=n;f();){if(n===r)return f(),i;if("\\"===n)if(f(),"u"===n){for(o=0,t=0;t<4&&(e=parseInt(f(),16),isFinite(e));t+=1)o=16*o+e;i+=String.fromCharCode(o)}else if("\r"===n)"\n"===c()&&f();else{if("string"!=typeof a[n])break;i+=a[n]}else{if("\n"===n)break;i+=n}}l("Bad string")},b=function(){"/"!==n&&l("Not an inline comment");do if(f(),"\n"===n||"\r"===n)return void f();while(n)},v=function(){"*"!==n&&l("Not a block comment");do for(f();"*"===n;)if(f("*"),"/"===n)return void f("/");while(n);l("Unterminated block comment")},m=function(){"/"!==n&&l("Not a comment"),f("/"),"/"===n?b():"*"===n?v():l("Unrecognized comment")},g=function(){for(;n;)if("/"===n)m();else{if(!(u.indexOf(n)>=0))return;f()}},y=function(){switch(n){case"t":return f("t"),f("r"),f("u"),f("e"),!0;case"f":return f("f"),f("a"),f("l"),f("s"),f("e"),!1;case"n":return f("n"),f("u"),f("l"),f("l"),null;case"I":return f("I"),f("n"),f("f"),f("i"),f("n"),f("i"),f("t"),f("y"),1/0;case"N":return f("N"),f("a"),f("N"),NaN}l("Unexpected "+s(n))},_=function(){var e=[];if("["===n)for(f("["),g();n;){if("]"===n)return f("]"),e;if(","===n?l("Missing array element"):e.push(i()),g(),","!==n)return f("]"),e;f(","),g()}l("Bad array")},w=function(){var e,t={};if("{"===n)for(f("{"),g();n;){if("}"===n)return f("}"),t;if(e='"'===n||"'"===n?p():d(),g(),f(":"),t[e]=i(),g(),","!==n)return f("}"),t;f(","),g()}l("Bad object")};return i=function(){switch(g(),n){case"{":return w();case"[":return _();case'"':case"'":return p();case"-":case"+":case".":return h();default:return n>="0"&&n<="9"?h():y()}},function(a,u){var s;return o=String(a),e=0,t=1,r=1,n=" ",s=i(),g(),n&&l("Syntax error"),"function"==typeof u?function e(t,r){var n,o,i=t[r];if(i&&"object"==typeof i)for(n in i)Object.prototype.hasOwnProperty.call(i,n)&&(o=e(i,n),void 0!==o?i[n]=o:delete i[n]);return u.call(t,r,i)}({"":s},""):s}}(),n.stringify=function(e,t,r){function o(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"||e>="0"&&e<="9"||"_"===e||"$"===e}function i(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"||"_"===e||"$"===e}function a(e){if("string"!=typeof e)return!1;if(!i(e[0]))return!1;for(var t=1,r=e.length;t<r;){if(!o(e[t]))return!1;t++}return!0}function u(e){return Array.isArray?Array.isArray(e):"[object Array]"===Object.prototype.toString.call(e)}function s(e){return"[object Date]"===Object.prototype.toString.call(e)}function l(e){for(var t=0;t<b.length;t++)if(b[t]===e)throw new TypeError("Converting circular structure to JSON")}function f(e,t,r){if(!e)return"";e.length>10&&(e=e.substring(0,10));for(var n=r?"":"\n",o=0;o<t;o++)n+=e;return n}function c(e){return v.lastIndex=0,v.test(e)?'"'+e.replace(v,function(e){var t=m[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function d(e,t,r){var n,o,i=h(e,t,r);switch(i&&!s(i)&&(i=i.valueOf()),typeof i){case"boolean":return i.toString();case"number":return isNaN(i)||!isFinite(i)?"null":i.toString();case"string":return c(i.toString());case"object":if(null===i)return"null";if(u(i)){l(i),n="[",b.push(i);for(var v=0;v<i.length;v++)o=d(i,v,!1),n+=f(p,b.length),n+=null===o||"undefined"==typeof o?"null":o,v<i.length-1?n+=",":p&&(n+="\n");b.pop(),i.length&&(n+=f(p,b.length,!0)),n+="]"}else{l(i),n="{";var m=!1;b.push(i);for(var g in i)if(i.hasOwnProperty(g)){var y=d(i,g,!1);r=!1,"undefined"!=typeof y&&null!==y&&(n+=f(p,b.length),m=!0,t=a(g)?g:c(g),n+=t+":"+(p?" ":"")+y+",")}b.pop(),n=m?n.substring(0,n.length-1)+f(p,b.length)+"}":"{}"}return n;default:return}}if(t&&"function"!=typeof t&&!u(t))throw new Error("Replacer must be a function or an array");var h=function(e,r,n){var o=e[r];return o&&o.toJSON&&"function"==typeof o.toJSON&&(o=o.toJSON()),"function"==typeof t?t.call(e,r,o):t?n||u(e)||t.indexOf(r)>=0?o:void 0:o};n.isWord=a;var p,b=[];r&&("string"==typeof r?p=r:"number"==typeof r&&r>=0&&(p=f(" ",r,!0)));var v=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,m={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},g={"":e};return void 0===e?h(g,"",!0):d(g,"",!0)}},function(e,t){e.exports='<div style="width:100%;height:100%;position: relative;">\n    <div style="width: 55px;height: 55px;border-radius: 100%;border: 5px solid #381794;border-right-color: #FC659D;animation: rotate 1s linear infinite;position: absolute;top: 0;left: 0;right: 0;bottom: 0;margin: auto;"></div>\n</div>\n<style type="text/css">\n    @keyframes rotate {\n        from {\n            transform: rotate(0deg);\n        }\n        to {\n            transform: rotate(360deg);\n        }\n    }\n</style>\n'},function(e,t){e.exports='@Pass\nFS_PREC(mediump,float)\nvarying vec2 vTexCoord;\n#ifdef VS\nattribute vec3 position;\nattribute vec2 texCoord;\nuniform mat4 _matPVM;\nvoid main()\n{\n  gl_Position = _matPVM * vec4(position,1.0);\n  vTexCoord = texCoord;\n}\n#endif\n#ifdef FS\n@{type:"color",default:"white"}\nuniform vec4 color;\nvoid main(void)\n{\n    gl_FragColor = color;\n}\n#endif\n'},function(e,t){e.exports="@Pass\nFS_PREC(mediump,float)\nvarying vec2 vTexCoord;\n#ifdef VS\nattribute vec3 position;\nattribute vec2 texCoord;\nuniform mat4 _matPVM;\nvoid main()\n{\n  gl_Position = _matPVM * vec4(position,1.0);\n  vTexCoord = texCoord;\n}\n#endif\n#ifdef FS\nuniform sampler2D texture;\nvoid main(void)\n{\n  gl_FragColor = texture2D(texture,vTexCoord);\n}\n#endif\n"},function(e,t){e.exports='@Pass\n@BlendFunc(SRC_ALPHA,ONE_MINUS_SRC_ALPHA)\nFS_PREC(mediump,float)\nvarying vec2 vTexCoord;\n#ifdef VS\nattribute vec3 position;\nattribute vec2 texCoord;\nuniform mat4 _matPVM;\nvoid main()\n{\n  gl_Position = _matPVM * vec4(position,1.0);\n  vTexCoord = texCoord;\n}\n#endif\n#ifdef FS\n@{type:"color",default:"white"}\nuniform vec4 color;\n@{usedFlag:"_textureUsed"}\nuniform sampler2D texture;\nuniform bool _textureUsed;\nvoid main(void)\n{\n  if(_textureUsed){\n    gl_FragColor = color * texture2D(texture,vTexCoord);\n  }else{\n    gl_FragColor = color;\n }\n}\n#endif\n'},function(e,t){e.exports="/*Header start*/\n// helper macros\n#ifdef FS\n  #define FS_PREC(prec,type) precision prec type;\n  #define VS_PREC(prec,type)\n#endif\n#ifdef VS\n#define VS_PREC(prec,type) precision prec type;\n#define FS_PREC(prec,type)\n#endif\n// constants\n#define PI 3.141592653589793\n#define E 2.718281828459045\n#define LN2 0.6931471805599453\n#define LN10 2.302585092994046\n#define LOG2E 1.4426950408889634\n#define LOG10E 0.4342944819032518\n#define SQRT2 1.4142135623730951\n#define SQRT1_2 0.7071067811865476\n/*Header end*/\n"}])});
//# sourceMappingURL=grimoire-fundamental.min.js.map