!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n=t();for(var r in n)("object"==typeof exports?exports:e)[r]=n[r]}}(this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={exports:{},id:r,loaded:!1};return e[r].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),i=r(o),a=n(2),u=r(a),f=n(3),s=r(f),l={Components:{GLTFModelComponent:i.default},Parser:{GLTFParser:u.default}},c=(0,s.default)();Object.assign(c||{},l),window.GrimoireJS.lib.gltf=l,t.default=c},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),f=n(10),s=r(f),l=n(2),c=r(l),d=function(e){function t(){return o(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return a(t,e),u(t,[{key:"$mount",value:function(){var e=this,t=this.getValue("src");if(t){var n=this.companion.get("gl");c.default.parseFromURL(n,t).then(function(t){e._populateChildren(t)})}}},{key:"_populateChildren",value:function(e){var t=!0,n=!1,r=void 0;try{for(var o,i=e.scene.nodes[Symbol.iterator]();!(t=(o=i.next()).done);t=!0){var a=o.value,u=e.tf.nodes[a];if(void 0!==u.meshes){var f=e.meshes[u.meshes[0]];this.node.addChildByName("gltf-mesh",{geometry:f,texture:e.textures[e.material[f.materialName].texture]})}}}catch(e){n=!0,r=e}finally{try{!t&&i.return&&i.return()}finally{if(n)throw r}}}}]),t}(s.default);t.default=d,d.componentName="GLTFModelComponent",d.attributes={src:{converter:"String",defaultValue:void 0}}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(5),u=r(a),f=n(8),s=r(f),l=n(6),c=r(l),d=n(4),m=r(d),p=n(9),v=r(p),b=function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{f(r.next(e))}catch(e){i(e)}}function u(e){try{f(r.throw(e))}catch(e){i(e)}}function f(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(a,u)}f((r=r.apply(e,t)).next())})},y=function(){function e(){o(this,e)}return i(e,null,[{key:"parseFromURL",value:function(t,n){return b(this,void 0,void 0,regeneratorRuntime.mark(function r(){var o,i,a,f,l,c,d,p,b,y,w,_,h,x,g,O,R,M,S,P,C,G,N,k,T,j;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return o=e.getBaseDir(n),r.next=3,u.default.resolve(n);case 3:i=r.sent,a=JSON.parse(i),f={},l={},c={},d={},p={},b={},y={},r.t0=regeneratorRuntime.keys(a.buffers);case 13:if((r.t1=r.t0()).done){r.next=20;break}return w=r.t1.value,r.next=17,e.bufferFromURL(a,w,o);case 17:f[w]=r.sent,r.next=13;break;case 20:for(_ in a.bufferViews)h=a.bufferViews[_],x=f[h.buffer],g=c[_]=new s.default(t,h.target,WebGLRenderingContext.STATIC_DRAW),g.update(new DataView(x,h.byteOffset,h.byteLength));for(O in a.meshes)l[O]=e._parseMesh(a,a.meshes[O],c);R=[],M=function(e){var t=e;R.push(m.default.resolve(o+a.images[e].uri).then(function(e){d[t]=e}))};for(S in a.images)M(S);return r.next=27,Promise.all(R);case 27:for(P in a.textures)C=a.textures[P],G=p[P]=new v.default(t),G.update(d[C.source]);N=a.scenes[a.scene],r.t2=regeneratorRuntime.keys(a.materials);case 30:if((r.t3=r.t2()).done){r.next=41;break}if(k=r.t3.value,T=a.materials[k],void 0===T.extensions||!T.extensions.KHR_materials_common){r.next=38;break}j=T.extensions.KHR_materials_common,b[k]={texture:j.values.diffuse},r.next=39;break;case 38:throw new Error("Unsupported material type");case 39:r.next=30;break;case 41:return r.abrupt("return",{meshes:l,textures:p,tf:a,scene:N,material:b});case 42:case"end":return r.stop()}},r,this)}))}},{key:"_parseMesh",value:function(t,n,r){var o=n.primitives[0],i=t.accessors[o.indices],a={};a.topology=o.mode,a.type=i.componentType,a.index=r[i.bufferView],a.byteSize=e._asByteSize(a.type),a.count=i.count;var u={},f={};for(var s in o.attributes){var l=(e._asGrAttribName(s),t.accessors[o.attributes[s]]);f[l.bufferView]=r[l.bufferView],u[e._asGrAttribName(s)]={bufferName:l.bufferView,size:e._asVectorSize(l.type),type:l.componentType,stride:l.byteStride,offset:l.byteOffset}}var d=new c.default(f,u,{default:a});return d.materialName=o.material,d}},{key:"_asColorValue",value:function(e){return 3===e.length?"rgb("+(255*e[0]).toFixed()+","+(255*e[1]).toFixed()+","+(255*e[2]).toFixed():"rgb("+(255*e[0]).toFixed()+","+(255*e[1]).toFixed()+","+(255*e[2]).toFixed()+","+(255*e[3]).toFixed()}},{key:"_asVectorSize",value:function(e){switch(e){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":return 4;default:throw new Error("Invalid vectorSize")}}},{key:"_asByteSize",value:function(e){switch(e){case WebGLRenderingContext.UNSIGNED_BYTE:return 1;case WebGLRenderingContext.UNSIGNED_SHORT:return 2;case WebGLRenderingContext.UNSIGNED_INT:return 4;default:throw new Error("Unknown index size!")}}},{key:"_asGrAttribName",value:function(e){switch(e){case"POSITION":return"position";case"NORMAL":return"normal";case"TEXCOORD_0":return"texCoord"}}},{key:"bufferFromURL",value:function(e,t,n){return b(this,void 0,void 0,regeneratorRuntime.mark(function r(){return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",new Promise(function(r,o){var i=new XMLHttpRequest;i.open("GET",n+e.buffers[t].uri),i.responseType="arraybuffer",i.onload=function(e){r(i.response)},i.onerror=function(e){o(e)},i.send()}));case 1:case"end":return r.stop()}},r,this)}))}},{key:"getBaseDir",value:function(e){return e.substr(0,e.lastIndexOf("/")+1)}}]),e}();t.default=y},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),i=r(o),a=n(11),u=r(a),f=n(7),s=r(f),l=n(12),c=r(l),d=function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{f(r.next(e))}catch(e){i(e)}}function u(e){try{f(r.throw(e))}catch(e){i(e)}}function f(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(a,u)}f((r=r.apply(e,t)).next())})};t.default=function(){u.default.register(function(){return d(void 0,void 0,void 0,regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:u.default.registerComponent("GLTFModel",i.default),u.default.registerNode("model",["Transform","GLTFModel"]),u.default.registerNode("gltf-mesh",["Transform","MaterialContainer","MeshRenderer"],{material:"new(gltf-unlit)"}),s.default.addSORTMaterial("gltf-unlit",c.default);case 4:case"end":return e.stop()}},e,this)}))})}},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.fundamental.Asset.ImageResolver},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.fundamental.Asset.TextFileResolver},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.fundamental.Geometry.Geometry},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.fundamental.Material.MaterialFactory},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.fundamental.Resource.Buffer},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.lib.fundamental.Resource.Texture2D},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS.Node.Component},function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=window.GrimoireJS},function(e,t){e.exports="@Pass\n@NoBlend()\n@NoCull()\nFS_PREC(mediump,float)\n\nvarying vec3 vNormal;\nvarying vec2 vUV;\n\n#ifdef VS\n  attribute vec3 position;\n  attribute vec3 normal;\n  attribute vec2 texCoord;\n\n  uniform mat4 _matPVM;\n\n  void main(){\n    gl_Position = _matPVM * vec4(position,1);\n    vNormal = normal;\n    vUV = texCoord;\n  }\n\n#endif\n\n\n#ifdef FS\n\n  uniform sampler2D texture;\n\n  void main(){\n    gl_FragColor = texture2D(texture,vUV);\n  }\n#endif\n"}])});
//# sourceMappingURL=grimoire-gltf.min.js.map
